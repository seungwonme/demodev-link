This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
src/
  app/
    [slug]/
      page.tsx
    admin/
      analytics/
        page.tsx
      campaigns/
        [id]/
          edit/
            page.tsx
          page.tsx
        new/
          page.tsx
        page.tsx
      dashboard/
        error-fallback.tsx
        page.tsx
      links/
        page.tsx
      login/
        [[...sign-in]]/
          page.tsx
      pending/
        page.tsx
      register/
        [[...sign-up]]/
          page.tsx
      rejected/
        page.tsx
      settings/
        page.tsx
      templates/
        [id]/
          edit/
            page.tsx
        new/
          page.tsx
        page.tsx
      users/
        page.tsx
      layout.tsx
      page.tsx
    api/
      cron/
        keep-alive/
          route.ts
      webhooks/
        clerk/
          route.ts
    shorten/
      page.tsx
    favicon.ico
    globals.css
    layout.tsx
    not-found-back-button.tsx
    not-found.tsx
    page.tsx
  components/
    Iridescence.css
    Iridescence.jsx
  features/
    analytics/
      actions/
        get-analytics.ts
      components/
        click-analytics.tsx
        link-stats.tsx
        marketing-analytics.tsx
    auth/
      actions/
        clerk-user.ts
      components/
        admin/
          sidebar.tsx
          user-management-table.tsx
      services/
        clerk-auth.service.ts
      types/
        profile.ts
      utils/
        with-auth.tsx
    campaigns/
      actions/
        campaign-actions.ts
      components/
        add-to-campaign-dialog.tsx
        campaign-detail.tsx
        campaign-form.tsx
        campaign-link-selector.tsx
        campaign-list.tsx
        campaign-status-badge.tsx
      services/
        campaign.service.ts
      types/
        campaign.ts
    links/
      actions/
        delete-link.ts
        link-actions.ts
        link.service.ts
        shorten-url.ts
        update-link.ts
      components/
        url/
          shortened-url-result.tsx
          url-input-form.tsx
        utm/
          utm-builder.tsx
        youtube/
          youtube-embed.tsx
          youtube-thumbnail.tsx
        link-list.tsx
      types/
        utm.ts
        youtube.ts
      utils/
        youtube.ts
    templates/
      actions/
        template-actions.ts
      components/
        template-form.tsx
        template-list.tsx
        template-save-dialog.tsx
        template-selector.tsx
      services/
        template.service.ts
      types/
        template.ts
  hooks/
    use-mobile.ts
  lib/
    url.ts
    utils.ts
  shared/
    components/
      ui/
        accordion.tsx
        alert-dialog.tsx
        alert.tsx
        aspect-ratio.tsx
        avatar.tsx
        badge.tsx
        breadcrumb.tsx
        button.tsx
        calendar.tsx
        card.tsx
        carousel.tsx
        chart.tsx
        checkbox.tsx
        collapsible.tsx
        command.tsx
        context-menu.tsx
        dialog.tsx
        drawer.tsx
        dropdown-menu.tsx
        form.tsx
        hover-card.tsx
        input-otp.tsx
        input.tsx
        label.tsx
        menubar.tsx
        navigation-menu.tsx
        pagination.tsx
        popover.tsx
        progress.tsx
        radio-group.tsx
        resizable.tsx
        scroll-area.tsx
        select.tsx
        separator.tsx
        sheet.tsx
        sidebar.tsx
        skeleton.tsx
        slider.tsx
        sonner.tsx
        switch.tsx
        table.tsx
        tabs.tsx
        textarea.tsx
        toggle-group.tsx
        toggle.tsx
        tooltip.tsx
      date-range-selector.tsx
      nav.tsx
    types/
      database.types.ts
      link.ts
      supabase.ts
    utils/
      request.ts
      snowflake.ts
      string.ts
  middleware.ts
test/
  config/
    setup-test-env.ts
    setup.ts
  services/
    link.service.test.ts
.gitignore
.repomixignore
components.json
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
tsconfig.json
vitest.config.mts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/components/Iridescence.css">
.iridescence-container {
  width: 100%;
  height: 100%;
}
</file>

<file path="src/components/Iridescence.jsx">
'use client';

import { Renderer, Program, Mesh, Color, Triangle } from 'ogl';
import { useEffect, useRef } from 'react';

import './Iridescence.css';

const vertexShader = `
attribute vec2 uv;
attribute vec2 position;

varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = vec4(position, 0, 1);
}
`;

const fragmentShader = `
precision highp float;

uniform float uTime;
uniform vec3 uColor;
uniform vec3 uResolution;
uniform vec2 uMouse;
uniform float uAmplitude;
uniform float uSpeed;

varying vec2 vUv;

void main() {
  float mr = min(uResolution.x, uResolution.y);
  vec2 uv = (vUv.xy * 2.0 - 1.0) * uResolution.xy / mr;

  uv += (uMouse - vec2(0.5)) * uAmplitude;

  float d = -uTime * 0.5 * uSpeed;
  float a = 0.0;
  for (float i = 0.0; i < 8.0; ++i) {
    a += cos(i - d - a * uv.x);
    d += sin(uv.y * i + a);
  }
  d += uTime * 0.5 * uSpeed;
  vec3 col = vec3(cos(uv * vec2(d, a)) * 0.6 + 0.4, cos(a + d) * 0.5 + 0.5);
  col = cos(col * cos(vec3(d, a, 2.5)) * 0.5 + 0.5) * uColor;
  gl_FragColor = vec4(col, 1.0);
}
`;

export default function Iridescence({ color = [1, 1, 1], speed = 1.0, amplitude = 0.1, mouseReact = true, ...rest }) {
  const ctnDom = useRef(null);
  const mousePos = useRef({ x: 0.5, y: 0.5 });

  useEffect(() => {
    if (!ctnDom.current) return;
    const ctn = ctnDom.current;
    const renderer = new Renderer();
    const gl = renderer.gl;
    gl.clearColor(1, 1, 1, 1);

    let program;

    function resize() {
      const scale = 1;
      renderer.setSize(ctn.offsetWidth * scale, ctn.offsetHeight * scale);
      if (program) {
        program.uniforms.uResolution.value = new Color(
          gl.canvas.width,
          gl.canvas.height,
          gl.canvas.width / gl.canvas.height
        );
      }
    }
    window.addEventListener('resize', resize, false);
    resize();

    const geometry = new Triangle(gl);
    program = new Program(gl, {
      vertex: vertexShader,
      fragment: fragmentShader,
      uniforms: {
        uTime: { value: 0 },
        uColor: { value: new Color(...color) },
        uResolution: {
          value: new Color(gl.canvas.width, gl.canvas.height, gl.canvas.width / gl.canvas.height)
        },
        uMouse: { value: new Float32Array([mousePos.current.x, mousePos.current.y]) },
        uAmplitude: { value: amplitude },
        uSpeed: { value: speed }
      }
    });

    const mesh = new Mesh(gl, { geometry, program });
    let animateId;

    function update(t) {
      animateId = requestAnimationFrame(update);
      program.uniforms.uTime.value = t * 0.001;
      renderer.render({ scene: mesh });
    }
    animateId = requestAnimationFrame(update);
    ctn.appendChild(gl.canvas);

    function handleMouseMove(e) {
      const rect = ctn.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = 1.0 - (e.clientY - rect.top) / rect.height;
      mousePos.current = { x, y };
      program.uniforms.uMouse.value[0] = x;
      program.uniforms.uMouse.value[1] = y;
    }
    if (mouseReact) {
      ctn.addEventListener('mousemove', handleMouseMove);
    }

    return () => {
      cancelAnimationFrame(animateId);
      window.removeEventListener('resize', resize);
      if (mouseReact) {
        ctn.removeEventListener('mousemove', handleMouseMove);
      }
      ctn.removeChild(gl.canvas);
      gl.getExtension('WEBGL_lose_context')?.loseContext();
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [color, speed, amplitude, mouseReact]);

  return <div ref={ctnDom} className="iridescence-container" {...rest} />;
}
</file>

<file path="src/lib/url.ts">
/**
 * 서비스의 기본 URL을 반환합니다.
 * 환경변수 NEXT_PUBLIC_BASE_URL을 우선 사용하고,
 * 없으면 현재 브라우저의 origin을 fallback으로 사용합니다.
 */
export function getBaseUrl(): string {
  // 환경변수 우선 사용 (커스텀 도메인)
  if (process.env.NEXT_PUBLIC_BASE_URL) {
    return process.env.NEXT_PUBLIC_BASE_URL;
  }

  // 클라이언트 환경에서 fallback
  if (typeof window !== "undefined") {
    return window.location.origin;
  }

  // 서버 환경에서 fallback
  return "";
}

/**
 * slug로 완전한 단축 URL을 생성합니다.
 */
export function getShortUrl(slug: string): string {
  return `${getBaseUrl()}/${slug}`;
}
</file>

<file path="src/shared/components/date-range-selector.tsx">
"use client";

import { Card, CardContent } from "@/shared/components/ui/card";
import { Button } from "@/shared/components/ui/button";
import { Calendar } from "lucide-react";

export type DateRangePreset = "7d" | "30d" | "3m" | "6m" | "all" | "custom";

export interface DateRange {
  startDate: string;
  endDate: string;
}

interface DateRangeSelectorProps {
  preset: DateRangePreset;
  onPresetChange: (preset: DateRangePreset) => void;
  customStartDate: string;
  customEndDate: string;
  onCustomStartDateChange: (date: string) => void;
  onCustomEndDateChange: (date: string) => void;
}

export function getDateRangeFromPreset(
  preset: DateRangePreset,
  customStartDate?: string,
  customEndDate?: string
): DateRange | undefined {
  const now = new Date();
  const endDate = now.toISOString();

  switch (preset) {
    case "7d": {
      const startDate = new Date(now);
      startDate.setDate(startDate.getDate() - 7);
      return { startDate: startDate.toISOString(), endDate };
    }
    case "30d": {
      const startDate = new Date(now);
      startDate.setDate(startDate.getDate() - 30);
      return { startDate: startDate.toISOString(), endDate };
    }
    case "3m": {
      const startDate = new Date(now);
      startDate.setMonth(startDate.getMonth() - 3);
      return { startDate: startDate.toISOString(), endDate };
    }
    case "6m": {
      const startDate = new Date(now);
      startDate.setMonth(startDate.getMonth() - 6);
      return { startDate: startDate.toISOString(), endDate };
    }
    case "custom": {
      if (customStartDate && customEndDate) {
        return {
          startDate: new Date(customStartDate).toISOString(),
          endDate: new Date(customEndDate).toISOString(),
        };
      }
      return undefined;
    }
    case "all":
    default:
      return undefined;
  }
}

const presetLabels: Record<DateRangePreset, string> = {
  "7d": "최근 7일",
  "30d": "최근 30일",
  "3m": "최근 3개월",
  "6m": "최근 6개월",
  all: "전체 기간",
  custom: "사용자 정의",
};

const presetDescriptions: Record<DateRangePreset, string> = {
  "7d": "최근 7일 데이터를 표시합니다",
  "30d": "최근 30일 데이터를 표시합니다",
  "3m": "최근 3개월 데이터를 표시합니다",
  "6m": "최근 6개월 데이터를 표시합니다",
  all: "전체 데이터를 표시합니다",
  custom: "",
};

export function DateRangeSelector({
  preset,
  onPresetChange,
  customStartDate,
  customEndDate,
  onCustomStartDateChange,
  onCustomEndDateChange,
}: DateRangeSelectorProps) {
  const presets: DateRangePreset[] = ["7d", "30d", "3m", "6m", "all", "custom"];

  return (
    <Card className="border-none shadow-sm bg-white/50 dark:bg-white/5 backdrop-blur-sm">
      <CardContent className="p-4">
        <div className="space-y-4">
          <div className="flex items-center gap-2 text-sm font-medium">
            <Calendar className="h-4 w-4" />
            날짜 범위 선택
          </div>
          <div className="flex flex-wrap gap-2">
            {presets.map((p) => (
              <Button
                key={p}
                variant={preset === p ? "default" : "outline"}
                size="sm"
                onClick={() => onPresetChange(p)}
              >
                {presetLabels[p]}
              </Button>
            ))}
          </div>

          {preset === "custom" && (
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <label className="text-sm font-medium text-foreground">
                  시작일
                </label>
                <input
                  type="date"
                  value={customStartDate}
                  onChange={(e) => onCustomStartDateChange(e.target.value)}
                  className="w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50"
                />
              </div>
              <div className="space-y-2">
                <label className="text-sm font-medium text-foreground">
                  종료일
                </label>
                <input
                  type="date"
                  value={customEndDate}
                  onChange={(e) => onCustomEndDateChange(e.target.value)}
                  className="w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50"
                />
              </div>
            </div>
          )}

          <div className="text-xs text-muted-foreground">
            {preset === "custom" && customStartDate && customEndDate
              ? `${customStartDate} ~ ${customEndDate} 데이터를 표시합니다`
              : presetDescriptions[preset]}
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path=".repomixignore">
# Build & Cache
node_modules/
.next/
.git/
tsconfig.tsbuildinfo

# Environment & Secrets
.env
.env.*
.env.local
.env.production
.env.example

# IDE & Editor
.cursor/
.claude/
.DS_Store
.vscode/

# Documentation & Prompts
prompts/
docs/
README.md
AGENTS.md
CLAUDE.md
*.md

# Repomix output
repomix-output.xml
repomix-output.*

# Lock files
pnpm-lock.yaml
package-lock.json
yarn.lock

# Logs & Patches
*.log
*.patch
commit.log
changes.patch
supabase.log

# GitHub & CI
.github/

# Supabase migrations (if not needed)
supabase/

# Static assets
public/

# Test files (uncomment if needed)
# test/
# **/*.test.ts
# **/*.test.tsx
# **/*.spec.ts
# **/*.spec.tsx
# vitest.config.mts

# Scripts (migration scripts etc.)
scripts/

# Config files that are not essential
.cursorignore
.node-version
.mcp.json
vercel.json
pnpm-workspace.yaml
</file>

<file path="src/app/admin/campaigns/[id]/edit/page.tsx">
import { notFound } from "next/navigation";
import { getCampaign } from "@/features/campaigns/actions/campaign-actions";
import { CampaignForm } from "@/features/campaigns/components/campaign-form";
import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";

interface EditCampaignPageProps {
  params: Promise<{ id: string }>;
}

export default async function EditCampaignPage({
  params,
}: EditCampaignPageProps) {
  const { id } = await params;
  const result = await getCampaign(id);

  if (!result.success || !result.data) {
    notFound();
  }

  return (
    <div className="container mx-auto py-8 px-4 max-w-4xl">
      <div className="mb-6">
        <Link href={`/admin/campaigns/${id}`}>
          <Button variant="ghost" size="sm">
            <ArrowLeft className="h-4 w-4 mr-2" />
            캠페인 상세로
          </Button>
        </Link>
      </div>

      <div className="mb-8">
        <h1 className="text-3xl font-bold">캠페인 수정</h1>
        <p className="text-muted-foreground mt-2">
          {result.data.name}
        </p>
      </div>

      <CampaignForm campaign={result.data} mode="edit" />
    </div>
  );
}
</file>

<file path="src/app/admin/campaigns/[id]/page.tsx">
import { notFound } from "next/navigation";
import { getCampaignWithLinks } from "@/features/campaigns/actions/campaign-actions";
import { CampaignDetail } from "@/features/campaigns/components/campaign-detail";
import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";

interface CampaignDetailPageProps {
  params: Promise<{ id: string }>;
}

export default async function CampaignDetailPage({
  params,
}: CampaignDetailPageProps) {
  const { id } = await params;
  const result = await getCampaignWithLinks(id);

  if (!result.success || !result.data) {
    notFound();
  }

  return (
    <div className="container mx-auto py-8 px-4 max-w-6xl">
      <div className="mb-6">
        <Link href="/admin/campaigns">
          <Button variant="ghost" size="sm">
            <ArrowLeft className="h-4 w-4 mr-2" />
            캠페인 목록으로
          </Button>
        </Link>
      </div>

      <CampaignDetail campaign={result.data} />
    </div>
  );
}
</file>

<file path="src/app/admin/campaigns/new/page.tsx">
import { CampaignForm } from "@/features/campaigns/components/campaign-form";
import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";

export default function NewCampaignPage() {
  return (
    <div className="container mx-auto py-8 px-4 max-w-4xl">
      <div className="mb-6">
        <Link href="/admin/campaigns">
          <Button variant="ghost" size="sm">
            <ArrowLeft className="h-4 w-4 mr-2" />
            캠페인 목록으로
          </Button>
        </Link>
      </div>

      <div className="mb-8">
        <h1 className="text-3xl font-bold">새 캠페인 만들기</h1>
        <p className="text-muted-foreground mt-2">
          여러 링크를 그룹화하고 기본 UTM 파라미터를 설정하세요
        </p>
      </div>

      <CampaignForm mode="create" />
    </div>
  );
}
</file>

<file path="src/app/admin/campaigns/page.tsx">
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";
import { Plus, FolderKanban } from "lucide-react";
import { CampaignList } from "@/features/campaigns/components/campaign-list";
import { getCampaigns } from "@/features/campaigns/actions/campaign-actions";

export const dynamic = "force-dynamic";

export default async function CampaignsPage() {
  const result = await getCampaigns();
  const campaigns = result.success && result.data ? result.data : [];

  return (
    <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div className="flex items-center gap-3">
          <div className="p-3 rounded-2xl bg-white dark:bg-white/10 shadow-sm border-none">
            <FolderKanban className="h-6 w-6 text-primary" />
          </div>
          <div>
            <h1 className="text-3xl font-bold tracking-tight text-foreground">캠페인</h1>
            <p className="text-muted-foreground mt-1 text-sm font-medium">마케팅 캠페인을 관리하고 링크를 그룹화하세요.</p>
          </div>
        </div>
        <Link href="/admin/campaigns/new">
          <Button size="lg" className="rounded-full px-6 shadow-lg shadow-primary/20 hover:shadow-primary/30 transition-all font-semibold">
            <Plus className="h-4 w-4 mr-2" />
            새 캠페인
          </Button>
        </Link>
      </div>

      <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] min-h-[400px]">
        <CampaignList initialCampaigns={campaigns} />
      </div>
    </div>
  );
}
</file>

<file path="src/app/admin/dashboard/error-fallback.tsx">
"use client";

import { Button } from "@/shared/components/ui/button";
import {
  Card,
  CardContent,
} from "@/shared/components/ui/card";
import { AlertTriangle } from "lucide-react";

export function DashboardErrorFallback() {
  return (
    <div className="space-y-6">
      <div className="mb-8">
        <h1 className="text-3xl font-bold gradient-text mb-2">대시보드</h1>
        <p className="text-muted-foreground">
          시스템 상태를 확인 중입니다...
        </p>
      </div>

      <Card className="border-red-200 bg-red-50">
        <CardContent className="pt-6">
          <div className="text-center py-12">
            <AlertTriangle className="h-12 w-12 text-red-500 mx-auto mb-4" />
            <h2 className="text-lg font-semibold text-red-700 mb-2">
              대시보드를 불러올 수 없습니다
            </h2>
            <p className="text-sm text-red-600 mb-4">
              시스템에 일시적인 문제가 발생했습니다. 잠시 후 다시
              시도해주세요.
            </p>
            <Button
              variant="outline"
              onClick={() => window.location.reload()}
              className="border-red-300 text-red-700 hover:bg-red-100"
            >
              새로고침
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="src/app/admin/login/[[...sign-in]]/page.tsx">
/**
 * @file src/app/admin/login/[[...sign-in]]/page.tsx
 * @description Clerk 기반 관리자 로그인 페이지
 *
 * Clerk의 SignIn 컴포넌트를 사용하여 로그인 처리
 */

import { SignIn } from "@clerk/nextjs";

export default function AdminLoginPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background relative overflow-hidden">
      {/* Animated Background Gradient */}
      <div className="absolute inset-0 bg-gradient-to-br from-primary/10 via-accent/5 to-primary/10 animate-gradient-x" />

      {/* Decorative Blurs */}
      <div className="absolute top-20 left-20 w-96 h-96 bg-primary/20 rounded-full blur-3xl animate-pulse" />
      <div className="absolute bottom-20 right-20 w-96 h-96 bg-accent/20 rounded-full blur-3xl animate-pulse delay-1000" />

      <div className="relative z-10">
        <SignIn
          appearance={{
            elements: {
              rootBox: "mx-auto",
              card: "bg-card shadow-xl",
            },
          }}
          fallbackRedirectUrl="/admin/dashboard"
          signUpUrl="/admin/register"
        />
      </div>
    </div>
  );
}
</file>

<file path="src/app/admin/register/[[...sign-up]]/page.tsx">
/**
 * @file src/app/admin/register/[[...sign-up]]/page.tsx
 * @description Clerk 기반 관리자 회원가입 페이지
 *
 * Clerk의 SignUp 컴포넌트를 사용하여 회원가입 처리
 * 가입 후 자동으로 pending 상태로 설정됨 (webhook에서 처리)
 */

import { SignUp } from "@clerk/nextjs";

export default function AdminRegisterPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background relative overflow-hidden">
      {/* Animated Background Gradient */}
      <div className="absolute inset-0 bg-gradient-to-br from-primary/10 via-accent/5 to-primary/10 animate-gradient-x" />

      {/* Decorative Blurs */}
      <div className="absolute top-20 left-20 w-96 h-96 bg-primary/20 rounded-full blur-3xl animate-pulse" />
      <div className="absolute bottom-20 right-20 w-96 h-96 bg-accent/20 rounded-full blur-3xl animate-pulse delay-1000" />

      <div className="relative z-10">
        <SignUp
          appearance={{
            elements: {
              rootBox: "mx-auto",
              card: "bg-card shadow-xl",
            },
          }}
          fallbackRedirectUrl="/admin/pending"
          signInUrl="/admin/login"
        />
      </div>
    </div>
  );
}
</file>

<file path="src/app/admin/templates/[id]/edit/page.tsx">
import { notFound } from "next/navigation";
import { TemplateForm } from "@/features/templates/components/template-form";
import { getTemplate } from "@/features/templates/actions/template-actions";

interface EditTemplatePageProps {
  params: Promise<{ id: string }>;
}

export default async function EditTemplatePage({
  params,
}: EditTemplatePageProps) {
  const { id } = await params;
  const result = await getTemplate(id);

  if (!result.success || !result.data) {
    notFound();
  }

  return (
    <div className="container mx-auto py-8 px-4 max-w-2xl">
      <div className="mb-6">
        <h1 className="text-3xl font-bold">템플릿 수정</h1>
        <p className="text-muted-foreground mt-1">
          템플릿 설정을 수정합니다
        </p>
      </div>

      <TemplateForm template={result.data} mode="edit" />
    </div>
  );
}
</file>

<file path="src/app/admin/templates/new/page.tsx">
import { TemplateForm } from "@/features/templates/components/template-form";

export default function NewTemplatePage() {
  return (
    <div className="container mx-auto py-8 px-4 max-w-2xl">
      <div className="mb-6">
        <h1 className="text-3xl font-bold">새 템플릿 만들기</h1>
        <p className="text-muted-foreground mt-1">
          자주 사용하는 링크 설정을 템플릿으로 저장하세요
        </p>
      </div>

      <TemplateForm mode="create" />
    </div>
  );
}
</file>

<file path="src/app/admin/templates/page.tsx">
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";
import { Plus, FileText } from "lucide-react";
import { TemplateList } from "@/features/templates/components/template-list";
import { getTemplates } from "@/features/templates/actions/template-actions";

export const dynamic = "force-dynamic";

export default async function TemplatesPage() {
  const result = await getTemplates();
  const templates = result.success && result.data ? result.data : [];

  return (
    <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div className="flex items-center gap-3">
          <div className="p-3 rounded-2xl bg-white dark:bg-white/10 shadow-sm border-none">
            <FileText className="h-6 w-6 text-primary" />
          </div>
          <div>
            <h1 className="text-3xl font-bold tracking-tight text-foreground">링크 템플릿</h1>
            <p className="text-muted-foreground mt-1 text-sm font-medium">자주 사용하는 링크 설정을 템플릿으로 저장하세요.</p>
          </div>
        </div>
        <Link href="/admin/templates/new">
          <Button size="lg" className="rounded-full px-6 shadow-lg shadow-primary/20 hover:shadow-primary/30 transition-all font-semibold">
            <Plus className="h-4 w-4 mr-2" />
            새 템플릿
          </Button>
        </Link>
      </div>

      <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] min-h-[400px]">
        <TemplateList initialTemplates={templates} />
      </div>
    </div>
  );
}
</file>

<file path="src/app/api/cron/keep-alive/route.ts">
import { createClient } from "@supabase/supabase-js";
import { NextResponse } from "next/server";

// Service Role Key 사용 (인증 없이 실행)
function createAdminClient() {
  return createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!,
    {
      auth: {
        autoRefreshToken: false,
        persistSession: false,
      },
    }
  );
}

export async function GET(request: Request) {
  // Vercel Cron 인증 확인
  const authHeader = request.headers.get("authorization");
  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  try {
    const supabase = createAdminClient();

    // 간단한 쿼리로 DB 활성화 (profiles 테이블 count)
    const { count, error } = await supabase
      .from("profiles")
      .select("*", { count: "exact", head: true });

    if (error) {
      console.error("Keep-alive query failed:", error);
      return NextResponse.json(
        { error: "Database query failed" },
        { status: 500 }
      );
    }

    console.log(
      `Keep-alive: ${count} profiles found at ${new Date().toISOString()}`
    );

    return NextResponse.json({
      success: true,
      message: "Supabase keep-alive ping successful",
      timestamp: new Date().toISOString(),
    });
  } catch (error) {
    console.error("Keep-alive error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/not-found-back-button.tsx">
'use client';

import { Button } from '@/shared/components/ui/button';
import { ArrowLeft } from 'lucide-react';

export default function NotFoundBackButton() {
  return (
    <Button
      size="lg"
      variant="outline"
      className="min-w-[200px] h-12 border-2 border-primary/30 bg-background/60 backdrop-blur-xl hover:bg-primary/5 hover:border-primary/50 transition-all"
      onClick={() => {
        if (typeof window !== 'undefined') {
          window.history.back();
        }
      }}
    >
      <ArrowLeft className="mr-2 h-5 w-5" />
      이전 페이지로
    </Button>
  );
}
</file>

<file path="src/features/analytics/components/click-analytics.tsx">
"use client";

import { useEffect, useState } from "react";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from "recharts";
import { createClient } from "@/lib/supabase/client";
import { useTheme } from "next-themes";
import { Card, CardContent, CardHeader, CardTitle } from "@/shared/components/ui/card";
import { BarChart3 } from "lucide-react";

interface ClickData {
  slug: string;
  click_count: number;
  original_url: string;
}

export default function ClickAnalytics() {
  const [data, setData] = useState<ClickData[]>([]);
  const [loading, setLoading] = useState(true);
  const { theme } = useTheme();
  const supabase = createClient();

  const isDark = theme === "dark";

  useEffect(() => {
    async function fetchClickData() {
      const { data: links, error } = await supabase
        .from("links")
        .select("slug, click_count, original_url")
        .order("click_count", { ascending: false })
        .limit(10);

      if (error) {
        console.error("Error fetching click data:", error);
        return;
      }

      setData(links);
      setLoading(false);
    }

    fetchClickData();
  }, [supabase]);

  if (loading) {
    return (
      <div className="flex justify-center items-center h-[400px]">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>
    );
  }

  if (data.length === 0) {
    return (
      <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-lg font-bold">
            <div className="p-2 rounded-lg bg-primary/10 text-primary">
              <BarChart3 className="h-5 w-5" />
            </div>
            상위 10개 링크 클릭 수
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-center text-muted-foreground py-10">아직 클릭 데이터가 없습니다.</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
      <CardHeader>
        <CardTitle className="flex items-center gap-2 text-lg font-bold">
          <div className="p-2 rounded-lg bg-primary/10 text-primary">
            <BarChart3 className="h-5 w-5" />
          </div>
          상위 10개 링크 클릭 수
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="h-[400px] w-full">
          <ResponsiveContainer width="100%" height="100%">
            <BarChart data={data}>
              <CartesianGrid
                strokeDasharray="3 3"
                stroke={isDark ? "rgba(255,255,255,0.05)" : "rgba(0,0,0,0.05)"}
                vertical={false}
              />
              <XAxis
                dataKey="slug"
                tick={{ fontSize: 12, fill: isDark ? "#94a3b8" : "#64748b" }}
                interval={0}
                angle={-45}
                textAnchor="end"
                axisLine={false}
                tickLine={false}
                height={60}
              />
              <YAxis
                tick={{ fill: isDark ? "#94a3b8" : "#64748b", fontSize: 12 }}
                axisLine={false}
                tickLine={false}
              />
              <Tooltip
                content={({ active, payload }) => {
                  if (active && payload && payload.length) {
                    const data = payload[0].payload as ClickData;
                    return (
                      <div className="rounded-xl border border-white/20 bg-white/90 dark:bg-black/90 backdrop-blur-md p-4 shadow-xl text-foreground">
                        <p className="font-bold flex items-center gap-2 mb-1">
                          <span className="w-2 h-2 rounded-full bg-primary" />
                          {data.slug}
                        </p>
                        <p className="text-xs text-muted-foreground mb-2 break-all font-mono opacity-80">
                          {data.original_url}
                        </p>
                        <p className="font-semibold text-lg text-primary">{data.click_count.toLocaleString()} 클릭</p>
                      </div>
                    );
                  }
                  return null;
                }}
                cursor={{ fill: isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.02)' }}
              />
              <Bar
                dataKey="click_count"
                fill="#2E6CFF"
                radius={[6, 6, 0, 0]}
                barSize={40}
                className="hover:opacity-90 transition-opacity cursor-pointer"
              />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/features/auth/actions/clerk-user.ts">
"use server";

import { revalidatePath } from "next/cache";
import { ClerkAuthService, UserStatus, UserRole } from "../services/clerk-auth.service";

/**
 * Update user status (admin only)
 */
export async function updateUserStatus(
  userId: string,
  status: UserStatus,
  rejectionReason?: string
) {
  try {
    await ClerkAuthService.updateUserStatus(userId, status, rejectionReason);
    revalidatePath("/admin/users");
    return { success: true };
  } catch (error) {
    console.error("Failed to update user status:", error);
    throw error;
  }
}

/**
 * Update user role (admin only)
 */
export async function updateUserRole(userId: string, role: UserRole) {
  try {
    await ClerkAuthService.updateUserRole(userId, role);
    revalidatePath("/admin/users");
    return { success: true };
  } catch (error) {
    console.error("Failed to update user role:", error);
    throw error;
  }
}

/**
 * Get all users (admin only)
 */
export async function getAllUsers() {
  try {
    return await ClerkAuthService.getUsersByStatus();
  } catch (error) {
    console.error("Failed to get users:", error);
    throw error;
  }
}

/**
 * Get users by status (admin only)
 */
export async function getUsersByStatus(status: UserStatus) {
  try {
    return await ClerkAuthService.getUsersByStatus(status);
  } catch (error) {
    console.error("Failed to get users by status:", error);
    throw error;
  }
}
</file>

<file path="src/features/campaigns/actions/campaign-actions.ts">
"use server";

import { revalidatePath } from "next/cache";
import { CampaignService } from "../services/campaign.service";
import { LinkService } from "@/features/links/actions/link.service";
import type { CreateCampaignDTO, UpdateCampaignDTO } from "../types/campaign";
import type { CreateLinkDTO } from "@/shared/types/link";
import type { LinkTemplate } from "@/features/templates/types/template";

export async function createCampaign(data: CreateCampaignDTO) {
  try {
    const campaign = await CampaignService.createCampaign(data);
    revalidatePath("/admin/campaigns");
    return { success: true, data: campaign };
  } catch (error) {
    console.error("Create campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "캠페인 생성에 실패했습니다.",
    };
  }
}

export async function getCampaign(id: string) {
  try {
    const campaign = await CampaignService.getCampaignById(id);
    return { success: true, data: campaign };
  } catch (error) {
    console.error("Get campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "캠페인 조회에 실패했습니다.",
    };
  }
}

export async function getCampaignWithLinks(id: string) {
  try {
    const campaign = await CampaignService.getCampaignWithLinks(id);
    return { success: true, data: campaign };
  } catch (error) {
    console.error("Get campaign with links error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "캠페인 조회에 실패했습니다.",
    };
  }
}

export async function getCampaigns() {
  try {
    const campaigns = await CampaignService.getCampaignsWithStats();
    return { success: true, data: campaigns };
  } catch (error) {
    console.error("Get campaigns error:", error);
    return {
      success: false,
      error:
        error instanceof Error
          ? error.message
          : "캠페인 목록 조회에 실패했습니다.",
    };
  }
}

export async function updateCampaign(id: string, data: UpdateCampaignDTO) {
  try {
    const campaign = await CampaignService.updateCampaign(id, data);
    revalidatePath("/admin/campaigns");
    revalidatePath(`/admin/campaigns/${id}`);
    return { success: true, data: campaign };
  } catch (error) {
    console.error("Update campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "캠페인 수정에 실패했습니다.",
    };
  }
}

export async function deleteCampaign(id: string) {
  try {
    await CampaignService.deleteCampaign(id);
    revalidatePath("/admin/campaigns");
    return { success: true };
  } catch (error) {
    console.error("Delete campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "캠페인 삭제에 실패했습니다.",
    };
  }
}

export async function addLinkToCampaign(campaignId: string, linkId: string) {
  try {
    await CampaignService.addLinkToCampaign(campaignId, linkId);
    revalidatePath(`/admin/campaigns/${campaignId}`);
    return { success: true };
  } catch (error) {
    console.error("Add link to campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "링크 추가에 실패했습니다.",
    };
  }
}

export async function removeLinkFromCampaign(
  campaignId: string,
  linkId: string
) {
  try {
    await CampaignService.removeLinkFromCampaign(campaignId, linkId);
    revalidatePath(`/admin/campaigns/${campaignId}`);
    return { success: true };
  } catch (error) {
    console.error("Remove link from campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "링크 제거에 실패했습니다.",
    };
  }
}

export async function getAvailableLinks(campaignId: string) {
  try {
    const links = await CampaignService.getAvailableLinksForCampaign(campaignId);
    return { success: true, data: links };
  } catch (error) {
    console.error("Get available links error:", error);
    return {
      success: false,
      error:
        error instanceof Error
          ? error.message
          : "링크 목록 조회에 실패했습니다.",
    };
  }
}

export async function createAndAddLinkToCampaign(
  campaignId: string,
  linkData: CreateLinkDTO
) {
  try {
    // 링크 생성
    const link = await LinkService.createShortLink(linkData);

    // 캠페인에 추가
    await CampaignService.addLinkToCampaign(campaignId, link.id);

    revalidatePath(`/admin/campaigns/${campaignId}`);
    return { success: true, data: link };
  } catch (error) {
    console.error("Create and add link to campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error
          ? error.message
          : "링크 생성 및 추가에 실패했습니다.",
    };
  }
}

export async function createLinksFromTemplatesAndAddToCampaign(
  campaignId: string,
  templates: LinkTemplate[],
  campaignUtmParams: {
    utm_source: string;
    utm_medium: string;
    utm_campaign: string;
    utm_term: string;
    utm_content: string;
  }
) {
  try {
    const createdLinks = [];

    for (const template of templates) {
      // 템플릿 UTM과 캠페인 UTM 병합 (템플릿 값이 있으면 템플릿 우선, 없으면 캠페인 UTM 사용)
      const linkData: CreateLinkDTO = {
        original_url: template.original_url,
        description: template.description || undefined,
        utm_params: {
          utm_source: template.utm_source || campaignUtmParams.utm_source,
          utm_medium: template.utm_medium || campaignUtmParams.utm_medium,
          utm_campaign: template.utm_campaign || campaignUtmParams.utm_campaign,
          utm_term: template.utm_term || campaignUtmParams.utm_term,
          utm_content: template.utm_content || campaignUtmParams.utm_content,
        },
      };

      // 링크 생성
      const link = await LinkService.createShortLink(linkData);

      // 캠페인에 추가
      await CampaignService.addLinkToCampaign(campaignId, link.id);

      createdLinks.push(link);
    }

    revalidatePath(`/admin/campaigns/${campaignId}`);
    return { success: true, data: createdLinks };
  } catch (error) {
    console.error("Create links from templates and add to campaign error:", error);
    return {
      success: false,
      error:
        error instanceof Error
          ? error.message
          : "템플릿에서 링크 생성 및 추가에 실패했습니다.",
    };
  }
}
</file>

<file path="src/features/campaigns/components/add-to-campaign-dialog.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/shared/components/ui/dialog";
import { Button } from "@/shared/components/ui/button";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/shared/components/ui/select";
import { Label } from "@/shared/components/ui/label";
import { Loader2, Plus } from "lucide-react";
import { toast } from "sonner";
import { getCampaigns, addLinkToCampaign } from "../actions/campaign-actions";
import { CampaignStatusBadge } from "./campaign-status-badge";
import type { CampaignWithStats, CampaignStatus } from "../types/campaign";

interface AddToCampaignDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  linkId: string;
  onSuccess?: () => void;
}

export function AddToCampaignDialog({
  open,
  onOpenChange,
  linkId,
  onSuccess,
}: AddToCampaignDialogProps) {
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [selectedCampaignId, setSelectedCampaignId] = useState<string>("");
  const [isLoading, setIsLoading] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);

  useEffect(() => {
    if (open) {
      fetchCampaigns();
    }
  }, [open]);

  const fetchCampaigns = async () => {
    setIsLoading(true);
    try {
      const result = await getCampaigns();
      if (result.success && result.data) {
        // active와 paused 상태의 캠페인만 표시
        const activeCampaigns = result.data.filter(
          (c) => c.status === "active" || c.status === "paused"
        );
        setCampaigns(activeCampaigns);
      }
    } catch (error) {
      console.error("Failed to fetch campaigns:", error);
      toast.error("캠페인 목록을 불러오는데 실패했습니다.");
    } finally {
      setIsLoading(false);
    }
  };

  const handleAdd = async () => {
    if (!selectedCampaignId) {
      toast.error("캠페인을 선택해주세요.");
      return;
    }

    setIsSubmitting(true);
    try {
      const result = await addLinkToCampaign(selectedCampaignId, linkId);

      if (result.success) {
        toast.success("캠페인에 링크가 추가되었습니다.");
        setSelectedCampaignId("");
        onOpenChange(false);
        if (onSuccess) {
          onSuccess();
        }
      } else {
        toast.error(result.error || "링크 추가에 실패했습니다.");
      }
    } catch (error) {
      console.error("Add to campaign error:", error);
      toast.error("링크 추가 중 오류가 발생했습니다.");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>캠페인에 추가</DialogTitle>
          <DialogDescription>
            이 링크를 추가할 캠페인을 선택하세요.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          {isLoading ? (
            <div className="flex items-center justify-center py-8">
              <Loader2 className="h-6 w-6 animate-spin" />
            </div>
          ) : campaigns.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              <p>사용 가능한 캠페인이 없습니다.</p>
              <p className="text-sm mt-2">먼저 캠페인을 생성해주세요.</p>
            </div>
          ) : (
            <div className="space-y-2">
              <Label htmlFor="campaign-select">캠페인 선택</Label>
              <Select
                value={selectedCampaignId}
                onValueChange={setSelectedCampaignId}
              >
                <SelectTrigger id="campaign-select">
                  <SelectValue placeholder="캠페인을 선택하세요" />
                </SelectTrigger>
                <SelectContent>
                  {campaigns.map((campaign) => (
                    <SelectItem key={campaign.id} value={campaign.id}>
                      <div className="flex items-center gap-2">
                        <span>{campaign.name}</span>
                        <CampaignStatusBadge
                          status={campaign.status as CampaignStatus}
                        />
                      </div>
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
          )}
        </div>

        <DialogFooter>
          <Button
            variant="outline"
            onClick={() => onOpenChange(false)}
            disabled={isSubmitting}
          >
            취소
          </Button>
          <Button
            onClick={handleAdd}
            disabled={isSubmitting || isLoading || campaigns.length === 0}
          >
            {isSubmitting ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                추가 중...
              </>
            ) : (
              <>
                <Plus className="h-4 w-4 mr-2" />
                추가
              </>
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/features/campaigns/components/campaign-detail.tsx">
"use client";

import { useState } from "react";
import Link from "next/link";
import { Card, CardContent, CardHeader, CardTitle } from "@/shared/components/ui/card";
import { Button } from "@/shared/components/ui/button";
import { Badge } from "@/shared/components/ui/badge";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/shared/components/ui/alert-dialog";
import {
  Edit,
  ExternalLink,
  Copy,
  Trash2,
  Link2,
  MousePointerClick,
  Plus,
} from "lucide-react";
import { toast } from "sonner";
import { removeLinkFromCampaign } from "../actions/campaign-actions";
import { CampaignStatusBadge } from "./campaign-status-badge";
import { CampaignLinkSelector } from "./campaign-link-selector";
import { isYouTubeUrl, getYouTubeVideoId } from "@/features/links/utils/youtube";
import { YouTubeThumbnail } from "@/features/links/components/youtube/youtube-thumbnail";
import { YouTubeEmbed } from "@/features/links/components/youtube/youtube-embed";
import type { CampaignWithLinks, CampaignStatus } from "../types/campaign";
import type { Link as LinkType } from "@/shared/types/link";
import { getBaseUrl } from "@/lib/url";

interface CampaignDetailProps {
  campaign: CampaignWithLinks;
}

export function CampaignDetail({ campaign: initialCampaign }: CampaignDetailProps) {
  const [campaign, setCampaign] = useState(initialCampaign);
  const [expandedYouTube, setExpandedYouTube] = useState<string | null>(null);
  const [showLinkSelector, setShowLinkSelector] = useState(false);

  const baseUrl = getBaseUrl();

  const handleRemoveLink = async (linkId: string) => {
    const result = await removeLinkFromCampaign(campaign.id, linkId);

    if (result.success) {
      setCampaign({
        ...campaign,
        links: campaign.links.filter((l) => l.id !== linkId),
      });
      toast.success("링크가 캠페인에서 제거되었습니다.");
    } else {
      toast.error(result.error || "링크 제거에 실패했습니다.");
    }
  };

  const handleLinkAdded = (link: LinkType) => {
    setCampaign({
      ...campaign,
      links: [link, ...campaign.links],
    });
    setShowLinkSelector(false);
  };

  const handleLinksAdded = (links: LinkType[]) => {
    setCampaign({
      ...campaign,
      links: [...links, ...campaign.links],
    });
    setShowLinkSelector(false);
  };

  const copyToClipboard = async (text: string) => {
    try {
      await navigator.clipboard.writeText(text);
      toast.success("클립보드에 복사되었습니다.");
    } catch {
      toast.error("복사에 실패했습니다.");
    }
  };

  const formatDate = (dateString: string | null) => {
    if (!dateString) return "-";
    return new Date(dateString).toISOString().split("T")[0];
  };

  const totalClicks = campaign.links.reduce(
    (sum, link) => sum + (link.click_count || 0),
    0
  );

  return (
    <div className="space-y-6">
      {/* 캠페인 소스 (유튜브 임베딩) */}
      {campaign.source_url && isYouTubeUrl(campaign.source_url) && (
        <Card>
          <CardHeader>
            <CardTitle>캠페인 소스</CardTitle>
          </CardHeader>
          <CardContent>
            <YouTubeEmbed
              videoId={getYouTubeVideoId(campaign.source_url) || ""}
              title={campaign.name}
            />
          </CardContent>
        </Card>
      )}

      {/* 캠페인 정보 */}
      <Card>
        <CardHeader className="flex flex-row items-start justify-between">
          <div>
            <div className="flex items-center gap-2 mb-2">
              <CardTitle className="text-2xl">{campaign.name}</CardTitle>
              <CampaignStatusBadge status={campaign.status as CampaignStatus} />
            </div>
            {campaign.description && (
              <p className="text-muted-foreground">{campaign.description}</p>
            )}
          </div>
          <Link href={`/admin/campaigns/${campaign.id}/edit`}>
            <Button variant="outline" size="sm">
              <Edit className="h-4 w-4 mr-2" />
              수정
            </Button>
          </Link>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div className="text-center p-4 bg-muted/30 rounded-lg">
              <div className="flex items-center justify-center gap-2 text-muted-foreground mb-1">
                <Link2 className="h-4 w-4" />
                <span className="text-sm">링크 수</span>
              </div>
              <p className="text-2xl font-bold">{campaign.links.length}</p>
            </div>
            <div className="text-center p-4 bg-muted/30 rounded-lg">
              <div className="flex items-center justify-center gap-2 text-muted-foreground mb-1">
                <MousePointerClick className="h-4 w-4" />
                <span className="text-sm">총 클릭</span>
              </div>
              <p className="text-2xl font-bold">{totalClicks}</p>
            </div>
            <div className="text-center p-4 bg-muted/30 rounded-lg">
              <div className="text-muted-foreground text-sm mb-1">생성일</div>
              <p className="text-lg font-medium">{formatDate(campaign.created_at)}</p>
            </div>
            <div className="text-center p-4 bg-muted/30 rounded-lg">
              <div className="text-muted-foreground text-sm mb-1">수정일</div>
              <p className="text-lg font-medium">{formatDate(campaign.updated_at)}</p>
            </div>
          </div>

          {/* UTM 정보 */}
          {(campaign.utm_source ||
            campaign.utm_medium ||
            campaign.utm_campaign) && (
            <div className="mt-4 pt-4 border-t">
              <h4 className="text-sm font-medium mb-2">기본 UTM 파라미터</h4>
              <div className="flex flex-wrap gap-2">
                {campaign.utm_source && (
                  <Badge variant="outline">source: {campaign.utm_source}</Badge>
                )}
                {campaign.utm_medium && (
                  <Badge variant="outline">medium: {campaign.utm_medium}</Badge>
                )}
                {campaign.utm_campaign && (
                  <Badge variant="outline">campaign: {campaign.utm_campaign}</Badge>
                )}
                {campaign.utm_term && (
                  <Badge variant="outline">term: {campaign.utm_term}</Badge>
                )}
                {campaign.utm_content && (
                  <Badge variant="outline">content: {campaign.utm_content}</Badge>
                )}
              </div>
            </div>
          )}
        </CardContent>
      </Card>

      {/* 링크 목록 */}
      <Card>
        <CardHeader className="flex flex-row items-center justify-between">
          <CardTitle>캠페인 링크</CardTitle>
          <Button onClick={() => setShowLinkSelector(true)}>
            <Plus className="h-4 w-4 mr-2" />
            링크 추가
          </Button>
        </CardHeader>
        <CardContent>
          {campaign.links.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              <p className="mb-4">아직 추가된 링크가 없습니다.</p>
              <Button variant="outline" onClick={() => setShowLinkSelector(true)}>
                <Plus className="h-4 w-4 mr-2" />
                첫 링크 추가하기
              </Button>
            </div>
          ) : (
            <div className="space-y-4">
              {campaign.links.map((link) => (
                <div
                  key={link.id}
                  className="border rounded-lg p-4 hover:bg-muted/30"
                >
                  <div className="flex justify-between items-start">
                    <div className="flex-1 mr-4">
                      <div className="flex items-center gap-3">
                        {isYouTubeUrl(link.original_url) && (
                          <YouTubeThumbnail
                            videoId={getYouTubeVideoId(link.original_url) || ""}
                            size="sm"
                            onClick={() =>
                              setExpandedYouTube(
                                expandedYouTube === link.id ? null : link.id
                              )
                            }
                          />
                        )}
                        <div className="flex-1">
                          <p className="font-medium break-all">
                            {link.original_url}
                          </p>
                          {link.description && (
                            <p className="text-sm text-muted-foreground mt-1">
                              {link.description}
                            </p>
                          )}
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mt-2">
                        <p className="text-sm text-muted-foreground">
                          {baseUrl}/{link.slug}
                        </p>
                        <Button
                          size="sm"
                          variant="ghost"
                          onClick={() => copyToClipboard(`${baseUrl}/${link.slug}`)}
                        >
                          <Copy className="h-3 w-3" />
                        </Button>
                        <Button
                          size="sm"
                          variant="ghost"
                          onClick={() =>
                            window.open(`${baseUrl}/${link.slug}`, "_blank")
                          }
                        >
                          <ExternalLink className="h-3 w-3" />
                        </Button>
                      </div>
                    </div>
                    <div className="text-right">
                      <p className="font-medium">{link.click_count || 0} 클릭</p>
                      <p className="text-xs text-muted-foreground">
                        {formatDate(link.created_at || null)}
                      </p>
                      <AlertDialog>
                        <AlertDialogTrigger asChild>
                          <Button
                            size="sm"
                            variant="ghost"
                            className="mt-2 text-destructive hover:text-destructive"
                          >
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </AlertDialogTrigger>
                        <AlertDialogContent>
                          <AlertDialogHeader>
                            <AlertDialogTitle>링크 제거</AlertDialogTitle>
                            <AlertDialogDescription>
                              이 링크를 캠페인에서 제거하시겠습니까? 링크 자체는
                              삭제되지 않습니다.
                            </AlertDialogDescription>
                          </AlertDialogHeader>
                          <AlertDialogFooter>
                            <AlertDialogCancel>취소</AlertDialogCancel>
                            <AlertDialogAction
                              onClick={() => handleRemoveLink(link.id)}
                            >
                              제거
                            </AlertDialogAction>
                          </AlertDialogFooter>
                        </AlertDialogContent>
                      </AlertDialog>
                    </div>
                  </div>

                  {/* YouTube 임베드 */}
                  {expandedYouTube === link.id &&
                    isYouTubeUrl(link.original_url) && (
                      <div className="mt-4 pt-4 border-t">
                        <YouTubeEmbed
                          videoId={getYouTubeVideoId(link.original_url) || ""}
                          title={link.description || undefined}
                          className="max-w-2xl"
                        />
                      </div>
                    )}
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* 링크 선택 다이얼로그 */}
      {showLinkSelector && (
        <CampaignLinkSelector
          campaignId={campaign.id}
          campaign={campaign}
          onClose={() => setShowLinkSelector(false)}
          onLinkAdded={handleLinkAdded}
          onLinksAdded={handleLinksAdded}
        />
      )}
    </div>
  );
}
</file>

<file path="src/features/campaigns/components/campaign-form.tsx">
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Textarea } from "@/shared/components/ui/textarea";
import { Card, CardContent, CardHeader, CardTitle } from "@/shared/components/ui/card";
import { Label } from "@/shared/components/ui/label";
import { Alert, AlertDescription } from "@/shared/components/ui/alert";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/shared/components/ui/select";
import { Loader2, Save, ArrowLeft } from "lucide-react";
import { toast } from "sonner";
import { createCampaign, updateCampaign } from "../actions/campaign-actions";
import type {
  Campaign,
  CampaignStatus,
  CreateCampaignDTO,
  UpdateCampaignDTO,
} from "../types/campaign";

interface CampaignFormProps {
  campaign?: Campaign;
  mode: "create" | "edit";
}

const STATUS_OPTIONS: { value: CampaignStatus; label: string }[] = [
  { value: "active", label: "활성" },
  { value: "paused", label: "일시정지" },
  { value: "archived", label: "보관됨" },
];

export function CampaignForm({ campaign, mode }: CampaignFormProps) {
  const router = useRouter();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const [formData, setFormData] = useState({
    name: campaign?.name || "",
    description: campaign?.description || "",
    status: (campaign?.status as CampaignStatus) || "active",
    source_url: campaign?.source_url || "",
    utm_source: campaign?.utm_source || "",
    utm_medium: campaign?.utm_medium || "",
    utm_campaign: campaign?.utm_campaign || "",
    utm_term: campaign?.utm_term || "",
    utm_content: campaign?.utm_content || "",
  });

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleStatusChange = (value: string) => {
    setFormData((prev) => ({ ...prev, status: value as CampaignStatus }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setIsSubmitting(true);

    try {
      if (!formData.name.trim()) {
        throw new Error("캠페인 이름을 입력해주세요.");
      }

      const utm_params = {
        utm_source: formData.utm_source,
        utm_medium: formData.utm_medium,
        utm_campaign: formData.utm_campaign,
        utm_term: formData.utm_term,
        utm_content: formData.utm_content,
      };

      if (mode === "create") {
        const data: CreateCampaignDTO = {
          name: formData.name,
          description: formData.description || undefined,
          status: formData.status,
          source_url: formData.source_url || undefined,
          utm_params,
        };
        const result = await createCampaign(data);

        if (!result.success) {
          throw new Error(result.error);
        }

        toast.success("캠페인이 생성되었습니다.");
        router.push("/admin/campaigns");
      } else if (campaign) {
        const data: UpdateCampaignDTO = {
          name: formData.name,
          description: formData.description || undefined,
          status: formData.status,
          source_url: formData.source_url || undefined,
          utm_params,
        };
        const result = await updateCampaign(campaign.id, data);

        if (!result.success) {
          throw new Error(result.error);
        }

        toast.success("캠페인이 수정되었습니다.");
        router.push(`/admin/campaigns/${campaign.id}`);
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : "오류가 발생했습니다.");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {error && (
        <Alert variant="destructive">
          <AlertDescription>{error}</AlertDescription>
        </Alert>
      )}

      <Card>
        <CardHeader>
          <CardTitle>기본 정보</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="name">캠페인 이름 *</Label>
            <Input
              id="name"
              name="name"
              value={formData.name}
              onChange={handleChange}
              placeholder="예: 2024 블랙프라이데이 프로모션"
              required
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="description">설명</Label>
            <Textarea
              id="description"
              name="description"
              value={formData.description}
              onChange={handleChange}
              placeholder="캠페인에 대한 설명을 입력하세요"
              rows={3}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="status">상태</Label>
            <Select
              value={formData.status}
              onValueChange={handleStatusChange}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {STATUS_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div className="space-y-2">
            <Label htmlFor="source_url">캠페인 소스 URL</Label>
            <Input
              id="source_url"
              name="source_url"
              value={formData.source_url}
              onChange={handleChange}
              placeholder="예: https://youtube.com/watch?v=..."
            />
            <p className="text-xs text-muted-foreground">
              캠페인 소스 (유튜브 영상, 랜딩 페이지 등)
            </p>
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>기본 UTM 파라미터</CardTitle>
          <p className="text-sm text-muted-foreground">
            캠페인에 추가되는 링크에 적용할 기본 UTM 값을 설정하세요
          </p>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label htmlFor="utm_source">utm_source</Label>
              <Input
                id="utm_source"
                name="utm_source"
                value={formData.utm_source}
                onChange={handleChange}
                placeholder="google, newsletter, facebook"
              />
              <p className="text-xs text-muted-foreground">트래픽 소스</p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="utm_medium">utm_medium</Label>
              <Input
                id="utm_medium"
                name="utm_medium"
                value={formData.utm_medium}
                onChange={handleChange}
                placeholder="cpc, banner, email"
              />
              <p className="text-xs text-muted-foreground">마케팅 매체</p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="utm_campaign">utm_campaign</Label>
              <Input
                id="utm_campaign"
                name="utm_campaign"
                value={formData.utm_campaign}
                onChange={handleChange}
                placeholder="spring_sale, product_launch"
              />
              <p className="text-xs text-muted-foreground">캠페인 이름</p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="utm_term">utm_term</Label>
              <Input
                id="utm_term"
                name="utm_term"
                value={formData.utm_term}
                onChange={handleChange}
                placeholder="키워드"
              />
              <p className="text-xs text-muted-foreground">검색 키워드 (선택)</p>
            </div>

            <div className="space-y-2 md:col-span-2">
              <Label htmlFor="utm_content">utm_content</Label>
              <Input
                id="utm_content"
                name="utm_content"
                value={formData.utm_content}
                onChange={handleChange}
                placeholder="광고 콘텐츠 식별자"
              />
              <p className="text-xs text-muted-foreground">광고 콘텐츠 구분 (선택)</p>
            </div>
          </div>
        </CardContent>
      </Card>

      <div className="flex justify-between">
        <Button
          type="button"
          variant="outline"
          onClick={() => router.back()}
          disabled={isSubmitting}
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          취소
        </Button>
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting ? (
            <Loader2 className="h-4 w-4 mr-2 animate-spin" />
          ) : (
            <Save className="h-4 w-4 mr-2" />
          )}
          {mode === "create" ? "생성" : "저장"}
        </Button>
      </div>
    </form>
  );
}
</file>

<file path="src/features/campaigns/components/campaign-link-selector.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/shared/components/ui/dialog";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Textarea } from "@/shared/components/ui/textarea";
import { Label } from "@/shared/components/ui/label";
import { ScrollArea } from "@/shared/components/ui/scroll-area";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/shared/components/ui/tabs";
import { Checkbox } from "@/shared/components/ui/checkbox";
import { Loader2, Search, Plus, Link2, FileText, Sparkles } from "lucide-react";
import { toast } from "sonner";
import {
  getAvailableLinks,
  addLinkToCampaign,
  createAndAddLinkToCampaign,
  createLinksFromTemplatesAndAddToCampaign,
} from "../actions/campaign-actions";
import { getTemplates } from "@/features/templates/actions/template-actions";
import type { Link } from "@/shared/types/link";
import type { LinkTemplate } from "@/features/templates/types/template";
import type { CreateLinkDTO } from "@/shared/types/link";
import type { Campaign } from "../types/campaign";

interface CampaignLinkSelectorProps {
  campaignId: string;
  campaign: Campaign;
  onClose: () => void;
  onLinkAdded: (link: Link) => void;
  onLinksAdded?: (links: Link[]) => void;
}

export function CampaignLinkSelector({
  campaignId,
  campaign,
  onClose,
  onLinkAdded,
  onLinksAdded,
}: CampaignLinkSelectorProps) {
  // 기존 링크 관련 상태
  const [links, setLinks] = useState<Link[]>([]);
  const [filteredLinks, setFilteredLinks] = useState<Link[]>([]);
  const [isLoadingLinks, setIsLoadingLinks] = useState(true);
  const [searchQuery, setSearchQuery] = useState("");
  const [addingLinkId, setAddingLinkId] = useState<string | null>(null);

  // 새 링크 생성 관련 상태
  const [newLinkUrl, setNewLinkUrl] = useState("");
  const [newLinkDescription, setNewLinkDescription] = useState("");
  const [isCreatingLink, setIsCreatingLink] = useState(false);

  // 템플릿 관련 상태
  const [templates, setTemplates] = useState<LinkTemplate[]>([]);
  const [isLoadingTemplates, setIsLoadingTemplates] = useState(true);
  const [selectedTemplateIds, setSelectedTemplateIds] = useState<Set<string>>(new Set());
  const [isAddingTemplates, setIsAddingTemplates] = useState(false);

  // 캠페인 기본 UTM 파라미터
  const campaignUtmParams = {
    utm_source: campaign.utm_source || "",
    utm_medium: campaign.utm_medium || "",
    utm_campaign: campaign.utm_campaign || "",
    utm_term: campaign.utm_term || "",
    utm_content: campaign.utm_content || "",
  };

  // 기존 링크 목록 로드
  useEffect(() => {
    const fetchLinks = async () => {
      try {
        const result = await getAvailableLinks(campaignId);
        if (result.success && result.data) {
          setLinks(result.data);
          setFilteredLinks(result.data);
        }
      } catch (error) {
        console.error("Failed to fetch links:", error);
        toast.error("링크 목록을 불러오는데 실패했습니다.");
      } finally {
        setIsLoadingLinks(false);
      }
    };

    fetchLinks();
  }, [campaignId]);

  // 템플릿 목록 로드
  useEffect(() => {
    const fetchTemplates = async () => {
      try {
        const result = await getTemplates();
        if (result.success && result.data) {
          setTemplates(result.data);
        }
      } catch (error) {
        console.error("Failed to fetch templates:", error);
        toast.error("템플릿 목록을 불러오는데 실패했습니다.");
      } finally {
        setIsLoadingTemplates(false);
      }
    };

    fetchTemplates();
  }, []);

  // 검색 필터
  useEffect(() => {
    const query = searchQuery.toLowerCase();
    const filtered = links.filter(
      (link) =>
        link.original_url.toLowerCase().includes(query) ||
        link.slug.toLowerCase().includes(query) ||
        link.description?.toLowerCase().includes(query)
    );
    setFilteredLinks(filtered);
  }, [searchQuery, links]);

  // 기존 링크 추가
  const handleAddLink = async (link: Link) => {
    setAddingLinkId(link.id);

    try {
      const result = await addLinkToCampaign(campaignId, link.id);

      if (result.success) {
        toast.success("링크가 캠페인에 추가되었습니다.");
        onLinkAdded(link);
        setLinks(links.filter((l) => l.id !== link.id));
        setFilteredLinks(filteredLinks.filter((l) => l.id !== link.id));
      } else {
        toast.error(result.error || "링크 추가에 실패했습니다.");
      }
    } catch {
      toast.error("링크 추가 중 오류가 발생했습니다.");
    } finally {
      setAddingLinkId(null);
    }
  };

  // 새 링크 생성 및 추가 (캠페인 UTM 자동 적용)
  const handleCreateNewLink = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!newLinkUrl.trim()) {
      toast.error("URL을 입력해주세요.");
      return;
    }

    setIsCreatingLink(true);

    try {
      const linkData: CreateLinkDTO = {
        original_url: newLinkUrl,
        description: newLinkDescription || undefined,
        utm_params: campaignUtmParams,
      };

      const result = await createAndAddLinkToCampaign(campaignId, linkData);

      if (result.success && result.data) {
        toast.success("링크가 생성되어 캠페인에 추가되었습니다.");
        onLinkAdded(result.data);
        setNewLinkUrl("");
        setNewLinkDescription("");
      } else {
        toast.error(result.error || "링크 생성에 실패했습니다.");
      }
    } catch {
      toast.error("링크 생성 중 오류가 발생했습니다.");
    } finally {
      setIsCreatingLink(false);
    }
  };

  // 템플릿 선택 토글
  const handleTemplateToggle = (templateId: string, checked: boolean) => {
    const newSet = new Set(selectedTemplateIds);
    if (checked) {
      newSet.add(templateId);
    } else {
      newSet.delete(templateId);
    }
    setSelectedTemplateIds(newSet);
  };

  // 전체 선택/해제
  const handleSelectAllTemplates = (checked: boolean) => {
    if (checked) {
      setSelectedTemplateIds(new Set(templates.map((t) => t.id)));
    } else {
      setSelectedTemplateIds(new Set());
    }
  };

  // 선택한 템플릿들로 링크 일괄 생성 및 추가
  const handleAddSelectedTemplates = async () => {
    if (selectedTemplateIds.size === 0) {
      toast.error("템플릿을 선택해주세요.");
      return;
    }

    setIsAddingTemplates(true);

    try {
      const selectedTemplates = templates.filter((t) =>
        selectedTemplateIds.has(t.id)
      );

      const result = await createLinksFromTemplatesAndAddToCampaign(
        campaignId,
        selectedTemplates,
        campaignUtmParams
      );

      if (result.success && result.data) {
        toast.success(
          `${result.data.length}개의 링크가 캠페인에 추가되었습니다.`
        );
        // 다중 링크 콜백이 있으면 배열로 한 번에 전달, 없으면 개별 호출
        if (onLinksAdded) {
          onLinksAdded(result.data);
        } else {
          result.data.forEach((link) => onLinkAdded(link));
        }
        setSelectedTemplateIds(new Set());
      } else {
        toast.error(result.error || "링크 생성에 실패했습니다.");
      }
    } catch {
      toast.error("링크 생성 중 오류가 발생했습니다.");
    } finally {
      setIsAddingTemplates(false);
    }
  };

  return (
    <Dialog open onOpenChange={() => onClose()}>
      <DialogContent className="max-w-3xl max-h-[85vh] flex flex-col">
        <DialogHeader>
          <DialogTitle>캠페인에 링크 추가</DialogTitle>
          <DialogDescription>
            기존 링크를 선택하거나, 새 링크를 생성하거나, 템플릿에서 선택하세요
          </DialogDescription>
        </DialogHeader>

        <Tabs defaultValue="existing" className="flex-1 flex flex-col min-h-0">
          <TabsList className="grid w-full grid-cols-3 bg-muted dark:bg-white/5">
            <TabsTrigger value="existing" className="flex items-center gap-2 data-[state=active]:bg-background dark:data-[state=active]:bg-white/15 data-[state=active]:text-foreground">
              <Link2 className="h-4 w-4" />
              기존 링크
            </TabsTrigger>
            <TabsTrigger value="new" className="flex items-center gap-2 data-[state=active]:bg-background dark:data-[state=active]:bg-white/15 data-[state=active]:text-foreground">
              <Sparkles className="h-4 w-4" />
              새 링크
            </TabsTrigger>
            <TabsTrigger value="template" className="flex items-center gap-2 data-[state=active]:bg-background dark:data-[state=active]:bg-white/15 data-[state=active]:text-foreground">
              <FileText className="h-4 w-4" />
              템플릿
            </TabsTrigger>
          </TabsList>

          {/* 기존 링크 탭 */}
          <TabsContent value="existing" className="flex-1 flex flex-col min-h-0 space-y-4">
            <div className="relative">
              <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
              <Input
                placeholder="URL, 슬러그 또는 설명으로 검색..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="pl-9"
              />
            </div>

            {isLoadingLinks ? (
              <div className="flex items-center justify-center py-8">
                <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
              </div>
            ) : filteredLinks.length === 0 ? (
              <div className="text-center py-8 text-muted-foreground">
                {searchQuery ? (
                  <p>검색 결과가 없습니다.</p>
                ) : (
                  <p>추가 가능한 링크가 없습니다.</p>
                )}
              </div>
            ) : (
              <ScrollArea className="flex-1 pr-4">
                <div className="space-y-2">
                  {filteredLinks.map((link) => (
                    <div
                      key={link.id}
                      className="flex items-center justify-between p-3 border rounded-lg hover:bg-muted/30"
                    >
                      <div className="flex-1 min-w-0 mr-4">
                        <div className="flex items-center gap-2">
                          <Link2 className="h-4 w-4 flex-shrink-0 text-muted-foreground" />
                          <p className="font-medium truncate">{link.slug}</p>
                        </div>
                        <p className="text-sm text-muted-foreground truncate mt-1">
                          {link.original_url}
                        </p>
                        {link.description && (
                          <p className="text-xs text-muted-foreground truncate mt-1">
                            {link.description}
                          </p>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        <span className="text-sm text-muted-foreground">
                          {link.click_count || 0} 클릭
                        </span>
                        <Button
                          size="sm"
                          onClick={() => handleAddLink(link)}
                          disabled={addingLinkId === link.id}
                        >
                          {addingLinkId === link.id ? (
                            <Loader2 className="h-4 w-4 animate-spin" />
                          ) : (
                            <Plus className="h-4 w-4" />
                          )}
                        </Button>
                      </div>
                    </div>
                  ))}
                </div>
              </ScrollArea>
            )}
          </TabsContent>

          {/* 새 링크 탭 */}
          <TabsContent value="new" className="flex-1 flex flex-col space-y-4">
            <form onSubmit={handleCreateNewLink} className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="new-url">URL *</Label>
                <Input
                  id="new-url"
                  type="url"
                  placeholder="https://example.com"
                  value={newLinkUrl}
                  onChange={(e) => setNewLinkUrl(e.target.value)}
                  required
                />
              </div>

              <div className="space-y-2">
                <Label htmlFor="new-description">설명 (선택)</Label>
                <Textarea
                  id="new-description"
                  placeholder="링크에 대한 설명을 입력하세요"
                  value={newLinkDescription}
                  onChange={(e) => setNewLinkDescription(e.target.value)}
                  rows={3}
                />
              </div>

              <Button
                type="submit"
                className="w-full"
                disabled={isCreatingLink}
              >
                {isCreatingLink ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    생성 중...
                  </>
                ) : (
                  <>
                    <Plus className="h-4 w-4 mr-2" />
                    링크 생성 및 추가
                  </>
                )}
              </Button>
            </form>
          </TabsContent>

          {/* 템플릿 탭 */}
          <TabsContent value="template" className="flex-1 flex flex-col min-h-0 space-y-4">
            {isLoadingTemplates ? (
              <div className="flex items-center justify-center py-8">
                <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
              </div>
            ) : templates.length === 0 ? (
              <div className="text-center py-8 text-muted-foreground">
                <p>저장된 템플릿이 없습니다.</p>
              </div>
            ) : (
              <>
                {/* 상단 컨트롤 */}
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Checkbox
                      id="select-all"
                      checked={selectedTemplateIds.size === templates.length}
                      onCheckedChange={handleSelectAllTemplates}
                    />
                    <Label htmlFor="select-all" className="text-sm cursor-pointer">
                      전체 선택 ({selectedTemplateIds.size}/{templates.length})
                    </Label>
                  </div>
                  <Button
                    size="sm"
                    onClick={handleAddSelectedTemplates}
                    disabled={selectedTemplateIds.size === 0 || isAddingTemplates}
                  >
                    {isAddingTemplates ? (
                      <>
                        <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                        추가 중...
                      </>
                    ) : (
                      <>
                        <Plus className="h-4 w-4 mr-2" />
                        선택한 템플릿 추가 ({selectedTemplateIds.size})
                      </>
                    )}
                  </Button>
                </div>

                {/* 템플릿 목록 */}
                <ScrollArea className="flex-1 pr-4">
                  <div className="space-y-2">
                    {templates.map((template) => (
                      <div
                        key={template.id}
                        className={`flex items-center p-3 border rounded-lg hover:bg-muted/30 cursor-pointer ${
                          selectedTemplateIds.has(template.id)
                            ? "border-primary bg-primary/5"
                            : ""
                        }`}
                        onClick={() =>
                          handleTemplateToggle(
                            template.id,
                            !selectedTemplateIds.has(template.id)
                          )
                        }
                      >
                        <Checkbox
                          checked={selectedTemplateIds.has(template.id)}
                          onCheckedChange={(checked) =>
                            handleTemplateToggle(template.id, !!checked)
                          }
                          onClick={(e) => e.stopPropagation()}
                          className="mr-3"
                        />
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <FileText className="h-4 w-4 flex-shrink-0 text-muted-foreground" />
                            <p className="font-medium truncate">{template.name}</p>
                          </div>
                          <p className="text-sm text-muted-foreground truncate mt-1">
                            {template.original_url}
                          </p>
                          {template.description && (
                            <p className="text-xs text-muted-foreground truncate mt-1">
                              {template.description}
                            </p>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </ScrollArea>
              </>
            )}
          </TabsContent>
        </Tabs>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/features/campaigns/components/campaign-list.tsx">
"use client";

import { useState } from "react";
import Link from "next/link";
import { Card, CardContent } from "@/shared/components/ui/card";
import { Button } from "@/shared/components/ui/button";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/shared/components/ui/alert-dialog";
import { Badge } from "@/shared/components/ui/badge";
import { Eye, Edit, Trash2, Link2, MousePointerClick, Plus } from "lucide-react";
import { toast } from "sonner";
import { deleteCampaign } from "../actions/campaign-actions";
import { CampaignStatusBadge } from "./campaign-status-badge";
import type { CampaignWithStats, CampaignStatus } from "../types/campaign";

interface CampaignListProps {
  initialCampaigns: CampaignWithStats[];
}

export function CampaignList({ initialCampaigns }: CampaignListProps) {
  const [campaigns, setCampaigns] = useState(initialCampaigns);

  const handleDelete = async (id: string) => {
    const result = await deleteCampaign(id);

    if (result.success) {
      setCampaigns(campaigns.filter((c) => c.id !== id));
      toast.success("캠페인이 삭제되었습니다.");
    } else {
      toast.error(result.error || "캠페인 삭제에 실패했습니다.");
    }
  };

  const formatDate = (dateString: string | null) => {
    if (!dateString) return "-";
    return new Date(dateString).toISOString().split("T")[0];
  };

  const hasUTMParams = (campaign: CampaignWithStats): boolean => {
    return !!(
      campaign.utm_source ||
      campaign.utm_medium ||
      campaign.utm_campaign ||
      campaign.utm_term ||
      campaign.utm_content
    );
  };

  if (campaigns.length === 0) {
    return (
      <Card className="border-none shadow-sm bg-white/50 dark:bg-white/5">
        <CardContent className="flex flex-col items-center justify-center py-12">
          <p className="text-muted-foreground mb-4">
            아직 생성된 캠페인이 없습니다.
          </p>
          <Link href="/admin/campaigns/new">
            <Button>
              <Plus className="h-4 w-4 mr-2" />
              첫 캠페인 만들기
            </Button>
          </Link>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="grid gap-4">
      {campaigns.map((campaign) => (
        <Card
          key={campaign.id}
          className="border-black/5 dark:border-white/5 hover:bg-muted/50 dark:hover:bg-white/5 shadow-sm transition-all"
        >
          <CardContent className="p-4">
            <div className="flex justify-between items-start">
              <div className="flex-1 mr-4">
                <div className="flex items-center gap-2 mb-2">
                  <Link
                    href={`/admin/campaigns/${campaign.id}`}
                    className="font-semibold text-lg hover:underline"
                  >
                    {campaign.name}
                  </Link>
                  <CampaignStatusBadge status={campaign.status as CampaignStatus} />
                  {hasUTMParams(campaign) && (
                    <Badge variant="outline" className="text-xs">
                      UTM
                    </Badge>
                  )}
                </div>

                {campaign.description && (
                  <p className="text-sm text-muted-foreground mb-2">
                    {campaign.description}
                  </p>
                )}

                <div className="flex items-center gap-4 text-sm">
                  <div className="flex items-center gap-1 text-muted-foreground">
                    <Link2 className="h-4 w-4" />
                    <span>{campaign.total_links} 링크</span>
                  </div>
                  <div className="flex items-center gap-1 text-muted-foreground">
                    <MousePointerClick className="h-4 w-4" />
                    <span>{campaign.total_clicks} 클릭</span>
                  </div>
                </div>

                <p className="text-xs text-muted-foreground mt-2">
                  생성일: {formatDate(campaign.created_at)}
                </p>
              </div>

              <div className="flex gap-2">
                <Link href={`/admin/campaigns/${campaign.id}`}>
                  <Button size="sm" variant="outline">
                    <Eye className="h-4 w-4" />
                  </Button>
                </Link>
                <Link href={`/admin/campaigns/${campaign.id}/edit`}>
                  <Button size="sm" variant="outline">
                    <Edit className="h-4 w-4" />
                  </Button>
                </Link>
                <AlertDialog>
                  <AlertDialogTrigger asChild>
                    <Button size="sm" variant="destructive">
                      <Trash2 className="h-4 w-4" />
                    </Button>
                  </AlertDialogTrigger>
                  <AlertDialogContent>
                    <AlertDialogHeader>
                      <AlertDialogTitle>캠페인 삭제</AlertDialogTitle>
                      <AlertDialogDescription>
                        &quot;{campaign.name}&quot; 캠페인을 삭제하시겠습니까?
                        캠페인에 연결된 링크들은 삭제되지 않습니다.
                      </AlertDialogDescription>
                    </AlertDialogHeader>
                    <AlertDialogFooter>
                      <AlertDialogCancel>취소</AlertDialogCancel>
                      <AlertDialogAction onClick={() => handleDelete(campaign.id)}>
                        삭제
                      </AlertDialogAction>
                    </AlertDialogFooter>
                  </AlertDialogContent>
                </AlertDialog>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
</file>

<file path="src/features/campaigns/components/campaign-status-badge.tsx">
import { Badge } from "@/shared/components/ui/badge";
import {
  CAMPAIGN_STATUS_LABELS,
  CAMPAIGN_STATUS_COLORS,
  type CampaignStatus,
} from "../types/campaign";

interface CampaignStatusBadgeProps {
  status: CampaignStatus | null;
}

export function CampaignStatusBadge({ status }: CampaignStatusBadgeProps) {
  const effectiveStatus = status || "active";

  return (
    <Badge
      variant="secondary"
      className={CAMPAIGN_STATUS_COLORS[effectiveStatus]}
    >
      {CAMPAIGN_STATUS_LABELS[effectiveStatus]}
    </Badge>
  );
}
</file>

<file path="src/features/campaigns/services/campaign.service.ts">
import { createClient } from "@/lib/supabase/server";
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import type {
  Campaign,
  CampaignWithStats,
  CampaignWithLinks,
  CreateCampaignDTO,
  UpdateCampaignDTO,
} from "../types/campaign";
import type { Link } from "@/shared/types/link";

export class CampaignService {
  private static TABLE_NAME = "campaigns";
  private static CAMPAIGN_LINKS_TABLE = "campaign_links";

  /**
   * 현재 사용자의 프로필 ID를 가져옵니다.
   */
  private static async getUserProfileId(): Promise<string> {
    const supabase = await createClient();
    const user = await ClerkAuthService.requireAuth({
      requiredStatus: "approved",
    });

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("id")
      .eq("clerk_user_id", user.userId)
      .single();

    if (error || !profile) {
      throw new Error("사용자 프로필을 찾을 수 없습니다.");
    }

    return profile.id;
  }

  /**
   * 캠페인을 생성합니다.
   */
  static async createCampaign(data: CreateCampaignDTO): Promise<Campaign> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { data: campaign, error } = await supabase
      .from(this.TABLE_NAME)
      .insert({
        user_id: userId,
        name: data.name,
        description: data.description || null,
        status: data.status || "active",
        source_url: data.source_url || null,
        utm_source: data.utm_params?.utm_source || null,
        utm_medium: data.utm_params?.utm_medium || null,
        utm_campaign: data.utm_params?.utm_campaign || null,
        utm_term: data.utm_params?.utm_term || null,
        utm_content: data.utm_params?.utm_content || null,
      })
      .select()
      .single();

    if (error) {
      console.error("Error creating campaign:", error);
      throw new Error("캠페인 생성 중 오류가 발생했습니다.");
    }

    return campaign;
  }

  /**
   * ID로 캠페인을 조회합니다.
   */
  static async getCampaignById(id: string): Promise<Campaign | null> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { data: campaign, error } = await supabase
      .from(this.TABLE_NAME)
      .select("*")
      .eq("id", id)
      .eq("user_id", userId)
      .single();

    if (error) {
      if (error.code === "PGRST116") {
        return null;
      }
      console.error("Error fetching campaign:", error);
      throw new Error("캠페인 조회 중 오류가 발생했습니다.");
    }

    return campaign;
  }

  /**
   * 캠페인과 해당 링크들을 조회합니다.
   */
  static async getCampaignWithLinks(id: string): Promise<CampaignWithLinks | null> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    // 캠페인 조회
    const { data: campaign, error: campaignError } = await supabase
      .from(this.TABLE_NAME)
      .select("*")
      .eq("id", id)
      .eq("user_id", userId)
      .single();

    if (campaignError) {
      if (campaignError.code === "PGRST116") {
        return null;
      }
      throw new Error("캠페인 조회 중 오류가 발생했습니다.");
    }

    // 캠페인에 연결된 링크 ID 조회
    const { data: campaignLinks, error: linksError } = await supabase
      .from(this.CAMPAIGN_LINKS_TABLE)
      .select("link_id")
      .eq("campaign_id", id);

    if (linksError) {
      throw new Error("캠페인 링크 조회 중 오류가 발생했습니다.");
    }

    // 링크 정보 조회
    let links: Link[] = [];
    if (campaignLinks && campaignLinks.length > 0) {
      const linkIds = campaignLinks.map((cl) => cl.link_id);
      const { data: linksData, error: linksDataError } = await supabase
        .from("links")
        .select("*")
        .in("id", linkIds)
        .order("created_at", { ascending: false });

      if (linksDataError) {
        throw new Error("링크 정보 조회 중 오류가 발생했습니다.");
      }

      links = linksData || [];
    }

    return {
      ...campaign,
      links,
    };
  }

  /**
   * 현재 사용자의 모든 캠페인을 통계와 함께 조회합니다.
   */
  static async getCampaignsWithStats(): Promise<CampaignWithStats[]> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    // 캠페인 목록 조회
    const { data: campaigns, error } = await supabase
      .from(this.TABLE_NAME)
      .select("*")
      .eq("user_id", userId)
      .order("created_at", { ascending: false });

    if (error) {
      console.error("Error fetching campaigns:", error);
      throw new Error("캠페인 목록 조회 중 오류가 발생했습니다.");
    }

    // 각 캠페인에 대한 통계 계산
    const campaignsWithStats: CampaignWithStats[] = await Promise.all(
      (campaigns || []).map(async (campaign) => {
        // 캠페인에 연결된 링크 수 조회
        const { count: linkCount } = await supabase
          .from(this.CAMPAIGN_LINKS_TABLE)
          .select("*", { count: "exact", head: true })
          .eq("campaign_id", campaign.id);

        // 캠페인에 연결된 링크들의 총 클릭수 조회
        const { data: campaignLinks } = await supabase
          .from(this.CAMPAIGN_LINKS_TABLE)
          .select("link_id")
          .eq("campaign_id", campaign.id);

        let totalClicks = 0;
        if (campaignLinks && campaignLinks.length > 0) {
          const linkIds = campaignLinks.map((cl) => cl.link_id);
          const { data: links } = await supabase
            .from("links")
            .select("click_count")
            .in("id", linkIds);

          totalClicks = links?.reduce(
            (sum, link) => sum + (link.click_count || 0),
            0
          ) || 0;
        }

        return {
          ...campaign,
          total_links: linkCount || 0,
          total_clicks: totalClicks,
        };
      })
    );

    return campaignsWithStats;
  }

  /**
   * 캠페인을 수정합니다.
   */
  static async updateCampaign(
    id: string,
    data: UpdateCampaignDTO
  ): Promise<Campaign> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const updateData: Record<string, unknown> = {};

    if (data.name !== undefined) updateData.name = data.name;
    if (data.description !== undefined)
      updateData.description = data.description || null;
    if (data.status !== undefined) updateData.status = data.status;
    if (data.source_url !== undefined)
      updateData.source_url = data.source_url || null;

    if (data.utm_params) {
      if (data.utm_params.utm_source !== undefined)
        updateData.utm_source = data.utm_params.utm_source || null;
      if (data.utm_params.utm_medium !== undefined)
        updateData.utm_medium = data.utm_params.utm_medium || null;
      if (data.utm_params.utm_campaign !== undefined)
        updateData.utm_campaign = data.utm_params.utm_campaign || null;
      if (data.utm_params.utm_term !== undefined)
        updateData.utm_term = data.utm_params.utm_term || null;
      if (data.utm_params.utm_content !== undefined)
        updateData.utm_content = data.utm_params.utm_content || null;
    }

    const { data: campaign, error } = await supabase
      .from(this.TABLE_NAME)
      .update(updateData)
      .eq("id", id)
      .eq("user_id", userId)
      .select()
      .single();

    if (error) {
      console.error("Error updating campaign:", error);
      throw new Error("캠페인 수정 중 오류가 발생했습니다.");
    }

    return campaign;
  }

  /**
   * 캠페인을 삭제합니다.
   */
  static async deleteCampaign(id: string): Promise<void> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { error } = await supabase
      .from(this.TABLE_NAME)
      .delete()
      .eq("id", id)
      .eq("user_id", userId);

    if (error) {
      console.error("Error deleting campaign:", error);
      throw new Error("캠페인 삭제 중 오류가 발생했습니다.");
    }
  }

  /**
   * 캠페인에 링크를 추가합니다.
   */
  static async addLinkToCampaign(
    campaignId: string,
    linkId: string
  ): Promise<void> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    // 캠페인 소유권 확인
    const { data: campaign } = await supabase
      .from(this.TABLE_NAME)
      .select("id")
      .eq("id", campaignId)
      .eq("user_id", userId)
      .single();

    if (!campaign) {
      throw new Error("캠페인을 찾을 수 없습니다.");
    }

    const { error } = await supabase.from(this.CAMPAIGN_LINKS_TABLE).insert({
      campaign_id: campaignId,
      link_id: linkId,
    });

    if (error) {
      if (error.code === "23505") {
        throw new Error("이미 캠페인에 추가된 링크입니다.");
      }
      console.error("Error adding link to campaign:", error);
      throw new Error("링크 추가 중 오류가 발생했습니다.");
    }
  }

  /**
   * 캠페인에서 링크를 제거합니다.
   */
  static async removeLinkFromCampaign(
    campaignId: string,
    linkId: string
  ): Promise<void> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    // 캠페인 소유권 확인
    const { data: campaign } = await supabase
      .from(this.TABLE_NAME)
      .select("id")
      .eq("id", campaignId)
      .eq("user_id", userId)
      .single();

    if (!campaign) {
      throw new Error("캠페인을 찾을 수 없습니다.");
    }

    const { error } = await supabase
      .from(this.CAMPAIGN_LINKS_TABLE)
      .delete()
      .eq("campaign_id", campaignId)
      .eq("link_id", linkId);

    if (error) {
      console.error("Error removing link from campaign:", error);
      throw new Error("링크 제거 중 오류가 발생했습니다.");
    }
  }

  /**
   * 사용자의 모든 링크 중 특정 캠페인에 추가되지 않은 링크들을 조회합니다.
   */
  static async getAvailableLinksForCampaign(campaignId: string): Promise<Link[]> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    // 이미 캠페인에 추가된 링크 ID 조회
    const { data: campaignLinks } = await supabase
      .from(this.CAMPAIGN_LINKS_TABLE)
      .select("link_id")
      .eq("campaign_id", campaignId);

    const existingLinkIds = campaignLinks?.map((cl) => cl.link_id) || [];

    // 사용자의 모든 링크 조회 (이미 추가된 링크 제외)
    let query = supabase
      .from("links")
      .select("*")
      .eq("user_id", userId)
      .order("created_at", { ascending: false });

    if (existingLinkIds.length > 0) {
      query = query.not("id", "in", `(${existingLinkIds.join(",")})`);
    }

    const { data: links, error } = await query;

    if (error) {
      console.error("Error fetching available links:", error);
      throw new Error("링크 목록 조회 중 오류가 발생했습니다.");
    }

    return links || [];
  }
}
</file>

<file path="src/features/campaigns/types/campaign.ts">
import type { UTMParameters } from "@/features/links/types/utm";
import type { Link } from "@/shared/types/link";

export type CampaignStatus = "active" | "paused" | "archived";

export interface Campaign {
  id: string;
  user_id: string;
  name: string;
  description: string | null;
  status: CampaignStatus | null;
  source_url: string | null;
  utm_source: string | null;
  utm_medium: string | null;
  utm_campaign: string | null;
  utm_term: string | null;
  utm_content: string | null;
  created_at: string | null;
  updated_at: string | null;
}

export interface CampaignWithStats extends Campaign {
  total_links: number;
  total_clicks: number;
  period_clicks?: number;
}

export interface CampaignLink {
  id: string;
  campaign_id: string;
  link_id: string;
  added_at: string | null;
}

export interface CampaignWithLinks extends Campaign {
  links: Link[];
}

export interface CreateCampaignDTO {
  name: string;
  description?: string;
  status?: CampaignStatus;
  source_url?: string;
  utm_params?: UTMParameters;
}

export interface UpdateCampaignDTO {
  name?: string;
  description?: string;
  status?: CampaignStatus;
  source_url?: string;
  utm_params?: UTMParameters;
}

export function campaignToUTMParams(campaign: Campaign): UTMParameters {
  return {
    utm_source: campaign.utm_source || "",
    utm_medium: campaign.utm_medium || "",
    utm_campaign: campaign.utm_campaign || "",
    utm_term: campaign.utm_term || "",
    utm_content: campaign.utm_content || "",
  };
}

export const CAMPAIGN_STATUS_LABELS: Record<CampaignStatus, string> = {
  active: "활성",
  paused: "일시정지",
  archived: "보관됨",
};

export const CAMPAIGN_STATUS_COLORS: Record<CampaignStatus, string> = {
  active: "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",
  paused: "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",
  archived: "bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",
};
</file>

<file path="src/features/links/actions/delete-link.ts">
"use server";

import { LinkService } from "@/features/links/actions/link.service";
import { revalidatePath } from "next/cache";

export async function deleteLink(linkId: string): Promise<{ success: boolean; error?: string }> {
  try {
    await LinkService.deleteLink(linkId);
    
    // Revalidate the links pages to reflect the deletion
    revalidatePath("/admin/links");
    revalidatePath("/admin/dashboard");
    revalidatePath("/admin/analytics");
    
    return { success: true };
  } catch (error) {
    console.error("Error deleting link:", error);
    if (error instanceof Error) {
      return { success: false, error: error.message };
    }
    return { success: false, error: "링크 삭제 중 오류가 발생했습니다." };
  }
}
</file>

<file path="src/features/links/actions/link-actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { Link, DailyClickStats } from "@/shared/types/link";

export async function getTopLinks(limit: number = 10): Promise<Link[]> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from("links")
    .select("*")
    .order("click_count", { ascending: false })
    .limit(limit);

  if (error) throw error;
  return data;
}

export async function getAllLinks(): Promise<Link[]> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from("links")
    .select("*")
    .order("created_at", { ascending: false });

  if (error) throw error;
  return data;
}

export async function getLinkBySlug(slug: string): Promise<Link | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from("links")
    .select("*")
    .eq("slug", slug)
    .single();

  if (error) throw error;
  return data;
}

export async function trackLinkClick(
  linkId: string,
  userAgent?: string | null,
  ip?: string,
): Promise<void> {
  const supabase = await createClient();
  const [clickInsert, countUpdate] = await Promise.all([
    supabase.from("link_clicks").insert({
      link_id: linkId,
      user_agent: userAgent || null,
      ip_address: ip || "unknown",
    }),
    supabase.rpc("increment_click_count", { link_id: linkId }),
  ]);

  if (clickInsert.error) throw clickInsert.error;
  if (countUpdate.error) throw countUpdate.error;
}

export async function getLinkClickStats(
  linkId: string,
  dateRange?: { startDate?: string; endDate?: string },
): Promise<DailyClickStats[]> {
  const supabase = await createClient();

  let query = supabase
    .from("link_clicks")
    .select("clicked_at")
    .eq("link_id", linkId);

  // 날짜 범위 필터 적용
  if (dateRange?.startDate) {
    query = query.gte("clicked_at", dateRange.startDate);
  }
  if (dateRange?.endDate) {
    query = query.lte("clicked_at", dateRange.endDate);
  }

  const { data, error } = await query.order("clicked_at", { ascending: true });

  if (error) throw error;

  // 클릭 데이터를 일별로 집계
  const dailyStats = data.reduce((acc: { [key: string]: number }, click) => {
    const date = new Date(click.clicked_at).toISOString().split("T")[0];
    acc[date] = (acc[date] || 0) + 1;
    return acc;
  }, {});

  return Object.entries(dailyStats).map(([date, clicks]) => ({
    date,
    clicks,
  }));
}
</file>

<file path="src/features/links/components/utm/utm-builder.tsx">
"use client";

import { useState } from "react";
import { Input } from "@/shared/components/ui/input";
import { Label } from "@/shared/components/ui/label";
import { Switch } from "@/shared/components/ui/switch";
import { Card, CardContent } from "@/shared/components/ui/card";
import { Alert, AlertDescription } from "@/shared/components/ui/alert";
import {
  BarChart3,
  Info,
  ExternalLink,
  Copy,
  Check,
  Tag,
  Target,
  Megaphone,
  Search,
  FileText
} from "lucide-react";
import { Button } from "@/shared/components/ui/button";
import { UTMParameters, addUTMParameters } from "@/features/links/types/utm";

interface UTMBuilderProps {
  /** 원본 URL */
  originalUrl: string;
  /** UTM 파라미터 변경 콜백 */
  onUTMChange: (params: UTMParameters) => void;
  /** 비활성화 여부 */
  disabled?: boolean;
}

export function UTMBuilder({ originalUrl, onUTMChange, disabled = false }: UTMBuilderProps) {
  const [enabled, setEnabled] = useState(false);
  const [copied, setCopied] = useState(false);
  const [utmParams, setUTMParams] = useState<UTMParameters>({
    utm_source: "",
    utm_medium: "",
    utm_campaign: "",
    utm_term: "",
    utm_content: "",
  });

  // UTM 파라미터 업데이트 핸들러
  const handleUTMChange = (key: keyof UTMParameters, value: string) => {
    const newParams = { ...utmParams, [key]: value };
    setUTMParams(newParams);
    onUTMChange(enabled ? newParams : {});
  };

  // UTM 활성화/비활성화 핸들러
  const handleToggle = (checked: boolean) => {
    setEnabled(checked);
    onUTMChange(checked ? utmParams : {});
  };

  // 최종 URL 생성 (유효한 URL일 때만)
  const getFinalUrl = () => {
    if (!enabled || !originalUrl) {
      return originalUrl;
    }

    try {
      // URL 유효성 검사
      new URL(originalUrl);
      return addUTMParameters(originalUrl, utmParams);
    } catch {
      // 유효하지 않은 URL이면 원본 반환
      return originalUrl;
    }
  };

  const finalUrl = getFinalUrl();

  // URL 복사 핸들러
  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(finalUrl);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (error) {
      console.error("Failed to copy:", error);
    }
  };

  // UTM 필드 정의
  const utmFields = [
    {
      key: "utm_source" as keyof UTMParameters,
      label: "캠페인 소스",
      description: "트래픽 소스 (예: google, newsletter, facebook)",
      placeholder: "google",
      icon: Tag,
      required: true,
    },
    {
      key: "utm_medium" as keyof UTMParameters,
      label: "캠페인 매체",
      description: "마케팅 매체 (예: cpc, banner, email)",
      placeholder: "cpc",
      icon: Target,
      required: true,
    },
    {
      key: "utm_campaign" as keyof UTMParameters,
      label: "캠페인 이름",
      description: "프로모션 또는 캠페인 이름 (예: spring_sale)",
      placeholder: "spring_sale",
      icon: Megaphone,
      required: true,
    },
    {
      key: "utm_term" as keyof UTMParameters,
      label: "캠페인 키워드",
      description: "유료 검색 키워드 (선택사항)",
      placeholder: "running+shoes",
      icon: Search,
      required: false,
    },
    {
      key: "utm_content" as keyof UTMParameters,
      label: "캠페인 콘텐츠",
      description: "광고 콘텐츠 구분 (선택사항)",
      placeholder: "logolink",
      icon: FileText,
      required: false,
    },
  ];

  return (
    <div className="space-y-4">
      {/* UTM Builder Toggle */}
      <Card className="border-none bg-accent/5 shadow-none">
        <CardContent className="pt-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <div className="h-10 w-10 rounded-lg bg-gradient-to-br from-accent to-primary flex items-center justify-center">
                <BarChart3 className="h-5 w-5 text-white" />
              </div>
              <div>
                <Label htmlFor="utm-toggle" className="text-base font-semibold cursor-pointer">
                  UTM 파라미터 추가
                </Label>
                <p className="text-sm text-muted-foreground">
                  마케팅 캠페인 추적을 위한 파라미터를 추가합니다
                </p>
              </div>
            </div>
            <Switch
              id="utm-toggle"
              checked={enabled}
              onCheckedChange={handleToggle}
              disabled={disabled || !originalUrl}
            />
          </div>
        </CardContent>
      </Card>

      {/* UTM Parameters Form */}
      {enabled && (
        <Card className="animate-in slide-in-from-top-2 border-none bg-transparent shadow-none">
          <CardContent className="pt-0 space-y-6 px-0">
            {/* Info Alert */}
            <Alert className="border-none bg-accent/5">
              <Info className="h-4 w-4 text-accent" />
              <AlertDescription className="text-sm">
                UTM 파라미터는 Google Analytics 등의 분석 도구에서 캠페인 성과를 추적하는 데 사용됩니다.
              </AlertDescription>
            </Alert>

            {/* UTM Fields */}
            <div className="space-y-4">
              {utmFields.map((field) => {
                const Icon = field.icon;
                return (
                  <div key={field.key} className="space-y-2">
                    <Label htmlFor={field.key} className="flex items-center gap-2">
                      <Icon className="h-4 w-4 text-muted-foreground" />
                      {field.label}
                      {field.required && <span className="text-destructive">*</span>}
                    </Label>
                    <Input
                      id={field.key}
                      type="text"
                      value={utmParams[field.key] || ""}
                      onChange={(e) => handleUTMChange(field.key, e.target.value)}
                      placeholder={field.placeholder}
                      disabled={disabled}
                      className="transition-all focus:scale-[1.01] border-black/5 dark:border-white/10 bg-white/50 dark:bg-black/20 shadow-sm"
                    />
                    <p className="text-xs text-muted-foreground">
                      {field.description}
                    </p>
                  </div>
                );
              })}
            </div>

            {/* URL Preview */}
            {originalUrl && (
              <div className="space-y-2 pt-4 border-t border-accent/10">
                <Label className="flex items-center gap-2 text-sm font-medium">
                  <ExternalLink className="h-4 w-4" />
                  미리보기
                </Label>
                <div className="relative">
                  <div className="p-3 pr-12 rounded-lg bg-muted/50 border-none break-all text-sm font-mono">
                    {finalUrl}
                  </div>
                  <Button
                    type="button"
                    variant="ghost"
                    size="sm"
                    onClick={handleCopy}
                    className="absolute right-1 top-1/2 -translate-y-1/2"
                    disabled={!finalUrl}
                  >
                    {copied ? (
                      <Check className="h-4 w-4 text-green-500" />
                    ) : (
                      <Copy className="h-4 w-4" />
                    )}
                  </Button>
                </div>
                <p className="text-xs text-muted-foreground">
                  이 URL이 단축 링크의 원본 URL로 사용됩니다
                </p>
              </div>
            )}
          </CardContent>
        </Card>
      )}
    </div>
  );
}
</file>

<file path="src/features/links/types/utm.ts">
/**
 * UTM (Urchin Tracking Module) 파라미터 타입 정의
 * 마케팅 캠페인 추적을 위한 URL 파라미터
 */
export interface UTMParameters {
  /** 트래픽 소스 (예: google, newsletter, facebook) */
  utm_source?: string;

  /** 마케팅 매체 (예: cpc, banner, email) */
  utm_medium?: string;

  /** 캠페인 이름 (예: spring_sale, product_launch) */
  utm_campaign?: string;

  /** 유료 검색 키워드 (선택) */
  utm_term?: string;

  /** 광고 콘텐츠 구분 (선택) */
  utm_content?: string;
}

/**
 * URL에 UTM 파라미터를 추가하는 유틸 함수
 * @param url 원본 URL
 * @param params UTM 파라미터 객체
 * @returns UTM 파라미터가 추가된 URL
 */
export function addUTMParameters(url: string, params: UTMParameters): string {
  try {
    const urlObj = new URL(url);

    // 빈 값이 아닌 파라미터만 추가
    Object.entries(params).forEach(([key, value]) => {
      if (value && value.trim()) {
        urlObj.searchParams.set(key, value.trim());
      }
    });

    return urlObj.toString();
  } catch (error) {
    // URL이 유효하지 않으면 원본 반환
    console.error("Invalid URL:", error);
    return url;
  }
}

/**
 * UTM 파라미터가 비어있는지 확인
 * @param params UTM 파라미터 객체
 * @returns 모든 파라미터가 비어있으면 true
 */
export function isUTMParametersEmpty(params: UTMParameters): boolean {
  return Object.values(params).every(value => !value || !value.trim());
}
</file>

<file path="src/features/links/types/youtube.ts">
export interface YouTubeVideoInfo {
  videoId: string;
  isYouTube: boolean;
  embedUrl: string | null;
  thumbnailUrl: string | null;
}

export type YouTubeUrlFormat =
  | "watch" // youtube.com/watch?v=VIDEO_ID
  | "short" // youtu.be/VIDEO_ID
  | "embed" // youtube.com/embed/VIDEO_ID
  | "shorts" // youtube.com/shorts/VIDEO_ID
  | "unknown";

export type YouTubeThumbnailQuality =
  | "default" // 120x90
  | "mqdefault" // 320x180
  | "hqdefault" // 480x360
  | "sddefault" // 640x480
  | "maxresdefault"; // 1280x720
</file>

<file path="src/features/links/utils/youtube.ts">
import type {
  YouTubeVideoInfo,
  YouTubeUrlFormat,
  YouTubeThumbnailQuality,
} from "../types/youtube";

/**
 * YouTube URL 패턴들
 * - youtube.com/watch?v=VIDEO_ID
 * - youtu.be/VIDEO_ID
 * - youtube.com/embed/VIDEO_ID
 * - youtube.com/shorts/VIDEO_ID
 * - youtube.com/v/VIDEO_ID
 */
const YOUTUBE_PATTERNS: { pattern: RegExp; format: YouTubeUrlFormat }[] = [
  {
    pattern:
      /(?:youtube\.com\/watch\?.*v=|youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/,
    format: "watch",
  },
  {
    pattern: /youtu\.be\/([a-zA-Z0-9_-]{11})/,
    format: "short",
  },
  {
    pattern: /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
    format: "embed",
  },
  {
    pattern: /youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/,
    format: "shorts",
  },
  {
    pattern: /youtube\.com\/v\/([a-zA-Z0-9_-]{11})/,
    format: "watch",
  },
];

/**
 * URL이 YouTube URL인지 확인
 */
export function isYouTubeUrl(url: string): boolean {
  return YOUTUBE_PATTERNS.some(({ pattern }) => pattern.test(url));
}

/**
 * YouTube URL에서 비디오 ID 추출
 */
export function getYouTubeVideoId(url: string): string | null {
  for (const { pattern } of YOUTUBE_PATTERNS) {
    const match = url.match(pattern);
    if (match && match[1]) {
      return match[1];
    }
  }
  return null;
}

/**
 * YouTube URL 형식 감지
 */
export function getYouTubeUrlFormat(url: string): YouTubeUrlFormat {
  for (const { pattern, format } of YOUTUBE_PATTERNS) {
    if (pattern.test(url)) {
      return format;
    }
  }
  return "unknown";
}

/**
 * YouTube 임베드 URL 생성
 */
export function getYouTubeEmbedUrl(
  videoId: string,
  options?: {
    autoplay?: boolean;
    mute?: boolean;
    controls?: boolean;
    loop?: boolean;
  }
): string {
  const params = new URLSearchParams();

  if (options?.autoplay) params.set("autoplay", "1");
  if (options?.mute) params.set("mute", "1");
  if (options?.controls === false) params.set("controls", "0");
  if (options?.loop) {
    params.set("loop", "1");
    params.set("playlist", videoId);
  }

  const queryString = params.toString();
  return `https://www.youtube.com/embed/${videoId}${queryString ? `?${queryString}` : ""}`;
}

/**
 * YouTube 썸네일 URL 생성
 */
export function getYouTubeThumbnailUrl(
  videoId: string,
  quality: YouTubeThumbnailQuality = "mqdefault"
): string {
  return `https://img.youtube.com/vi/${videoId}/${quality}.jpg`;
}

/**
 * YouTube URL을 분석하여 비디오 정보 반환
 */
export function parseYouTubeUrl(url: string): YouTubeVideoInfo {
  const videoId = getYouTubeVideoId(url);

  if (!videoId) {
    return {
      videoId: "",
      isYouTube: false,
      embedUrl: null,
      thumbnailUrl: null,
    };
  }

  return {
    videoId,
    isYouTube: true,
    embedUrl: getYouTubeEmbedUrl(videoId),
    thumbnailUrl: getYouTubeThumbnailUrl(videoId),
  };
}
</file>

<file path="src/features/templates/actions/template-actions.ts">
"use server";

import { revalidatePath } from "next/cache";
import { TemplateService } from "../services/template.service";
import type { CreateTemplateDTO, UpdateTemplateDTO } from "../types/template";

export async function createTemplate(data: CreateTemplateDTO) {
  try {
    const template = await TemplateService.createTemplate(data);
    revalidatePath("/admin/templates");
    return { success: true, data: template };
  } catch (error) {
    console.error("Create template error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "템플릿 생성에 실패했습니다.",
    };
  }
}

export async function getTemplate(id: string) {
  try {
    const template = await TemplateService.getTemplateById(id);
    return { success: true, data: template };
  } catch (error) {
    console.error("Get template error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "템플릿 조회에 실패했습니다.",
    };
  }
}

export async function getTemplates() {
  try {
    const templates = await TemplateService.getTemplatesByUser();
    return { success: true, data: templates };
  } catch (error) {
    console.error("Get templates error:", error);
    return {
      success: false,
      error:
        error instanceof Error
          ? error.message
          : "템플릿 목록 조회에 실패했습니다.",
    };
  }
}

export async function updateTemplate(id: string, data: UpdateTemplateDTO) {
  try {
    const template = await TemplateService.updateTemplate(id, data);
    revalidatePath("/admin/templates");
    revalidatePath(`/admin/templates/${id}`);
    return { success: true, data: template };
  } catch (error) {
    console.error("Update template error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "템플릿 수정에 실패했습니다.",
    };
  }
}

export async function deleteTemplate(id: string) {
  try {
    await TemplateService.deleteTemplate(id);
    revalidatePath("/admin/templates");
    return { success: true };
  } catch (error) {
    console.error("Delete template error:", error);
    return {
      success: false,
      error:
        error instanceof Error ? error.message : "템플릿 삭제에 실패했습니다.",
    };
  }
}
</file>

<file path="src/features/templates/components/template-form.tsx">
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Textarea } from "@/shared/components/ui/textarea";
import { Card, CardContent, CardHeader, CardTitle } from "@/shared/components/ui/card";
import { Label } from "@/shared/components/ui/label";
import { Alert, AlertDescription } from "@/shared/components/ui/alert";
import { Loader2, Save, ArrowLeft } from "lucide-react";
import { toast } from "sonner";
import { createTemplate, updateTemplate } from "../actions/template-actions";
import type { LinkTemplate, CreateTemplateDTO, UpdateTemplateDTO } from "../types/template";

interface TemplateFormProps {
  template?: LinkTemplate;
  mode: "create" | "edit";
}

export function TemplateForm({ template, mode }: TemplateFormProps) {
  const router = useRouter();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const [formData, setFormData] = useState({
    name: template?.name || "",
    original_url: template?.original_url || "",
    description: template?.description || "",
    utm_source: template?.utm_source || "",
    utm_medium: template?.utm_medium || "",
    utm_campaign: template?.utm_campaign || "",
    utm_term: template?.utm_term || "",
    utm_content: template?.utm_content || "",
  });

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setIsSubmitting(true);

    try {
      // URL 유효성 검사
      try {
        new URL(formData.original_url);
      } catch {
        throw new Error("유효한 URL 형식이 아닙니다.");
      }

      if (!formData.name.trim()) {
        throw new Error("템플릿 이름을 입력해주세요.");
      }

      const utm_params = {
        utm_source: formData.utm_source,
        utm_medium: formData.utm_medium,
        utm_campaign: formData.utm_campaign,
        utm_term: formData.utm_term,
        utm_content: formData.utm_content,
      };

      if (mode === "create") {
        const data: CreateTemplateDTO = {
          name: formData.name,
          original_url: formData.original_url,
          description: formData.description || undefined,
          utm_params,
        };
        const result = await createTemplate(data);

        if (!result.success) {
          throw new Error(result.error);
        }

        toast.success("템플릿이 생성되었습니다.");
        router.push("/admin/templates");
      } else if (template) {
        const data: UpdateTemplateDTO = {
          name: formData.name,
          original_url: formData.original_url,
          description: formData.description || undefined,
          utm_params,
        };
        const result = await updateTemplate(template.id, data);

        if (!result.success) {
          throw new Error(result.error);
        }

        toast.success("템플릿이 수정되었습니다.");
        router.push("/admin/templates");
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : "오류가 발생했습니다.");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {error && (
        <Alert variant="destructive">
          <AlertDescription>{error}</AlertDescription>
        </Alert>
      )}

      <Card>
        <CardHeader>
          <CardTitle>기본 정보</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="name">템플릿 이름 *</Label>
            <Input
              id="name"
              name="name"
              value={formData.name}
              onChange={handleChange}
              placeholder="예: 블로그 홍보 링크"
              required
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="original_url">URL *</Label>
            <Input
              id="original_url"
              name="original_url"
              type="url"
              value={formData.original_url}
              onChange={handleChange}
              placeholder="https://example.com"
              required
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="description">설명</Label>
            <Textarea
              id="description"
              name="description"
              value={formData.description}
              onChange={handleChange}
              placeholder="템플릿에 대한 설명을 입력하세요"
              rows={2}
            />
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>UTM 파라미터</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label htmlFor="utm_source">utm_source</Label>
              <Input
                id="utm_source"
                name="utm_source"
                value={formData.utm_source}
                onChange={handleChange}
                placeholder="google, newsletter, facebook"
              />
              <p className="text-xs text-muted-foreground">트래픽 소스</p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="utm_medium">utm_medium</Label>
              <Input
                id="utm_medium"
                name="utm_medium"
                value={formData.utm_medium}
                onChange={handleChange}
                placeholder="cpc, banner, email"
              />
              <p className="text-xs text-muted-foreground">마케팅 매체</p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="utm_campaign">utm_campaign</Label>
              <Input
                id="utm_campaign"
                name="utm_campaign"
                value={formData.utm_campaign}
                onChange={handleChange}
                placeholder="spring_sale, product_launch"
              />
              <p className="text-xs text-muted-foreground">캠페인 이름</p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="utm_term">utm_term</Label>
              <Input
                id="utm_term"
                name="utm_term"
                value={formData.utm_term}
                onChange={handleChange}
                placeholder="키워드"
              />
              <p className="text-xs text-muted-foreground">검색 키워드 (선택)</p>
            </div>

            <div className="space-y-2 md:col-span-2">
              <Label htmlFor="utm_content">utm_content</Label>
              <Input
                id="utm_content"
                name="utm_content"
                value={formData.utm_content}
                onChange={handleChange}
                placeholder="광고 콘텐츠 식별자"
              />
              <p className="text-xs text-muted-foreground">광고 콘텐츠 구분 (선택)</p>
            </div>
          </div>
        </CardContent>
      </Card>

      <div className="flex justify-between">
        <Button
          type="button"
          variant="outline"
          onClick={() => router.back()}
          disabled={isSubmitting}
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          취소
        </Button>
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting ? (
            <Loader2 className="h-4 w-4 mr-2 animate-spin" />
          ) : (
            <Save className="h-4 w-4 mr-2" />
          )}
          {mode === "create" ? "생성" : "저장"}
        </Button>
      </div>
    </form>
  );
}
</file>

<file path="src/features/templates/components/template-list.tsx">
"use client";

import { useState } from "react";
import Link from "next/link";
import { Card, CardContent } from "@/shared/components/ui/card";
import { Button } from "@/shared/components/ui/button";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/shared/components/ui/alert-dialog";
import { Badge } from "@/shared/components/ui/badge";
import { Edit, Trash2, ExternalLink, Copy, Plus } from "lucide-react";
import { toast } from "sonner";
import { deleteTemplate } from "../actions/template-actions";
import type { LinkTemplate } from "../types/template";

interface TemplateListProps {
  initialTemplates: LinkTemplate[];
}

export function TemplateList({ initialTemplates }: TemplateListProps) {
  const [templates, setTemplates] = useState(initialTemplates);

  const handleDelete = async (id: string) => {
    const result = await deleteTemplate(id);

    if (result.success) {
      setTemplates(templates.filter((t) => t.id !== id));
      toast.success("템플릿이 삭제되었습니다.");
    } else {
      toast.error(result.error || "템플릿 삭제에 실패했습니다.");
    }
  };

  const copyToClipboard = async (text: string) => {
    try {
      await navigator.clipboard.writeText(text);
      toast.success("클립보드에 복사되었습니다.");
    } catch {
      toast.error("복사에 실패했습니다.");
    }
  };

  const buildUrlWithUTM = (template: LinkTemplate): string => {
    try {
      const url = new URL(template.original_url);
      if (template.utm_source)
        url.searchParams.set("utm_source", template.utm_source);
      if (template.utm_medium)
        url.searchParams.set("utm_medium", template.utm_medium);
      if (template.utm_campaign)
        url.searchParams.set("utm_campaign", template.utm_campaign);
      if (template.utm_term) url.searchParams.set("utm_term", template.utm_term);
      if (template.utm_content)
        url.searchParams.set("utm_content", template.utm_content);
      return url.toString();
    } catch {
      return template.original_url;
    }
  };

  const hasUTMParams = (template: LinkTemplate): boolean => {
    return !!(
      template.utm_source ||
      template.utm_medium ||
      template.utm_campaign ||
      template.utm_term ||
      template.utm_content
    );
  };

  const formatDate = (dateString: string | null) => {
    if (!dateString) return "-";
    return new Date(dateString).toISOString().split("T")[0];
  };

  if (templates.length === 0) {
    return (
      <Card className="border-none shadow-sm bg-white/50 dark:bg-white/5">
        <CardContent className="flex flex-col items-center justify-center py-12">
          <p className="text-muted-foreground mb-4">
            아직 저장된 템플릿이 없습니다.
          </p>
          <Link href="/admin/templates/new">
            <Button>
              <Plus className="h-4 w-4 mr-2" />
              첫 템플릿 만들기
            </Button>
          </Link>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="grid gap-4">
      {templates.map((template) => (
        <Card
          key={template.id}
          className="border-black/5 dark:border-white/5 hover:bg-muted/50 dark:hover:bg-white/5 shadow-sm transition-all"
        >
          <CardContent className="p-4">
            <div className="flex justify-between items-start">
              <div className="flex-1 mr-4">
                <div className="flex items-center gap-2 mb-2">
                  <h3 className="font-semibold text-lg">{template.name}</h3>
                  {hasUTMParams(template) && (
                    <Badge variant="secondary" className="text-xs">
                      UTM
                    </Badge>
                  )}
                </div>

                {template.description && (
                  <p className="text-sm text-muted-foreground mb-2">
                    {template.description}
                  </p>
                )}

                <p className="text-sm break-all text-muted-foreground">
                  {template.original_url}
                </p>

                {hasUTMParams(template) && (
                  <div className="mt-2 flex flex-wrap gap-1">
                    {template.utm_source && (
                      <Badge variant="outline" className="text-xs">
                        source: {template.utm_source}
                      </Badge>
                    )}
                    {template.utm_medium && (
                      <Badge variant="outline" className="text-xs">
                        medium: {template.utm_medium}
                      </Badge>
                    )}
                    {template.utm_campaign && (
                      <Badge variant="outline" className="text-xs">
                        campaign: {template.utm_campaign}
                      </Badge>
                    )}
                  </div>
                )}

                <p className="text-xs text-muted-foreground mt-2">
                  생성일: {formatDate(template.created_at)}
                </p>
              </div>

              <div className="flex flex-col gap-2">
                <div className="flex gap-2">
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() => copyToClipboard(buildUrlWithUTM(template))}
                    title="URL 복사"
                  >
                    <Copy className="h-4 w-4" />
                  </Button>
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() =>
                      window.open(buildUrlWithUTM(template), "_blank")
                    }
                    title="새 탭에서 열기"
                  >
                    <ExternalLink className="h-4 w-4" />
                  </Button>
                </div>
                <div className="flex gap-2">
                  <Link href={`/admin/templates/${template.id}/edit`}>
                    <Button size="sm" variant="outline">
                      <Edit className="h-4 w-4" />
                    </Button>
                  </Link>
                  <AlertDialog>
                    <AlertDialogTrigger asChild>
                      <Button size="sm" variant="destructive">
                        <Trash2 className="h-4 w-4" />
                      </Button>
                    </AlertDialogTrigger>
                    <AlertDialogContent>
                      <AlertDialogHeader>
                        <AlertDialogTitle>템플릿 삭제</AlertDialogTitle>
                        <AlertDialogDescription>
                          &quot;{template.name}&quot; 템플릿을 삭제하시겠습니까?
                          삭제된 템플릿은 복구할 수 없습니다.
                        </AlertDialogDescription>
                      </AlertDialogHeader>
                      <AlertDialogFooter>
                        <AlertDialogCancel>취소</AlertDialogCancel>
                        <AlertDialogAction
                          onClick={() => handleDelete(template.id)}
                        >
                          삭제
                        </AlertDialogAction>
                      </AlertDialogFooter>
                    </AlertDialogContent>
                  </AlertDialog>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
</file>

<file path="src/features/templates/components/template-save-dialog.tsx">
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/shared/components/ui/dialog";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Label } from "@/shared/components/ui/label";
import { Loader2, Save } from "lucide-react";
import { toast } from "sonner";
import { createTemplate } from "../actions/template-actions";
import type { UTMParameters } from "@/features/links/types/utm";

interface TemplateSaveDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  defaultUrl: string;
  defaultDescription?: string;
  defaultUTMParams?: UTMParameters;
}

export function TemplateSaveDialog({
  open,
  onOpenChange,
  defaultUrl,
  defaultDescription = "",
  defaultUTMParams = {},
}: TemplateSaveDialogProps) {
  const router = useRouter();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [name, setName] = useState("");

  const handleSave = async () => {
    if (!name.trim()) {
      toast.error("템플릿 이름을 입력해주세요.");
      return;
    }

    setIsSubmitting(true);
    try {
      const result = await createTemplate({
        name: name.trim(),
        original_url: defaultUrl,
        description: defaultDescription || undefined,
        utm_params: defaultUTMParams,
      });

      if (result.success) {
        toast.success("템플릿이 저장되었습니다.");
        setName("");
        onOpenChange(false);
        router.refresh();
      } else {
        toast.error(result.error || "템플릿 저장에 실패했습니다.");
      }
    } catch (error) {
      console.error("Template save error:", error);
      toast.error("템플릿 저장 중 오류가 발생했습니다.");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>템플릿으로 저장</DialogTitle>
          <DialogDescription>
            현재 링크 정보를 템플릿으로 저장하여 나중에 빠르게 재사용할 수 있습니다.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          <div className="space-y-2">
            <Label htmlFor="template-name">템플릿 이름 *</Label>
            <Input
              id="template-name"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="예: 블로그 포스트 링크"
              disabled={isSubmitting}
            />
          </div>

          <div className="space-y-2">
            <Label>URL</Label>
            <p className="text-sm text-muted-foreground break-all">
              {defaultUrl}
            </p>
          </div>

          {defaultDescription && (
            <div className="space-y-2">
              <Label>설명</Label>
              <p className="text-sm text-muted-foreground">
                {defaultDescription}
              </p>
            </div>
          )}

          {Object.keys(defaultUTMParams).some(
            (key) => defaultUTMParams[key as keyof UTMParameters]
          ) && (
            <div className="space-y-2">
              <Label>UTM 파라미터</Label>
              <div className="text-sm text-muted-foreground space-y-1">
                {defaultUTMParams.utm_source && (
                  <div>source: {defaultUTMParams.utm_source}</div>
                )}
                {defaultUTMParams.utm_medium && (
                  <div>medium: {defaultUTMParams.utm_medium}</div>
                )}
                {defaultUTMParams.utm_campaign && (
                  <div>campaign: {defaultUTMParams.utm_campaign}</div>
                )}
                {defaultUTMParams.utm_term && (
                  <div>term: {defaultUTMParams.utm_term}</div>
                )}
                {defaultUTMParams.utm_content && (
                  <div>content: {defaultUTMParams.utm_content}</div>
                )}
              </div>
            </div>
          )}
        </div>

        <DialogFooter>
          <Button
            variant="outline"
            onClick={() => onOpenChange(false)}
            disabled={isSubmitting}
          >
            취소
          </Button>
          <Button onClick={handleSave} disabled={isSubmitting}>
            {isSubmitting ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                저장 중...
              </>
            ) : (
              <>
                <Save className="h-4 w-4 mr-2" />
                저장
              </>
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/features/templates/components/template-selector.tsx">
"use client";

import { useEffect, useState } from "react";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/shared/components/ui/select";
import { Label } from "@/shared/components/ui/label";
import { FileText } from "lucide-react";
import { getTemplates } from "../actions/template-actions";
import type { LinkTemplate } from "../types/template";
import type { UTMParameters } from "@/features/links/types/utm";

interface TemplateSelectorProps {
  onSelect: (template: {
    url: string;
    description: string;
    utmParams: UTMParameters;
  }) => void;
  disabled?: boolean;
}

export function TemplateSelector({
  onSelect,
  disabled = false,
}: TemplateSelectorProps) {
  const [templates, setTemplates] = useState<LinkTemplate[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const fetchTemplates = async () => {
      try {
        const result = await getTemplates();
        if (result.success && result.data) {
          setTemplates(result.data);
        }
      } catch (error) {
        console.error("Failed to fetch templates:", error);
      } finally {
        setIsLoading(false);
      }
    };

    fetchTemplates();
  }, []);

  const handleSelect = (templateId: string) => {
    const template = templates.find((t) => t.id === templateId);
    if (template) {
      onSelect({
        url: template.original_url,
        description: template.description || "",
        utmParams: {
          utm_source: template.utm_source || "",
          utm_medium: template.utm_medium || "",
          utm_campaign: template.utm_campaign || "",
          utm_term: template.utm_term || "",
          utm_content: template.utm_content || "",
        },
      });
    }
  };

  if (isLoading) {
    return null;
  }

  if (templates.length === 0) {
    return null;
  }

  return (
    <div className="space-y-2">
      <Label className="flex items-center gap-2">
        <FileText className="h-4 w-4" />
        템플릿에서 선택
      </Label>
      <Select onValueChange={handleSelect} disabled={disabled}>
        <SelectTrigger>
          <SelectValue placeholder="저장된 템플릿을 선택하세요" />
        </SelectTrigger>
        <SelectContent>
          {templates.map((template) => (
            <SelectItem key={template.id} value={template.id}>
              <div className="flex flex-col">
                <span>{template.name}</span>
                {template.description && (
                  <span className="text-xs text-muted-foreground">
                    {template.description}
                  </span>
                )}
              </div>
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </div>
  );
}
</file>

<file path="src/features/templates/services/template.service.ts">
import { createClient } from "@/lib/supabase/server";
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import type {
  LinkTemplate,
  CreateTemplateDTO,
  UpdateTemplateDTO,
} from "../types/template";

export class TemplateService {
  private static TABLE_NAME = "link_templates";

  /**
   * 현재 사용자의 프로필 ID를 가져옵니다.
   */
  private static async getUserProfileId(): Promise<string> {
    const supabase = await createClient();
    const user = await ClerkAuthService.requireAuth({
      requiredStatus: "approved",
    });

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("id")
      .eq("clerk_user_id", user.userId)
      .single();

    if (error || !profile) {
      throw new Error("사용자 프로필을 찾을 수 없습니다.");
    }

    return profile.id;
  }

  /**
   * 템플릿을 생성합니다.
   */
  static async createTemplate(data: CreateTemplateDTO): Promise<LinkTemplate> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { data: template, error } = await supabase
      .from(this.TABLE_NAME)
      .insert({
        user_id: userId,
        name: data.name,
        original_url: data.original_url,
        description: data.description || null,
        utm_source: data.utm_params?.utm_source || null,
        utm_medium: data.utm_params?.utm_medium || null,
        utm_campaign: data.utm_params?.utm_campaign || null,
        utm_term: data.utm_params?.utm_term || null,
        utm_content: data.utm_params?.utm_content || null,
      })
      .select()
      .single();

    if (error) {
      console.error("Error creating template:", error);
      throw new Error("템플릿 생성 중 오류가 발생했습니다.");
    }

    return template;
  }

  /**
   * ID로 템플릿을 조회합니다.
   */
  static async getTemplateById(id: string): Promise<LinkTemplate | null> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { data: template, error } = await supabase
      .from(this.TABLE_NAME)
      .select("*")
      .eq("id", id)
      .eq("user_id", userId)
      .single();

    if (error) {
      if (error.code === "PGRST116") {
        return null;
      }
      console.error("Error fetching template:", error);
      throw new Error("템플릿 조회 중 오류가 발생했습니다.");
    }

    return template;
  }

  /**
   * 현재 사용자의 모든 템플릿을 조회합니다.
   */
  static async getTemplatesByUser(): Promise<LinkTemplate[]> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { data: templates, error } = await supabase
      .from(this.TABLE_NAME)
      .select("*")
      .eq("user_id", userId)
      .order("created_at", { ascending: false });

    if (error) {
      console.error("Error fetching templates:", error);
      throw new Error("템플릿 목록 조회 중 오류가 발생했습니다.");
    }

    return templates || [];
  }

  /**
   * 템플릿을 수정합니다.
   */
  static async updateTemplate(
    id: string,
    data: UpdateTemplateDTO
  ): Promise<LinkTemplate> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const updateData: Record<string, unknown> = {};

    if (data.name !== undefined) updateData.name = data.name;
    if (data.original_url !== undefined)
      updateData.original_url = data.original_url;
    if (data.description !== undefined)
      updateData.description = data.description || null;

    if (data.utm_params) {
      if (data.utm_params.utm_source !== undefined)
        updateData.utm_source = data.utm_params.utm_source || null;
      if (data.utm_params.utm_medium !== undefined)
        updateData.utm_medium = data.utm_params.utm_medium || null;
      if (data.utm_params.utm_campaign !== undefined)
        updateData.utm_campaign = data.utm_params.utm_campaign || null;
      if (data.utm_params.utm_term !== undefined)
        updateData.utm_term = data.utm_params.utm_term || null;
      if (data.utm_params.utm_content !== undefined)
        updateData.utm_content = data.utm_params.utm_content || null;
    }

    const { data: template, error } = await supabase
      .from(this.TABLE_NAME)
      .update(updateData)
      .eq("id", id)
      .eq("user_id", userId)
      .select()
      .single();

    if (error) {
      console.error("Error updating template:", error);
      throw new Error("템플릿 수정 중 오류가 발생했습니다.");
    }

    return template;
  }

  /**
   * 템플릿을 삭제합니다.
   */
  static async deleteTemplate(id: string): Promise<void> {
    const supabase = await createClient();
    const userId = await this.getUserProfileId();

    const { error } = await supabase
      .from(this.TABLE_NAME)
      .delete()
      .eq("id", id)
      .eq("user_id", userId);

    if (error) {
      console.error("Error deleting template:", error);
      throw new Error("템플릿 삭제 중 오류가 발생했습니다.");
    }
  }
}
</file>

<file path="src/features/templates/types/template.ts">
import type { UTMParameters } from "@/features/links/types/utm";

export interface LinkTemplate {
  id: string;
  user_id: string;
  name: string;
  original_url: string;
  description: string | null;
  utm_source: string | null;
  utm_medium: string | null;
  utm_campaign: string | null;
  utm_term: string | null;
  utm_content: string | null;
  created_at: string | null;
  updated_at: string | null;
}

export interface CreateTemplateDTO {
  name: string;
  original_url: string;
  description?: string;
  utm_params?: UTMParameters;
}

export interface UpdateTemplateDTO {
  name?: string;
  original_url?: string;
  description?: string;
  utm_params?: UTMParameters;
}

export function templateToUTMParams(template: LinkTemplate): UTMParameters {
  return {
    utm_source: template.utm_source || "",
    utm_medium: template.utm_medium || "",
    utm_campaign: template.utm_campaign || "",
    utm_term: template.utm_term || "",
    utm_content: template.utm_content || "",
  };
}
</file>

<file path="src/hooks/use-mobile.ts">
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}
</file>

<file path="src/shared/components/ui/accordion.tsx">
"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDownIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  )
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  )
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pt-0 pb-4", className)}>{children}</div>
    </AccordionPrimitive.Content>
  )
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }
</file>

<file path="src/shared/components/ui/alert-dialog.tsx">
"use client";

import * as React from "react";
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/shared/components/ui/button";

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />;
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  );
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  );
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  );
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  );
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  );
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: "outline" }), className)}
      {...props}
    />
  );
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};
</file>

<file path="src/shared/components/ui/alert.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }
</file>

<file path="src/shared/components/ui/aspect-ratio.tsx">
"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />
}

export { AspectRatio }
</file>

<file path="src/shared/components/ui/avatar.tsx">
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-8 shrink-0 overflow-hidden rounded-full",
        className
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }
</file>

<file path="src/shared/components/ui/badge.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="src/shared/components/ui/breadcrumb.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",
        className
      )}
      {...props}
    />
  )
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn("inline-flex items-center gap-1.5", className)}
      {...props}
    />
  )
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn("hover:text-foreground transition-colors", className)}
      {...props}
    />
  )
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  )
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  )
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  )
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}
</file>

<file path="src/shared/components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
        destructive:
          "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="src/shared/components/ui/calendar.tsx">
"use client";

import * as React from "react";
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from "lucide-react";
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker";

import { cn } from "@/lib/utils";
import { Button, buttonVariants } from "@/shared/components/ui/button";

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"];
}) {
  const defaultClassNames = getDefaultClassNames();

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className,
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn(
          "flex gap-4 flex-col md:flex-row relative",
          defaultClassNames.months,
        ),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn(
          "flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",
          defaultClassNames.nav,
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous,
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next,
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption,
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns,
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root,
        ),
        dropdown: cn("absolute inset-0 opacity-0", defaultClassNames.dropdown),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label,
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday,
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn(
          "select-none w-(--cell-size)",
          defaultClassNames.week_number_header,
        ),
        week_number: cn(
          "text-[0.8rem] select-none text-muted-foreground",
          defaultClassNames.week_number,
        ),
        day: cn(
          "relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          defaultClassNames.day,
        ),
        range_start: cn(
          "rounded-l-md bg-accent",
          defaultClassNames.range_start,
        ),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today,
        ),
        outside: cn(
          "text-muted-foreground aria-selected:text-muted-foreground",
          defaultClassNames.outside,
        ),
        disabled: cn(
          "text-muted-foreground opacity-50",
          defaultClassNames.disabled,
        ),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          );
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return (
              <ChevronLeftIcon className={cn("size-4", className)} {...props} />
            );
          }

          if (orientation === "right") {
            return (
              <ChevronRightIcon
                className={cn("size-4", className)}
                {...props}
              />
            );
          }

          return (
            <ChevronDownIcon className={cn("size-4", className)} {...props} />
          );
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          );
        },
        ...components,
      }}
      {...props}
    />
  );
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames();

  const ref = React.useRef<HTMLButtonElement>(null);
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus();
  }, [modifiers.focused]);

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className,
      )}
      {...props}
    />
  );
}

export { Calendar, CalendarDayButton };
</file>

<file path="src/shared/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="src/shared/components/ui/carousel.tsx">
"use client";

import * as React from "react";
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react";
import { ArrowLeft, ArrowRight } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button } from "@/shared/components/ui/button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins,
  );
  const [canScrollPrev, setCanScrollPrev] = React.useState(false);
  const [canScrollNext, setCanScrollNext] = React.useState(false);

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return;
    setCanScrollPrev(api.canScrollPrev());
    setCanScrollNext(api.canScrollNext());
  }, []);

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev();
  }, [api]);

  const scrollNext = React.useCallback(() => {
    api?.scrollNext();
  }, [api]);

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault();
        scrollPrev();
      } else if (event.key === "ArrowRight") {
        event.preventDefault();
        scrollNext();
      }
    },
    [scrollPrev, scrollNext],
  );

  React.useEffect(() => {
    if (!api || !setApi) return;
    setApi(api);
  }, [api, setApi]);

  React.useEffect(() => {
    if (!api) return;
    onSelect(api);
    api.on("reInit", onSelect);
    api.on("select", onSelect);

    return () => {
      api?.off("select", onSelect);
    };
  }, [api, onSelect]);

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  );
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel();

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className,
      )}
      {...props}
    />
  );
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -left-12 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -right-12 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  );
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
};
</file>

<file path="src/shared/components/ui/chart.tsx">
"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >["children"]
}) {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean
    hideIndicator?: boolean
    indicator?: "line" | "dot" | "dashed"
    nameKey?: string
    labelKey?: string
  }) {
  const { config } = useChart()

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null
    }

    const [item] = payload
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`
    const itemConfig = getPayloadConfigFromPayload(config, item, key)
    const value =
      !labelKey && typeof label === "string"
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label

    if (labelFormatter) {
      return (
        <div className={cn("font-medium", labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      )
    }

    if (!value) {
      return null
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ])

  if (!active || !payload?.length) {
    return null
  }

  const nestLabel = payload.length === 1 && indicator !== "dot"

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item, index) => {
          const key = `${nameKey || item.name || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)
          const indicatorColor = color || item.payload.fill || item.color

          return (
            <div
              key={item.dataKey}
              className={cn(
                "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                indicator === "dot" && "items-center"
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",
                          {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent":
                              indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          }
                        )}
                        style={
                          {
                            "--color-bg": indicatorColor,
                            "--color-border": indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      "flex flex-1 justify-between leading-none",
                      nestLabel ? "items-end" : "items-center"
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          )
        })}
      </div>
    </div>
  )
}

const ChartLegend = RechartsPrimitive.Legend

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean
    nameKey?: string
  }) {
  const { config } = useChart()

  if (!payload?.length) {
    return null
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center gap-4",
        verticalAlign === "top" ? "pb-3" : "pt-3",
        className
      )}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || "value"}`
        const itemConfig = getPayloadConfigFromPayload(config, item, key)

        return (
          <div
            key={item.value}
            className={cn(
              "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3"
            )}
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        )
      })}
    </div>
  )
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}
</file>

<file path="src/shared/components/ui/checkbox.tsx">
"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { CheckIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }
</file>

<file path="src/shared/components/ui/collapsible.tsx">
"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  )
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  )
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent }
</file>

<file path="src/shared/components/ui/command.tsx">
"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk";
import { SearchIcon } from "lucide-react";

import { cn } from "@/lib/utils";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/shared/components/ui/dialog";

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
  className?: string;
  showCloseButton?: boolean;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn("overflow-hidden p-0", className)}
        showCloseButton={showCloseButton}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className,
      )}
      {...props}
    />
  );
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  );
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};
</file>

<file path="src/shared/components/ui/context-menu.tsx">
"use client"

import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  )
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  )
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  )
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  )
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  )
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  )
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  )
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  )
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}
</file>

<file path="src/shared/components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="src/shared/components/ui/drawer.tsx">
"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  )
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        "flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",
        className
      )}
      {...props}
    />
  )
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}
</file>

<file path="src/shared/components/ui/dropdown-menu.tsx">
"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}
</file>

<file path="src/shared/components/ui/form.tsx">
"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";
import { Slot } from "@radix-ui/react-slot";
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form";

import { cn } from "@/lib/utils";
import { Label } from "@/shared/components/ui/label";

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState } = useFormContext();
  const formState = useFormState({ name: fieldContext.name });
  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
);

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  );
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField();

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  );
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } =
    useFormField();

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  );
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField();

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message ?? "") : props.children;

  if (!body) {
    return null;
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  );
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
};
</file>

<file path="src/shared/components/ui/hover-card.tsx">
"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  )
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  )
}

export { HoverCard, HoverCardTrigger, HoverCardContent }
</file>

<file path="src/shared/components/ui/input-otp.tsx">
"use client"

import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { MinusIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        "flex items-center gap-2 has-disabled:opacity-50",
        containerClassName
      )}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  )
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn("flex items-center", className)}
      {...props}
    />
  )
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number
}) {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {}

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  )
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  )
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }
</file>

<file path="src/shared/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="src/shared/components/ui/label.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="src/shared/components/ui/menubar.tsx">
"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs",
        className
      )}
      {...props}
    />
  )
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  )
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none",
        className
      )}
      {...props}
    />
  )
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </MenubarPortal>
  )
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  )
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  )
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  )
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
}
</file>

<file path="src/shared/components/ui/navigation-menu.tsx">
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDownIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        "group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",
        className
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  )
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        "group flex flex-1 list-none items-center justify-center gap-1",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn("relative", className)}
      {...props}
    />
  )
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1"
)

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  )
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={cn(
        "absolute top-full left-0 isolate z-50 flex justify-center"
      )}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className
        )}
        {...props}
      />
    </div>
  )
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  )
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
}
</file>

<file path="src/shared/components/ui/pagination.tsx">
import * as React from "react";
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react";

import { cn } from "@/lib/utils";
import { Button, buttonVariants } from "@/shared/components/ui/button";

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  );
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  );
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />;
}

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className,
      )}
      {...props}
    />
  );
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  );
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  );
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  );
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
};
</file>

<file path="src/shared/components/ui/popover.tsx">
"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  )
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }
</file>

<file path="src/shared/components/ui/progress.tsx">
"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
        className
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  )
}

export { Progress }
</file>

<file path="src/shared/components/ui/radio-group.tsx">
"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props}
    />
  )
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
}

export { RadioGroup, RadioGroupItem }
</file>

<file path="src/shared/components/ui/resizable.tsx">
"use client"

import * as React from "react"
import { GripVerticalIcon } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
        className
      )}
      {...props}
    />
  )
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  )
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }
</file>

<file path="src/shared/components/ui/scroll-area.tsx">
"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }
</file>

<file path="src/shared/components/ui/select.tsx">
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="src/shared/components/ui/separator.tsx">
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className
      )}
      {...props}
    />
  )
}

export { Separator }
</file>

<file path="src/shared/components/ui/sheet.tsx">
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left"
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  )
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}
</file>

<file path="src/shared/components/ui/sidebar.tsx">
"use client";

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, VariantProps } from "class-variance-authority";
import { PanelLeftIcon } from "lucide-react";

import { useIsMobile } from "@/hooks/use-mobile";
import { cn } from "@/lib/utils";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Separator } from "@/shared/components/ui/separator";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/shared/components/ui/sheet";
import { Skeleton } from "@/shared/components/ui/skeleton";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/shared/components/ui/tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className,
        )}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
};
</file>

<file path="src/shared/components/ui/skeleton.tsx">
import { cn } from "@/lib/utils"

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  )
}

export { Skeleton }
</file>

<file path="src/shared/components/ui/slider.tsx">
"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max]
  )

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
        className
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn(
            "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full"
          )}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  )
}

export { Slider }
</file>

<file path="src/shared/components/ui/sonner.tsx">
"use client"

import { useTheme } from "next-themes"
import { Toaster as Sonner, ToasterProps } from "sonner"

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }
</file>

<file path="src/shared/components/ui/switch.tsx">
"use client"

import * as React from "react"
import * as SwitchPrimitive from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
        )}
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }
</file>

<file path="src/shared/components/ui/table.tsx">
"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="src/shared/components/ui/tabs.tsx">
"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        // Base styles
        "relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium whitespace-nowrap transition-all duration-200",
        // Inactive state
        "text-muted-foreground hover:text-foreground/80",
        // Active state - Primary + Liquid Glass
        "data-[state=active]:text-primary data-[state=active]:bg-primary/5 data-[state=active]:backdrop-blur-sm",
        "data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:shadow-[0_0_12px_-3px] data-[state=active]:shadow-primary/30",
        // Dark mode active - enhanced glow
        "dark:data-[state=active]:bg-primary/10 dark:data-[state=active]:shadow-primary/40",
        // Focus styles
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        // Disabled
        "disabled:pointer-events-none disabled:opacity-50",
        // SVG
        "[&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="src/shared/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props}
    />
  )
}

export { Textarea }
</file>

<file path="src/shared/components/ui/toggle-group.tsx">
"use client";

import * as React from "react";
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { toggleVariants } from "@/shared/components/ui/toggle";

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
});

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        "group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  );
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l",
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
}

export { ToggleGroup, ToggleGroupItem };
</file>

<file path="src/shared/components/ui/toggle.tsx">
"use client"

import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Toggle, toggleVariants }
</file>

<file path="src/shared/components/ui/tooltip.tsx">
"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  )
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  )
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  )
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
</file>

<file path="src/shared/types/supabase.ts">
// Re-export everything from the database types
export * from '@/shared/types/database.types';
</file>

<file path="src/shared/utils/request.ts">
/**
 * 요청 정보(IP, User-Agent 등)를 추출하는 유틸리티
 */
export const RequestUtils = {
  /**
   * 요청에서 IP 주소와 User-Agent 정보를 추출합니다.
   */
  getRequestInfo(req?: Request) {
    try {
      if (req) {
        // 직접 Request 객체가 전달된 경우 (API 라우트)
        const userAgent = req.headers.get("user-agent");
        const ip = req.headers.get("x-forwarded-for") || "unknown";
        return { userAgent, ip };
      }

      // Request 객체가 없는 경우 기본값 반환
      return {
        userAgent: null,
        ip: "unknown",
      };
    } catch (error) {
      console.error("Error getting request info:", error);
      return {
        userAgent: null,
        ip: "unknown",
      };
    }
  },
};
</file>

<file path="src/shared/utils/snowflake.ts">
/**
 * Snowflake 알고리즘을 사용한 고유 ID 생성기
 * 타임스탬프, 워커 ID, 시퀀스 번호를 조합하여 고유한 ID를 생성합니다.
 */
export class Snowflake {
  private static EPOCH = 1609459200000; // 2021-01-01 기준
  private static WORKER_ID = Math.floor(Math.random() * 1024); // 0-1023 사이의 랜덤 워커 ID
  private static SEQUENCE = 0;
  private static LAST_TIMESTAMP = -1;
  private static SEQUENCE_MASK = 4095; // 12비트 마스크 (0xFFF)
  private static TIMESTAMP_SHIFT = 22;
  private static WORKER_ID_SHIFT = 12;

  // Base62 문자셋 (0-9, a-z, A-Z)
  private static BASE62 =
    "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

  /**
   * 고유한 Base62 인코딩된 ID를 생성합니다.
   * @returns A unique string identifier (base62 encoded)
   */
  static async generate(): Promise<string> {
    const timestamp = Date.now();

    if (timestamp === Snowflake.LAST_TIMESTAMP) {
      Snowflake.SEQUENCE = (Snowflake.SEQUENCE + 1) & Snowflake.SEQUENCE_MASK;
      if (Snowflake.SEQUENCE === 0) {
        // Wait for next millisecond
        while (Date.now() <= timestamp) {
          // Busy wait
        }
      }
    } else {
      Snowflake.SEQUENCE = 0;
    }

    Snowflake.LAST_TIMESTAMP = timestamp;

    // Generate 64-bit ID (as BigInt for precision)
    const id =
      (BigInt(timestamp - Snowflake.EPOCH) <<
        BigInt(Snowflake.TIMESTAMP_SHIFT)) |
      (BigInt(Snowflake.WORKER_ID) << BigInt(Snowflake.WORKER_ID_SHIFT)) |
      BigInt(Snowflake.SEQUENCE);

    try {
      return Snowflake.toBase62(id);
    } catch {
      throw new Error("Failed to generate unique ID");
    }
  }

  /**
   * 숫자를 Base62로 인코딩합니다.
   */
  private static toBase62(num: bigint): string {
    if (num === BigInt(0)) {
      return "0"; // 0 처리
    }
    let result = "";
    let value = num;
    while (value > BigInt(0)) {
      result = Snowflake.BASE62[Number(value % BigInt(62))] + result;
      value = value / BigInt(62);
    }
    return result;
  }
}
</file>

<file path="src/shared/utils/string.ts">
/**
 * 문자열 조작과 관련된 유틸리티 함수들
 */
export const StringUtils = {
  /**
   * 문자열을 주어진 길이로 잘라내고 말줄임표를 추가합니다.
   */
  truncate(str: string, length: number): string {
    if (!str) return "";
    return str.length > length ? `${str.substring(0, length)}...` : str;
  },

  /**
   * URL에서 도메인 이름만 추출합니다.
   */
  extractDomain(url: string): string {
    try {
      const urlObj = new URL(url);
      return urlObj.hostname;
    } catch (error) {
      console.error("Error extracting domain from URL:", error);
      return url;
    }
  },
};
</file>

<file path="test/config/setup-test-env.ts">
import { beforeAll } from "vitest";
import { createClient } from "@supabase/supabase-js";

// 로컬 Supabase에 테이블 생성을 위한 setupFiles
beforeAll(async () => {
  const adminSupabase = createClient(
    process.env.SUPABASE_TEST_URL || "http://127.0.0.1:54321",
    process.env.SUPABASE_TEST_KEY ||
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU",
  );

  try {
    // 테이블 생성 시도
    try {
      await adminSupabase.rpc("postgres", {
        sql: `
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

        DROP TABLE IF EXISTS public.links;

        CREATE TABLE IF NOT EXISTS public.links (
          id uuid DEFAULT uuid_generate_v4() PRIMARY KEY,
          slug text NOT NULL UNIQUE,
          original_url text NOT NULL,
          click_count integer DEFAULT 0,
          created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
        );
      `,
      });
    } catch (e) {
      console.error("테이블 생성 에러:", e);
      // 첫 번째 방법이 실패하면 SQL 직접 실행을 시도
      await adminSupabase.rpc("exec", {
        sql: `
          CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

          DROP TABLE IF EXISTS public.links;

          CREATE TABLE IF NOT EXISTS public.links (
            id uuid DEFAULT uuid_generate_v4() PRIMARY KEY,
            slug text NOT NULL UNIQUE,
            original_url text NOT NULL,
            click_count integer DEFAULT 0,
            created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
          );
        `,
      });
    }

    console.log("Test environment setup completed");
  } catch (err) {
    console.warn("테이블 생성 에러. 이미 존재할 수 있습니다:", err);
  }
});
</file>

<file path="test/config/setup.ts">
import { createClient } from "@supabase/supabase-js";
import { beforeEach, afterAll } from "vitest";

// 테스트용 Supabase 클라이언트 설정 - 로컬 개발 환경의 URL과 키 사용
export const testSupabase = createClient(
  // 실제 로컬 Supabase 주소 사용
  process.env.SUPABASE_TEST_URL || "http://127.0.0.1:54321",
  // service_role 키 사용 - 테이블 생성 등 관리 작업에 필요
  process.env.SUPABASE_TEST_KEY ||
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU",
);

// 각 테스트 전에 데이터 초기화
beforeEach(async () => {
  try {
    // 테스트마다 데이터 정리
    await testSupabase
      .from("links")
      .delete()
      .neq("id", "00000000-0000-0000-0000-000000000000");
  } catch (err) {
    console.warn("테스트 데이터 초기화 중 오류 발생:", err);
  }
});

// 테스트 후에 실행될 정리
afterAll(async () => {
  try {
    // 테스트 데이터 최종 정리
    await testSupabase
      .from("links")
      .delete()
      .neq("id", "00000000-0000-0000-0000-000000000000");

    console.log("Test data cleaned up successfully");
  } catch (err) {
    console.error("Error cleaning up test environment:", err);
  }
});
</file>

<file path="test/services/link.service.test.ts">
import { describe, it, expect, beforeEach, vi, afterEach } from "vitest";
import { testSupabase } from "../config/setup";
import { LinkService } from "@/features/links/actions/link.service";

describe("LinkService", () => {
  describe("Snowflake Algorithm", () => {
    // 각 테스트 전에 데이터 정리 및 타이머 설정
    beforeEach(async () => {
      // 먼저 타이머 설정 초기화
      vi.resetAllMocks();
      vi.useFakeTimers();

      // 테스트 전에 테이블의 모든 기존 데이터 삭제
      await testSupabase
        .from("links")
        .delete()
        .neq("id", "00000000-0000-0000-0000-000000000000");
    });

    afterEach(() => {
      vi.useRealTimers();
    });

    it("생성된 slug는 base62 문자만 포함해야 합니다", async () => {
      // 각 테스트마다 다른 시간 사용
      vi.setSystemTime(new Date("2024-01-01T00:00:00Z"));

      const { slug } = await LinkService.createShortLink(
        {
          original_url: "https://example.com",
        },
        testSupabase,
      );

      expect(typeof slug).toBe("string");
      expect(slug).toMatch(/^[0-9a-zA-Z]+$/);
    });

    it("다른 시간에 생성된 slug는 서로 달라야 합니다", async () => {
      // 충분히 다른 시간 설정
      vi.setSystemTime(new Date("2024-01-02T00:00:00Z"));

      // 첫 번째 slug 생성
      const link1 = await LinkService.createShortLink(
        {
          original_url: "https://example1.com",
        },
        testSupabase,
      );

      // 시간을 앞으로 이동
      vi.advanceTimersByTime(1000);

      const link2 = await LinkService.createShortLink(
        {
          original_url: "https://example2.com",
        },
        testSupabase,
      );

      expect(link1.slug).not.toBe(link2.slug);
    });

    it("같은 밀리초에 생성된 slug도 서로 달라야 합니다", async () => {
      // 이전 테스트와 다른 시간 설정
      vi.setSystemTime(new Date("2024-01-03T00:00:00Z"));

      // 순차적으로 실행
      const link1 = await LinkService.createShortLink(
        {
          original_url: "https://example1.com",
        },
        testSupabase,
      );
      const link2 = await LinkService.createShortLink(
        {
          original_url: "https://example2.com",
        },
        testSupabase,
      );
      const link3 = await LinkService.createShortLink(
        {
          original_url: "https://example3.com",
        },
        testSupabase,
      );

      const slugs = [link1, link2, link3];
      const uniqueSlugs = new Set(slugs.map((link) => link.slug));
      expect(uniqueSlugs.size).toBe(slugs.length);
    });

    it("생성된 slug의 길이는 일정 범위 내여야 합니다", async () => {
      // 이전 테스트와 겹치지 않는 시간 설정
      vi.setSystemTime(new Date("2024-01-04T00:00:00Z"));

      const { slug } = await LinkService.createShortLink(
        {
          original_url: "https://example.com",
        },
        testSupabase,
      );

      expect(slug.length).toBeGreaterThanOrEqual(8);
      expect(slug.length).toBeLessThanOrEqual(13);
    });

    it("생성된 모든 링크를 확인합니다", async () => {
      // 테스트를 위한 링크 생성
      const testUrls = [
        "https://example.com/1",
        "https://example.com/2",
        "https://example.com/3",
      ];

      // 여러 링크 생성
      for (const url of testUrls) {
        await LinkService.createShortLink({ original_url: url }, testSupabase);
      }

      // 생성된 링크 조회
      const { data: links, error } = await testSupabase
        .from("links")
        .select("*")
        .order("created_at", { ascending: false });

      // 에러가 없어야 함
      expect(error).toBeNull();

      // 데이터가 존재해야 함
      expect(links).not.toBeNull();
      expect(links?.length).toBeGreaterThan(0);

      // 각 링크 데이터 출력
      console.log("\n=== 생성된 링크 목록 ===");
      links?.forEach((link) => {
        console.log(`원본 URL: ${link.original_url}`);
        console.log(`단축 URL: ${link.slug}`);
        console.log(`생성 시간: ${link.created_at}`);
        console.log("------------------------");
      });
    });
  });
});
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {
    "@react-bits": "https://reactbits.dev/r/{name}.json"
  }
}
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="src/app/admin/analytics/page.tsx">
/**
 * @file src/app/admin/analytics/page.tsx
 * @description 관리자 링크 분석 페이지
 */

import { LinkService } from "@/features/links/actions/link.service";
import MarketingAnalytics from "@/features/analytics/components/marketing-analytics";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/shared/components/ui/tabs";
import ClickAnalytics from "@/features/analytics/components/click-analytics";
import LinkList from "@/features/links/components/link-list";
import { BarChart3 } from "lucide-react";

// 동적 렌더링 강제 설정
export const dynamic = "force-dynamic";

export default async function AdminAnalyticsPage() {
  const initialLinks = await LinkService.getTopLinks(10);

  return (
    <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="flex items-center gap-3">
        <div className="p-3 rounded-2xl bg-white dark:bg-white/10 shadow-sm border border-black/5 dark:border-white/5">
          <BarChart3 className="h-6 w-6 text-primary" />
        </div>
        <div>
          <h1 className="text-3xl font-bold tracking-tight text-foreground">링크 분석</h1>
          <p className="text-muted-foreground mt-1 text-sm font-medium">실시간 데이터와 심층 분석을 통해 인사이트를 얻으세요.</p>
        </div>
      </div>

      <Tabs defaultValue="marketing" className="space-y-8">
        <TabsList className="w-full justify-start h-12 bg-muted/50 dark:bg-white/5 p-1 rounded-xl border border-black/5 dark:border-white/10 shadow-sm backdrop-blur-md">
          <TabsTrigger value="marketing" className="h-10 px-6 rounded-lg">마케팅 분석</TabsTrigger>
          <TabsTrigger value="overview" className="h-10 px-6 rounded-lg">전체 통계</TabsTrigger>
          <TabsTrigger value="links" className="h-10 px-6 rounded-lg">링크 목록</TabsTrigger>
        </TabsList>

        <TabsContent value="marketing" className="space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300">
          {/* MarketingAnalytics might contain its own cards, so we just ensure it has a nice container if needed, or rely on its internal structure. 
               Assuming it needs a wrapper for consistency if it doesn't have one. */}
          <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)]">
            <MarketingAnalytics />
          </div>
        </TabsContent>

        <TabsContent value="overview" className="space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300">
          <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)]">
            <ClickAnalytics />
          </div>
        </TabsContent>

        <TabsContent value="links" className="space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300">
          <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)]">
            <LinkList initialLinks={initialLinks} />
          </div>
        </TabsContent>
      </Tabs>
    </div>
  );
}
</file>

<file path="src/app/admin/links/page.tsx">
/**
 * @file src/app/admin/links/page.tsx
 * @description 관리자 링크 관리 페이지
 */

import { LinkService } from "@/features/links/actions/link.service";
import UrlInputForm from "@/features/links/components/url/url-input-form";
import LinkList from "@/features/links/components/link-list";
import { Link2 } from "lucide-react";

// 동적 렌더링 강제 설정
export const dynamic = "force-dynamic";

export default async function AdminLinksPage() {
  const initialLinks = await LinkService.getTopLinks(10);

  return (
    <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="flex items-center gap-3 mb-8">
        <div className="p-3 rounded-2xl bg-white dark:bg-white/10 shadow-sm border-none">
          <Link2 className="h-6 w-6 text-primary" />
        </div>
        <div>
          <h1 className="text-3xl font-bold tracking-tight text-foreground">링크 관리</h1>
          <p className="text-muted-foreground mt-1 text-sm font-medium">새로운 링크를 생성하고 관리하세요.</p>
        </div>
      </div>

      {/* Create new link section */}
      <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)]">
        <div className="mb-6">
          <h2 className="text-xl font-bold text-foreground">새 링크 생성</h2>
          <p className="text-sm text-muted-foreground mt-1">긴 URL을 짧고 간결한 링크로 변환하세요.</p>
        </div>
        <UrlInputForm />
      </div>

      {/* Links list */}
      <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)]">
        <div className="mb-6 flex items-center justify-between">
          <div>
            <h2 className="text-xl font-bold text-foreground">링크 목록</h2>
            <p className="text-sm text-muted-foreground mt-1">최근 생성된 링크 목록입니다.</p>
          </div>
        </div>
        <LinkList initialLinks={initialLinks} />
      </div>
    </div>
  );
}
</file>

<file path="src/app/admin/settings/page.tsx">
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import { redirect } from "next/navigation";
import { Button } from "@/shared/components/ui/button";
import { Settings, ArrowLeft } from "lucide-react";
import Link from "next/link";

export default async function SettingsPage() {
  // Require admin authentication
  const user = await ClerkAuthService.requireAuth({
    requiredStatus: "approved",
    requireAdmin: true,
  });

  if (!user) {
    redirect("/admin/login");
  }

  return (
    <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="flex items-center gap-3">
        <div className="p-3 rounded-2xl bg-white dark:bg-white/10 shadow-sm border border-black/5 dark:border-white/5">
          <Settings className="h-6 w-6 text-primary" />
        </div>
        <div>
          <h1 className="text-3xl font-bold tracking-tight text-foreground">설정</h1>
          <p className="text-muted-foreground mt-1 text-sm font-medium">플랫폼 환경설정 및 관리자 옵션을 구성하세요.</p>
        </div>
      </div>

      <div className="bg-white dark:bg-white/5 rounded-2xl p-12 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] flex flex-col items-center text-center space-y-8 min-h-[500px] justify-center text-balance">

        <div className="relative">
          <div className="absolute inset-0 bg-gradient-to-br from-primary/20 to-accent/20 blur-3xl opacity-50 rounded-full" />
          <div className="relative h-24 w-24 rounded-3xl bg-gradient-to-br from-white to-gray-50 dark:from-white/10 dark:to-white/5 border border-white/20 shadow-xl flex items-center justify-center">
            <Settings className="h-10 w-10 text-primary animate-[spin_10s_linear_infinite]" />
          </div>
        </div>

        <div className="space-y-2 max-w-md">
          <h2 className="text-2xl font-bold">기능 준비 중입니다</h2>
          <p className="text-muted-foreground">
            더 나은 설정 경험을 제공하기 위해 열심히 개발하고 있습니다.<br />
            계정 관리, 테마 설정, 알림 설정 등의 기능이 곧 추가될 예정입니다.
          </p>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-lg text-left">
          {[
            "계정 및 프로필 관리",
            "테마 및 UI 커스터마이징",
            "알림 및 이메일 설정",
            "링크 기본 옵션 설정"
          ].map((item, i) => (
            <div key={i} className="flex items-center gap-3 p-4 rounded-xl bg-white/50 dark:bg-white/5 border border-black/5 dark:border-white/5">
              <div className="h-2 w-2 rounded-full bg-primary/50" />
              <span className="text-sm font-medium">{item}</span>
            </div>
          ))}
        </div>

        <div className="pt-8">
          <Button variant="outline" size="lg" className="rounded-full px-8 hover:bg-secondary/50" asChild>
            <Link href="/admin/dashboard">
              <ArrowLeft className="mr-2 h-4 w-4" />
              대시보드로 돌아가기
            </Link>
          </Button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/app/admin/page.tsx">
/**
 * @file src/app/admin/page.tsx
 * @description 관리자 페이지 메인 진입점
 *
 * 이 컴포넌트는 사용자가 /admin으로 접근했을 때 대시보드로 리다이렉트합니다.
 *
 * 주요 기능:
 * 1. /admin/dashboard로 자동 리다이렉트
 * 2. 미들웨어에서 인증 상태 확인
 *
 * 핵심 구현 로직:
 * - 단순 리다이렉트 처리
 * - 미들웨어에서 쿠키 기반 인증 확인
 *
 * @dependencies
 * - next/navigation: 리다이렉트 기능
 */

import { redirect } from "next/navigation";

// 동적 렌더링 강제 설정 (미들웨어에서 쿠키 사용으로 인한 Static Generation 방지)
export const dynamic = "force-dynamic";

export default function AdminPage() {
  redirect("/admin/dashboard");
}
</file>

<file path="src/app/not-found.tsx">
import Link from 'next/link';
import { Button } from '@/shared/components/ui/button';
import { Home, AlertCircle, Search } from 'lucide-react';
import NotFoundBackButton from './not-found-back-button';

export default function NotFound() {
  return (
    <main className="relative flex flex-col items-center justify-center min-h-screen p-4 bg-gradient-to-br from-background via-muted/10 to-background overflow-hidden">
      {/* Background Effects */}
      <div className="absolute inset-0 bg-gradient-to-tr from-primary/5 via-transparent to-accent/5" />
      <div className="absolute top-40 left-20 w-96 h-96 bg-primary/10 rounded-full blur-3xl" />
      <div className="absolute bottom-40 right-20 w-96 h-96 bg-accent/10 rounded-full blur-3xl" />

      <div className="relative z-10 text-center max-w-2xl animate-in">
        {/* Icon */}
        <div className="mx-auto w-24 h-24 rounded-2xl bg-gradient-to-br from-primary/20 to-accent/20 backdrop-blur-xl flex items-center justify-center mb-8 shadow-2xl shadow-primary/20">
          <AlertCircle className="h-12 w-12 text-primary" />
        </div>

        {/* 404 Text */}
        <h1 className="text-7xl sm:text-8xl font-black mb-4">
          <span className="bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent animate-gradient-x bg-300%">
            404
          </span>
        </h1>

        {/* Description */}
        <h2 className="text-2xl sm:text-3xl font-bold text-foreground mb-4">
          페이지를 찾을 수 없습니다
        </h2>
        <p className="text-lg text-muted-foreground mb-8 max-w-md mx-auto">
          요청하신 페이지가 존재하지 않거나 이동되었을 수 있습니다. URL을 다시
          확인해주세요.
        </p>

        {/* Action Buttons */}
        <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <Button
            size="lg"
            className="min-w-[200px] h-12 bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white font-semibold shadow-lg shadow-primary/30 hover:shadow-primary/50 transition-all hover:scale-105"
            asChild
          >
            <Link href="/">
              <Home className="mr-2 h-5 w-5" />
              홈으로 돌아가기
            </Link>
          </Button>

          <NotFoundBackButton />
        </div>

        {/* Search Suggestion */}
        <div className="mt-12 p-6 rounded-2xl bg-gradient-to-br from-background/60 to-background/40 backdrop-blur-md border border-primary/10">
          <div className="flex items-center gap-2 text-sm text-muted-foreground mb-2">
            <Search className="h-4 w-4" />
            <span className="font-medium">자주 찾는 페이지</span>
          </div>
          <div className="flex flex-wrap gap-2 justify-center">
            <Link
              href="/shorten"
              className="px-4 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm font-medium transition-all hover:scale-105"
            >
              URL 단축하기
            </Link>
            <Link
              href="/admin/login"
              className="px-4 py-2 rounded-lg bg-accent/10 hover:bg-accent/20 text-accent text-sm font-medium transition-all hover:scale-105"
            >
              로그인
            </Link>
            <Link
              href="/admin/register"
              className="px-4 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm font-medium transition-all hover:scale-105"
            >
              회원가입
            </Link>
          </div>
        </div>
      </div>
    </main>
  );
}
</file>

<file path="src/features/analytics/actions/get-analytics.ts">
"use server";

import { LinkService } from "@/features/links/actions/link.service";

export async function getMarketingAnalytics(
  linkId: string,
  dateRange?: { startDate?: string; endDate?: string }
) {
  try {
    const parsedDateRange = dateRange
      ? {
          startDate: dateRange.startDate ? new Date(dateRange.startDate) : undefined,
          endDate: dateRange.endDate ? new Date(dateRange.endDate) : undefined,
        }
      : undefined;

    const analytics = await LinkService.getMarketingAnalytics(linkId, parsedDateRange);
    return { success: true, data: analytics };
  } catch (error) {
    console.error("Error getting marketing analytics:", error);
    return {
      success: false,
      error: error instanceof Error ? error.message : "Failed to fetch analytics"
    };
  }
}

export async function getAllLinksForAnalytics(
  dateRange?: { startDate?: string; endDate?: string }
) {
  try {
    const parsedDateRange = dateRange
      ? {
          startDate: dateRange.startDate ? new Date(dateRange.startDate) : undefined,
          endDate: dateRange.endDate ? new Date(dateRange.endDate) : undefined,
        }
      : undefined;

    const links = await LinkService.getAllLinksWithPeriodClicks(parsedDateRange);
    return { success: true, data: links };
  } catch (error) {
    console.error("Error getting links:", error);
    return {
      success: false,
      error: error instanceof Error ? error.message : "Failed to fetch links"
    };
  }
}
</file>

<file path="src/features/analytics/components/marketing-analytics.tsx">
"use client";

import { useState, useEffect } from "react";
import { getMarketingAnalytics, getAllLinksForAnalytics } from "@/features/analytics/actions/get-analytics";
import { Card, CardContent, CardHeader, CardTitle } from "@/shared/components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/shared/components/ui/select";
import { Progress } from "@/shared/components/ui/progress";
import { Badge } from "@/shared/components/ui/badge";
import { Button } from "@/shared/components/ui/button";
import {
  TrendingUp,
  TrendingDown,
  Minus,
  Clock,
  MousePointer,
  Users,
  Globe,
  Smartphone,
  Monitor,
  Tablet,
  Calendar,
  ArrowRight
} from "lucide-react";
import { Line, Doughnut } from "react-chartjs-2";
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  ArcElement,
  Title,
  Tooltip,
  Legend,
  ChartOptions,
} from "chart.js";
import { cn } from "@/lib/utils";
import { getBaseUrl } from "@/lib/url";

ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  ArcElement,
  Title,
  Tooltip,
  Legend
);

interface MarketingAnalyticsProps {
  linkId?: string;
}

interface AnalyticsData {
  totalClicks: number;
  uniqueClicks: number;
  clicksByHour: { hour: number; clicks: number }[];
  clicksByDevice: { device: string; clicks: number }[];
  clicksByCountry: { country: string; clicks: number }[];
  conversionRate: number;
  avgClicksPerDay: number;
  clickTrend: 'up' | 'down' | 'stable';
}

interface LinkData {
  id: string;
  slug: string;
  original_url: string;
  description?: string | null;
  created_at: string;
  click_count: number;
  period_clicks?: number;
  user_id: string | null;
}

type DateRangePreset = '7d' | '30d' | '3m' | '6m' | 'all' | 'custom';

export default function MarketingAnalytics({ linkId: propLinkId }: MarketingAnalyticsProps) {
  const [selectedLinkId, setSelectedLinkId] = useState<string>(propLinkId || "");
  const [links, setLinks] = useState<LinkData[]>([]);
  const [analytics, setAnalytics] = useState<AnalyticsData | null>(null);
  const [loading, setLoading] = useState(false);
  const [dateRangePreset, setDateRangePreset] = useState<DateRangePreset>('all');
  const [customStartDate, setCustomStartDate] = useState<string>('');
  const [customEndDate, setCustomEndDate] = useState<string>('');

  const getDateRange = (): { startDate?: string; endDate?: string } | undefined => {
    const now = new Date();
    const endDate = now.toISOString();

    switch (dateRangePreset) {
      case '7d': {
        const startDate = new Date(now);
        startDate.setDate(startDate.getDate() - 7);
        return { startDate: startDate.toISOString(), endDate };
      }
      case '30d': {
        const startDate = new Date(now);
        startDate.setDate(startDate.getDate() - 30);
        return { startDate: startDate.toISOString(), endDate };
      }
      case '3m': {
        const startDate = new Date(now);
        startDate.setMonth(startDate.getMonth() - 3);
        return { startDate: startDate.toISOString(), endDate };
      }
      case '6m': {
        const startDate = new Date(now);
        startDate.setMonth(startDate.getMonth() - 6);
        return { startDate: startDate.toISOString(), endDate };
      }
      case 'custom': {
        if (customStartDate && customEndDate) {
          return {
            startDate: new Date(customStartDate).toISOString(),
            endDate: new Date(customEndDate).toISOString(),
          };
        }
        return undefined;
      }
      case 'all':
      default:
        return undefined;
    }
  };

  const fetchLinks = async () => {
    const dateRange = getDateRange();
    const result = await getAllLinksForAnalytics(
      dateRange ? { startDate: dateRange.startDate, endDate: dateRange.endDate } : undefined
    );
    if (result.success && result.data) {
      setLinks(result.data);
      if (!propLinkId && result.data.length > 0 && !selectedLinkId) {
        setSelectedLinkId(result.data[0].id);
      }
    }
  };

  const fetchAnalytics = async () => {
    setLoading(true);
    try {
      const dateRange = getDateRange();
      const result = await getMarketingAnalytics(selectedLinkId, dateRange);
      if (result.success && result.data) {
        setAnalytics(result.data);
      } else {
        console.error("Error fetching analytics:", result.error);
      }
    } catch (error) {
      console.error("Error fetching analytics:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchLinks();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [propLinkId, dateRangePreset, customStartDate, customEndDate]);

  useEffect(() => {
    if (selectedLinkId) {
      fetchAnalytics();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [selectedLinkId, dateRangePreset, customStartDate, customEndDate]);

  if (!selectedLinkId || loading) {
    return (
      <div className="flex flex-col items-center justify-center h-96 gap-4">
        <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-primary"></div>
        <p className="text-muted-foreground animate-pulse">데이터를 분석하고 있습니다...</p>
      </div>
    );
  }

  if (!analytics) {
    return null;
  }

  const hourlyChartData = {
    labels: analytics.clicksByHour.map((h) => `${h.hour}시`),
    datasets: [
      {
        label: "시간대별 클릭 수",
        data: analytics.clicksByHour.map((h) => h.clicks),
        backgroundColor: "rgba(46, 108, 255, 0.1)", // Primary color with opacity
        borderColor: "#2E6CFF", // Primary color
        borderWidth: 2,
        tension: 0.4,
        fill: true,
      },
    ],
  };

  const deviceChartData = {
    labels: analytics.clicksByDevice.map((d) =>
      d.device === "Desktop" ? "데스크톱" :
        d.device === "Mobile" ? "모바일" :
          d.device === "Tablet" ? "태블릿" : "기타"
    ),
    datasets: [
      {
        data: analytics.clicksByDevice.map((d) => d.clicks),
        backgroundColor: [
          "#2E6CFF", // Primary
          "#10B981", // Emerald
          "#F59E0B", // Amber
          "#8B5CF6", // Violet
        ],
        borderWidth: 0,
        hoverOffset: 4,
      },
    ],
  };

  const chartOptions: ChartOptions<"line"> = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false,
      },
      tooltip: {
        backgroundColor: 'rgba(0, 0, 0, 0.8)',
        padding: 12,
        titleFont: { size: 13 },
        bodyFont: { size: 13 },
        cornerRadius: 8,
        displayColors: false,
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        grid: {
          color: 'rgba(0, 0, 0, 0.05)',
        },
        border: {
          display: false,
        }
      },
      x: {
        grid: {
          display: false,
        },
        border: {
          display: false,
        }
      }
    },
  };

  const doughnutOptions: ChartOptions<"doughnut"> = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: "right",
        labels: {
          usePointStyle: true,
          pointStyle: 'circle',
          padding: 20,
        }
      },
    },
    cutout: "70%",
  };

  const getTrendIcon = (trend: string) => {
    switch (trend) {
      case "up":
        return <TrendingUp className="h-4 w-4 text-emerald-500" />;
      case "down":
        return <TrendingDown className="h-4 w-4 text-rose-500" />;
      default:
        return <Minus className="h-4 w-4 text-muted-foreground" />;
    }
  };

  const getDeviceIcon = (device: string) => {
    switch (device) {
      case "Desktop":
        return <Monitor className="h-4 w-4" />;
      case "Mobile":
        return <Smartphone className="h-4 w-4" />;
      case "Tablet":
        return <Tablet className="h-4 w-4" />;
      default:
        return <Globe className="h-4 w-4" />;
    }
  };

  return (
    <div className="space-y-8 animate-in fade-in duration-500">
      {/* Link Selector */}
      {!propLinkId && (
        <div className="mb-8">
          <Select value={selectedLinkId} onValueChange={setSelectedLinkId}>
            <SelectTrigger className="w-full max-w-md h-12 bg-white dark:bg-white/5 border-black/5 dark:border-white/10 shadow-sm rounded-xl">
              <SelectValue placeholder="분석할 링크를 선택하세요" />
            </SelectTrigger>
            <SelectContent>
              {links.map((link) => (
                <SelectItem key={link.id} value={link.id}>
                  <div className="flex flex-col py-1">
                    <div className="flex items-center gap-2">
                      <span className="font-medium text-foreground">{link.description || '제목 없음'}</span>
                      {link.slug && <span className="text-xs text-muted-foreground bg-muted px-1.5 py-0.5 rounded">/{link.slug}</span>}
                    </div>
                    <span className="text-xs text-muted-foreground mt-0.5 truncate max-w-[300px]">
                      {link.original_url}
                    </span>
                  </div>
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
      )}

      {/* Date Range Selector */}
      <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
        <CardHeader className="pb-4">
          <CardTitle className="flex items-center gap-2 text-lg font-bold">
            <div className="p-2 rounded-lg bg-primary/10 text-primary">
              <Calendar className="h-5 w-5" />
            </div>
            날짜 범위 선택
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-6">
            <div className="flex flex-wrap gap-2">
              {[
                { key: '7d', label: '최근 7일' },
                { key: '30d', label: '최근 30일' },
                { key: '3m', label: '최근 3개월' },
                { key: '6m', label: '최근 6개월' },
                { key: 'all', label: '전체 기간' },
                { key: 'custom', label: '사용자 정의' },
              ].map((range) => (
                <Button
                  key={range.key}
                  variant={dateRangePreset === range.key ? 'default' : 'ghost'}
                  size="sm"
                  onClick={() => setDateRangePreset(range.key as DateRangePreset)}
                  className={cn(
                    "rounded-full px-4 text-xs font-medium transition-all duration-300",
                    dateRangePreset === range.key
                      ? "shadow-md shadow-primary/20"
                      : "bg-muted/30 hover:bg-muted text-muted-foreground"
                  )}
                >
                  {range.label}
                </Button>
              ))}
            </div>

            {/* Custom Date Range Inputs */}
            {dateRangePreset === 'custom' && (
              <div className="flex items-end gap-4 p-4 rounded-xl bg-muted/20 border border-black/5 dark:border-white/5 animate-in fade-in slide-in-from-top-2">
                <div className="space-y-2">
                  <label className="text-xs font-semibold text-muted-foreground ml-1">시작일</label>
                  <input
                    type="date"
                    value={customStartDate}
                    onChange={(e) => setCustomStartDate(e.target.value)}
                    className="h-10 px-3 py-2 rounded-lg border border-black/10 dark:border-white/10 bg-white dark:bg-black/20 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20"
                  />
                </div>
                <div className="h-10 flex items-center text-muted-foreground">
                  <ArrowRight className="h-4 w-4" />
                </div>
                <div className="space-y-2">
                  <label className="text-xs font-semibold text-muted-foreground ml-1">종료일</label>
                  <input
                    type="date"
                    value={customEndDate}
                    onChange={(e) => setCustomEndDate(e.target.value)}
                    className="h-10 px-3 py-2 rounded-lg border border-black/10 dark:border-white/10 bg-white dark:bg-black/20 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20"
                  />
                </div>
              </div>
            )}

            {/* Display Selected Range */}
            <div className="flex items-center gap-2 text-sm text-muted-foreground bg-muted/20 w-fit px-3 py-1.5 rounded-lg">
              <div className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse" />
              {dateRangePreset === 'all' && '전체 데이터를 표시합니다'}
              {dateRangePreset === '7d' && '최근 7일 데이터를 표시합니다'}
              {dateRangePreset === '30d' && '최근 30일 데이터를 표시합니다'}
              {dateRangePreset === '3m' && '최근 3개월 데이터를 표시합니다'}
              {dateRangePreset === '6m' && '최근 6개월 데이터를 표시합니다'}
              {dateRangePreset === 'custom' && customStartDate && customEndDate &&
                `${customStartDate} ~ ${customEndDate} 데이터를 표시합니다`}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Current Link Info */}
      {selectedLinkId && (() => {
        const currentLink = links.find(l => l.id === selectedLinkId);
        if (!currentLink) return null;

        return (
          <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
            <CardHeader className="pb-4">
              <CardTitle className="text-lg font-bold">선택된 링크 정보</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 bg-muted/20 p-5 rounded-xl border border-black/5 dark:border-white/5">
                <div className="space-y-1">
                  <span className="text-xs font-semibold text-muted-foreground uppercase tracking-wider">Title</span>
                  <p className="text-base font-medium text-foreground">{currentLink.description || '설명 없음'}</p>
                </div>
                <div className="space-y-1">
                  <span className="text-xs font-semibold text-muted-foreground uppercase tracking-wider">Short URL</span>
                  <p className="text-base font-medium text-primary flex items-center gap-1 hover:underline cursor-pointer">
                    {getBaseUrl()}/{currentLink.slug}
                    <ArrowRight className="h-3 w-3 -rotate-45" />
                  </p>
                </div>
                <div className="col-span-1 md:col-span-2 space-y-1">
                  <span className="text-xs font-semibold text-muted-foreground uppercase tracking-wider">Original Destination</span>
                  <p className="text-sm text-muted-foreground break-all bg-white dark:bg-black/10 p-2 rounded border border-black/5 dark:border-white/5 font-mono">
                    {currentLink.original_url}
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>
        );
      })()}

      {/* Key Metrics */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl hover:-translate-y-1 transition-transform cursor-default">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">총 클릭 수</CardTitle>
            <div className="p-2 rounded-lg bg-blue-50 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400">
              <MousePointer className="h-4 w-4" />
            </div>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-black text-foreground">{analytics.totalClicks.toLocaleString()}</div>
            <div className="flex items-center mt-2 p-1 px-2 rounded-md bg-muted/50 w-fit">
              {getTrendIcon(analytics.clickTrend)}
              <span className="text-xs font-medium ml-1.5">
                {analytics.clickTrend === "up" ? "상승 추세" :
                  analytics.clickTrend === "down" ? "하락 추세" : "변동 없음"}
              </span>
            </div>
          </CardContent>
        </Card>

        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl hover:-translate-y-1 transition-transform cursor-default">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">고유 방문자</CardTitle>
            <div className="p-2 rounded-lg bg-emerald-50 dark:bg-emerald-500/20 text-emerald-600 dark:text-emerald-400">
              <Users className="h-4 w-4" />
            </div>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-black text-foreground">{analytics.uniqueClicks.toLocaleString()}</div>
            <div className="mt-3">
              <Progress
                value={(analytics.uniqueClicks / Math.max(analytics.totalClicks, 1)) * 100}
                className="h-1.5"
              // indicatorClassName="bg-emerald-500" // Requires custom progress component usually
              />
            </div>
            <p className="text-xs font-medium text-muted-foreground mt-2 flex items-center">
              <span className="text-emerald-500 mr-1.5">{analytics.conversionRate.toFixed(1)}%</span> 전환율
            </p>
          </CardContent>
        </Card>

        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl hover:-translate-y-1 transition-transform cursor-default">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">일 평균 클릭</CardTitle>
            <div className="p-2 rounded-lg bg-orange-50 dark:bg-orange-500/20 text-orange-600 dark:text-orange-400">
              <Clock className="h-4 w-4" />
            </div>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-black text-foreground">
              {analytics.avgClicksPerDay.toFixed(1)}
            </div>
            <p className="text-xs font-medium text-muted-foreground mt-2">
              하루 평균 클릭 수
            </p>
          </CardContent>
        </Card>

        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl hover:-translate-y-1 transition-transform cursor-default">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">최적 시간대</CardTitle>
            <div className="p-2 rounded-lg bg-violet-50 dark:bg-violet-500/20 text-violet-600 dark:text-violet-400">
              <TrendingUp className="h-4 w-4" />
            </div>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-black text-foreground">
              {analytics.clicksByHour.length > 0 ? analytics.clicksByHour.reduce((max, current) =>
                current.clicks > max.clicks ? current : max
              ).hour + "시" : "-"}
            </div>
            <p className="text-xs font-medium text-muted-foreground mt-2">
              가장 많은 클릭이 발생하는 시간
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Charts */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Hourly Clicks Chart */}
        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-lg font-bold">
              <div className="p-2 rounded-lg bg-blue-50 dark:bg-blue-500/10 text-blue-500">
                <Clock className="h-5 w-5" />
              </div>
              시간대별 클릭 분포
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="h-[300px] w-full mt-4">
              <Line data={hourlyChartData} options={chartOptions} />
            </div>
          </CardContent>
        </Card>

        {/* Device Distribution */}
        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-lg font-bold">
              <div className="p-2 rounded-lg bg-purple-50 dark:bg-purple-500/10 text-purple-500">
                <Smartphone className="h-5 w-5" />
              </div>
              디바이스별 클릭 분포
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="h-[300px] w-full mt-4 flex justify-center">
              <Doughnut data={deviceChartData} options={doughnutOptions} />
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Device Details */}
      <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
        <CardHeader>
          <CardTitle className="text-lg font-bold">디바이스별 상세 통계</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {analytics.clicksByDevice.map((device) => {
              const percentage = (device.clicks / Math.max(analytics.totalClicks, 1)) * 100;
              return (
                <div key={device.device} className="flex items-center space-x-4 p-3 rounded-xl hover:bg-muted/30 transition-colors">
                  <div className="flex items-center gap-3 w-32">
                    <div className="p-2 rounded-lg bg-muted text-muted-foreground">
                      {getDeviceIcon(device.device)}
                    </div>
                    <span className="text-sm font-semibold text-foreground">
                      {device.device === "Desktop" ? "데스크톱" :
                        device.device === "Mobile" ? "모바일" :
                          device.device === "Tablet" ? "태블릿" : "기타"}
                    </span>
                  </div>
                  <div className="flex-1">
                    <div className="h-2.5 w-full bg-muted/40 rounded-full overflow-hidden">
                      <div
                        className="h-full rounded-full bg-primary"
                        style={{ width: `${percentage}%` }}
                      />
                    </div>
                  </div>
                  <div className="w-24 text-right">
                    <span className="block text-sm font-bold text-foreground">{device.clicks}</span>
                    <span className="text-xs text-muted-foreground">
                      {percentage.toFixed(1)}%
                    </span>
                  </div>
                </div>
              );
            })}
          </div>
        </CardContent>
      </Card>

      {/* Geographic Distribution (Sample Data) */}
      <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-lg font-bold">
            <div className="p-2 rounded-lg bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500">
              <Globe className="h-5 w-5" />
            </div>
            지역별 클릭 분포
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {analytics.clicksByCountry.map((country) => {
              const percentage = (country.clicks / Math.max(analytics.totalClicks, 1)) * 100;
              return (
                <div key={country.country} className="flex items-center justify-between p-3 rounded-xl hover:bg-muted/30 transition-colors border border-transparent hover:border-muted">
                  <div className="flex items-center gap-3">
                    <Badge variant="secondary" className="px-2 py-1 text-sm">{country.country}</Badge>
                  </div>
                  <div className="flex items-center gap-4">
                    <div className="w-32 h-2.5 bg-muted/40 rounded-full overflow-hidden">
                      <div className="h-full bg-emerald-500 rounded-full" style={{ width: `${percentage}%` }} />
                    </div>
                    <span className="text-sm font-medium w-20 text-right">
                      {country.clicks} <span className="text-muted-foreground text-xs font-normal">({percentage.toFixed(1)}%)</span>
                    </span>
                  </div>
                </div>
              );
            })}
          </div>
          <p className="text-[10px] text-muted-foreground mt-6 text-right bg-muted/30 p-2 rounded-md inline-block float-right">
            * 지역 데이터는 샘플 데이터입니다. 실제 구현 시 IP 기반 지역 분석이 필요합니다.
          </p>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="src/features/auth/utils/with-auth.tsx">
import { ClerkAuthService, UserStatus, UserRole } from "@/features/auth/services/clerk-auth.service";

export interface WithAuthOptions {
  requiredStatus?: UserStatus | "any";
  requireAdmin?: boolean;
}

export interface AuthenticatedPageProps {
  userId: string;
  email: string | null;
  status: UserStatus;
  role: UserRole;
}

/**
 * Higher-order function to protect pages with authentication using Clerk
 *
 * @example
 * ```tsx
 * export default withAuth(DashboardPage);
 *
 * // With options
 * export default withAuth(AdminUsersPage, { requireAdmin: true });
 * ```
 */
export function withAuth<P extends object = object>(
  Component: React.ComponentType<P & AuthenticatedPageProps>,
  options?: WithAuthOptions
) {
  return async function ProtectedPage(props: P) {
    const user = await ClerkAuthService.requireAuth(options);

    return <Component {...props} {...user} />;
  };
}
</file>

<file path="src/features/links/actions/shorten-url.ts">
"use server";

import { LinkService } from "@/features/links/actions/link.service";
import { CreateLinkDTO, LinkResponse } from "@/shared/types/link";
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";

export async function shortenUrl(data: CreateLinkDTO): Promise<LinkResponse> {
  try {
    const user = await ClerkAuthService.requireAuth({ requiredStatus: "approved" });

    const link = await LinkService.createShortLink(data, undefined, user.userId);
    const shortUrl = `${process.env.NEXT_PUBLIC_BASE_URL}/${link.slug}`;

    return {
      shortUrl,
      originalUrl: link.original_url,
    };
  } catch (error) {
    console.error("Error shortening URL:", error);
    if (error instanceof Error) {
      throw error;
    }
    throw new Error("URL을 단축하는 중 오류가 발생했습니다.");
  }
}
</file>

<file path="src/features/links/components/youtube/youtube-embed.tsx">
"use client";

import { useState } from "react";
import Image from "next/image";
import { Play, X } from "lucide-react";
import { Button } from "@/shared/components/ui/button";
import {
  getYouTubeEmbedUrl,
  getYouTubeThumbnailUrl,
} from "../../utils/youtube";

interface YouTubeEmbedProps {
  videoId: string;
  title?: string;
  autoplay?: boolean;
  className?: string;
}

export function YouTubeEmbed({
  videoId,
  title,
  autoplay = false,
  className = "",
}: YouTubeEmbedProps) {
  const [isPlaying, setIsPlaying] = useState(autoplay);
  const thumbnailUrl = getYouTubeThumbnailUrl(videoId, "mqdefault");
  const embedUrl = getYouTubeEmbedUrl(videoId, {
    autoplay: isPlaying,
    mute: false,
  });

  if (!isPlaying) {
    return (
      <div
        className={`relative aspect-video w-full overflow-hidden rounded-lg bg-black ${className}`}
      >
        {/* 썸네일 이미지 */}
        <Image
          src={thumbnailUrl}
          alt={title || "YouTube video thumbnail"}
          fill
          className="object-cover"
          unoptimized
        />

        {/* 재생 버튼 오버레이 */}
        <div className="absolute inset-0 flex items-center justify-center bg-black/30 transition-colors hover:bg-black/40">
          <Button
            variant="ghost"
            size="icon"
            className="h-16 w-16 rounded-full bg-red-600 text-white hover:bg-red-700 hover:text-white"
            onClick={() => setIsPlaying(true)}
          >
            <Play className="h-8 w-8 fill-current" />
          </Button>
        </div>

        {/* YouTube 로고 */}
        <div className="absolute bottom-2 right-2 rounded bg-black/70 px-2 py-1 text-xs text-white">
          YouTube
        </div>
      </div>
    );
  }

  return (
    <div className={`relative aspect-video w-full ${className}`}>
      <iframe
        src={embedUrl}
        title={title || "YouTube video player"}
        className="h-full w-full rounded-lg"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowFullScreen
      />

      {/* 닫기 버튼 */}
      <Button
        variant="ghost"
        size="icon"
        className="absolute -top-2 -right-2 h-6 w-6 rounded-full bg-muted-foreground/80 text-background hover:bg-muted-foreground hover:text-background"
        onClick={() => setIsPlaying(false)}
      >
        <X className="h-4 w-4" />
      </Button>
    </div>
  );
}
</file>

<file path="src/features/links/components/youtube/youtube-thumbnail.tsx">
"use client";

import Image from "next/image";
import { Play } from "lucide-react";
import { getYouTubeThumbnailUrl } from "../../utils/youtube";

interface YouTubeThumbnailProps {
  videoId: string;
  title?: string;
  onClick?: () => void;
  className?: string;
  size?: "sm" | "md" | "lg";
}

const sizeClasses = {
  sm: "h-12 w-20",
  md: "h-16 w-28",
  lg: "h-24 w-40",
};

export function YouTubeThumbnail({
  videoId,
  title,
  onClick,
  className = "",
  size = "md",
}: YouTubeThumbnailProps) {
  const thumbnailUrl = getYouTubeThumbnailUrl(videoId, "mqdefault");

  return (
    <button
      type="button"
      className={`group relative overflow-hidden rounded-md ${sizeClasses[size]} ${className}`}
      onClick={onClick}
      title={title || "YouTube 동영상 재생"}
    >
      <Image
        src={thumbnailUrl}
        alt={title || "YouTube video thumbnail"}
        fill
        className="object-cover transition-transform group-hover:scale-105"
        unoptimized
      />

      {/* 재생 버튼 오버레이 */}
      <div className="absolute inset-0 flex items-center justify-center bg-black/30 transition-colors group-hover:bg-black/40">
        <div className="flex h-8 w-8 items-center justify-center rounded-full bg-red-600">
          <Play className="h-4 w-4 fill-white text-white" />
        </div>
      </div>
    </button>
  );
}
</file>

<file path="eslint.config.mjs">
import { dirname } from 'path';
import { fileURLToPath } from 'url';
import { FlatCompat } from '@eslint/eslintrc';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends('next/core-web-vitals', 'next/typescript'),
  {
    rules: {
      '@typescript-eslint/no-explicit-any': 'off',
    },
  },
];

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "i.ytimg.com",
        pathname: "/vi/**",
      },
      {
        protocol: "https",
        hostname: "img.youtube.com",
        pathname: "/vi/**",
      },
    ],
  },
};

export default nextConfig;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "noImplicitAny": false, // any 타입 허용
    "skipLibCheck": true,
    "strict": false, // 엄격한 타입 검사 비활성화
    "forceConsistentCasingInFileNames": false, // 파일 이름의 대소문자 일관성 비활성화
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="src/app/admin/users/page.tsx">
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import UserManagementTable from "@/features/auth/components/admin/user-management-table";
import { Users } from "lucide-react";

// 동적 렌더링 강제 설정 (Static Generation 방지)
export const dynamic = "force-dynamic";

export default async function AdminUsersPage() {
  try {
    // Middleware already verified auth, approval, and admin role
    const currentUser = await ClerkAuthService.getCurrentUser();

    // Defensive check (middleware should prevent this)
    if (!currentUser || currentUser.status !== 'approved' || currentUser.role !== 'admin') {
      throw new Error('Admin access required');
    }

    // Fetch all users from Clerk
    const users = await ClerkAuthService.getUsersByStatus();

    return (
      <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
        <div className="flex items-center gap-3">
          <div className="p-3 rounded-2xl bg-white dark:bg-white/10 shadow-sm border-none">
            <Users className="h-6 w-6 text-primary" />
          </div>
          <div>
            <h1 className="text-3xl font-bold tracking-tight text-foreground">사용자 관리</h1>
            <p className="text-muted-foreground mt-1 text-sm font-medium">플랫폼의 모든 사용자를 관리하고 권한을 설정하세요.</p>
          </div>
        </div>

        <div className="bg-white dark:bg-white/5 rounded-2xl p-8 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)]">
          <UserManagementTable
            users={users}
            currentUserId={currentUser.userId}
          />
        </div>
      </div>
    );
  } catch (error) {
    console.error("AdminUsersPage error:", error);
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center p-8 rounded-2xl bg-white dark:bg-white/5 shadow-xl border border-white/10 backdrop-blur-md">
          <h2 className="text-xl font-bold mb-2 text-red-500">접근 권한이 없습니다</h2>
          <p className="text-muted-foreground">
            이 페이지는 관리자만 접근할 수 있습니다.
          </p>
        </div>
      </div>
    );
  }
}
</file>

<file path="src/app/admin/layout.tsx">
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import AdminSidebar from "@/features/auth/components/admin/sidebar";

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // Get current user from Clerk
  const user = await ClerkAuthService.getCurrentUser();

  // If no user, just render children (middleware will handle redirects)
  if (!user) {
    return <>{children}</>;
  }

  // Only show sidebar for approved users
  if (user.status === "approved") {
    return (
      <div className="min-h-screen bg-muted/30 dark:bg-background">
        <AdminSidebar userRole={user.role} />
        <main className="lg:pl-64 min-h-screen relative">
          {/* Ambient Glow Effects */}
          <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/10 via-transparent to-transparent pointer-events-none" />
          <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,_var(--tw-gradient-stops))] from-accent/10 via-transparent to-transparent pointer-events-none" />

          <div className="relative container mx-auto p-6 pt-20 lg:pt-8 animate-in backdrop-blur-[1px]">
            {children}
          </div>
        </main>
      </div>
    );
  }

  // For non-approved users, just render children
  return <>{children}</>;
}
</file>

<file path="src/app/api/webhooks/clerk/route.ts">
/**
 * @file src/app/api/webhooks/clerk/route.ts
 * @description Clerk webhook handler
 *
 * Handles Clerk webhook events, primarily user.created event to:
 * 1. Create a profile record in the database
 * 2. Set initial publicMetadata.status to "pending"
 * 3. Set initial publicMetadata.role to "user"
 */

import { Webhook } from "svix";
import { headers } from "next/headers";
import { WebhookEvent } from "@clerk/nextjs/server";
import { clerkClient } from "@clerk/nextjs/server";
import { createAdminClient } from "@/lib/supabase/admin";

export async function POST(req: Request) {
  const WEBHOOK_SECRET = process.env.CLERK_WEBHOOK_SECRET;

  if (!WEBHOOK_SECRET) {
    throw new Error("Missing CLERK_WEBHOOK_SECRET environment variable");
  }

  // Get headers
  const headerPayload = await headers();
  const svix_id = headerPayload.get("svix-id");
  const svix_timestamp = headerPayload.get("svix-timestamp");
  const svix_signature = headerPayload.get("svix-signature");

  if (!svix_id || !svix_timestamp || !svix_signature) {
    return new Response("Missing svix headers", { status: 400 });
  }

  // Get body
  const payload = await req.json();
  const body = JSON.stringify(payload);

  // Verify webhook
  const wh = new Webhook(WEBHOOK_SECRET);
  let evt: WebhookEvent;

  try {
    evt = wh.verify(body, {
      "svix-id": svix_id,
      "svix-timestamp": svix_timestamp,
      "svix-signature": svix_signature,
    }) as WebhookEvent;
  } catch (err) {
    console.error("Webhook verification failed:", err);
    return new Response("Webhook verification failed", { status: 400 });
  }

  // Handle the event
  const eventType = evt.type;
  console.log(`Clerk webhook event: ${eventType}`);

  if (eventType === "user.created") {
    const { id, email_addresses, primary_email_address_id } = evt.data;

    const primaryEmail = email_addresses.find(
      (email) => email.id === primary_email_address_id
    )?.email_address;

    console.log("New user created:", id, primaryEmail);

    try {
      // Create profile in database
      const supabase = createAdminClient();
      const { error: profileError } = await supabase
        .from("profiles")
        .insert({
          clerk_user_id: id,
          email: primaryEmail,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString(),
        });

      if (profileError) {
        console.error("Failed to create profile:", profileError);
        return new Response("Failed to create profile", { status: 500 });
      }

      // Update Clerk user metadata
      const client = await clerkClient();
      await client.users.updateUserMetadata(id, {
        publicMetadata: {
          status: "pending",
          role: "user",
        },
      });

      console.log("User profile created and metadata set:", id);
    } catch (error) {
      console.error("Error handling user.created:", error);
      return new Response("Internal server error", { status: 500 });
    }
  }

  if (eventType === "user.deleted") {
    const { id } = evt.data;

    console.log("User deleted:", id);

    try {
      // Delete profile from database
      const supabase = createAdminClient();
      const { error } = await supabase
        .from("profiles")
        .delete()
        .eq("clerk_user_id", id);

      if (error) {
        console.error("Failed to delete profile:", error);
        // Don't fail the webhook if profile deletion fails
      }

      console.log("User profile deleted:", id);
    } catch (error) {
      console.error("Error handling user.deleted:", error);
      // Don't fail the webhook
    }
  }

  return new Response("Webhook processed", { status: 200 });
}
</file>

<file path="src/app/shorten/page.tsx">
import UrlInputForm from "@/features/links/components/url/url-input-form";
import { Card, CardContent, CardHeader, CardTitle } from "@/shared/components/ui/card";
import { Link2, Sparkles, Shield, BarChart3 } from "lucide-react";

export default function ShortenPage() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-background via-muted/10 to-background relative overflow-hidden">
      {/* Background Effects */}
      <div className="absolute inset-0 bg-gradient-to-tr from-primary/5 via-transparent to-accent/5" />
      <div className="absolute top-40 left-20 w-96 h-96 bg-primary/10 rounded-full blur-3xl" />
      <div className="absolute bottom-40 right-20 w-96 h-96 bg-accent/10 rounded-full blur-3xl" />
      
      <div className="container relative mx-auto px-4 py-16 max-w-4xl z-10">
        {/* Page Header */}
        <div className="text-center mb-16 animate-in">
          <div className="inline-flex items-center gap-2 px-6 py-3 mb-8 rounded-full bg-gradient-to-r from-primary/10 to-accent/10 backdrop-blur-sm border border-primary/20 text-sm font-semibold text-primary">
            <Sparkles className="h-4 w-4" />
            <span>빠르고 안전한 URL 단축</span>
          </div>
          
          <h1 className="text-4xl sm:text-5xl md:text-6xl font-black mb-6">
            <span className="bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent animate-gradient-x bg-300%">
              URL을 단축하세요
            </span>
          </h1>
          <p className="text-xl sm:text-2xl text-foreground/80 font-light max-w-2xl mx-auto leading-relaxed">
            긴 URL을 <span className="font-semibold text-primary">짧고 기억하기 쉬운</span> 링크로 변환하여 
            <span className="font-semibold text-accent">효율적으로</span> 공유하고 관리하세요
          </p>
        </div>

        {/* URL Shortener Form */}
        <div className="mb-16">
          <UrlInputForm />
        </div>

        {/* Features */}
        <div className="grid md:grid-cols-3 gap-8 mt-24">
          <Card className="group hover-lift backdrop-blur-xl bg-background/60 border-primary/20 hover:border-primary/40 transition-all duration-300 hover:shadow-2xl hover:shadow-primary/20">
            <CardHeader>
              <div className="h-14 w-14 rounded-2xl bg-gradient-to-br from-primary to-accent flex items-center justify-center mb-4 shadow-lg shadow-primary/30 group-hover:scale-110 transition-transform">
                <Link2 className="h-7 w-7 text-white" />
              </div>
              <CardTitle className="text-xl font-bold">즉시 생성</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-muted-foreground leading-relaxed">
                클릭 한 번으로 단축 URL을 즉시 생성하고 
                바로 사용할 수 있습니다.
              </p>
            </CardContent>
          </Card>

          <Card className="group hover-lift backdrop-blur-xl bg-background/60 border-accent/20 hover:border-accent/40 transition-all duration-300 hover:shadow-2xl hover:shadow-accent/20">
            <CardHeader>
              <div className="h-14 w-14 rounded-2xl bg-gradient-to-br from-accent to-primary flex items-center justify-center mb-4 shadow-lg shadow-accent/30 group-hover:scale-110 transition-transform">
                <Shield className="h-7 w-7 text-white" />
              </div>
              <CardTitle className="text-xl font-bold">안전한 관리</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-muted-foreground leading-relaxed">
                회원 전용 서비스로 생성한 링크를 
                안전하게 관리할 수 있습니다.
              </p>
            </CardContent>
          </Card>

          <Card className="group hover-lift backdrop-blur-xl bg-background/60 border-primary/20 hover:border-primary/40 transition-all duration-300 hover:shadow-2xl hover:shadow-primary/20">
            <CardHeader>
              <div className="h-14 w-14 rounded-2xl bg-gradient-to-br from-primary to-accent flex items-center justify-center mb-4 shadow-lg shadow-primary/30 group-hover:scale-110 transition-transform">
                <BarChart3 className="h-7 w-7 text-white" />
              </div>
              <CardTitle className="text-xl font-bold">상세 분석</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-muted-foreground leading-relaxed">
                클릭 수, 접속 위치 등 다양한 통계를 
                실시간으로 확인할 수 있습니다.
              </p>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/features/auth/services/clerk-auth.service.ts">
/**
 * @file src/features/auth/services/clerk-auth.service.ts
 * @description Clerk 기반 인증 서비스
 *
 * Clerk API를 사용하여 사용자 인증 및 권한 관리를 수행합니다.
 * Supabase Auth를 대체합니다.
 */

import { auth, clerkClient } from "@clerk/nextjs/server";
import { redirect } from "next/navigation";
import { createClient } from "@/lib/supabase/server";

export type UserStatus = "pending" | "approved" | "rejected";
export type UserRole = "user" | "admin";

export interface ClerkUserMetadata {
  publicMetadata: {
    status?: UserStatus;
    role?: UserRole;
  };
  privateMetadata: {
    approved_at?: string;
    approved_by?: string;
    rejected_at?: string;
    rejected_by?: string;
    rejection_reason?: string;
  };
}

export interface AuthResult {
  userId: string;
  email: string | null;
  status: UserStatus;
  role: UserRole;
}

export class ClerkAuthService {
  /**
   * Get the current authenticated user with metadata
   */
  static async getCurrentUser(): Promise<AuthResult | null> {
    const { userId } = await auth();

    if (!userId) {
      return null;
    }

    try {
      // Use clerkClient to get fresh metadata (not cached session)
      const client = await clerkClient();
      const user = await client.users.getUser(userId);

      if (!user) {
        return null;
      }

      const publicMetadata = (user.publicMetadata as ClerkUserMetadata["publicMetadata"]) || {};

      const status = publicMetadata.status || "pending";
      const role = publicMetadata.role || "user";
      const email = user.emailAddresses.find((e) => e.id === user.primaryEmailAddressId)?.emailAddress || null;

      return {
        userId,
        email,
        status,
        role,
      };
    } catch (error: unknown) {
      // Handle case where user was deleted from Clerk but session still exists
      if (error && typeof error === "object" && "status" in error && error.status === 404) {
        console.warn(`User ${userId} not found in Clerk (possibly deleted)`);
        return null;
      }
      throw error;
    }
  }

  /**
   * Require authentication and optionally specific user status
   * Redirects if requirements are not met
   */
  static async requireAuth(options?: {
    requiredStatus?: UserStatus | "any";
    requireAdmin?: boolean;
  }): Promise<AuthResult> {
    const user = await this.getCurrentUser();

    // Check if user is authenticated
    if (!user) {
      redirect("/admin/login");
    }

    // Check user status if required
    const requiredStatus = options?.requiredStatus || "approved";
    if (requiredStatus !== "any" && user.status !== requiredStatus) {
      // Redirect based on actual status
      if (user.status === "pending") {
        redirect("/admin/pending");
      } else if (user.status === "rejected") {
        redirect("/admin/rejected");
      } else {
        redirect("/admin/login");
      }
    }

    // Check admin role if required
    if (options?.requireAdmin && user.role !== "admin") {
      redirect("/admin/dashboard");
    }

    return user;
  }

  /**
   * Check if user has admin role
   */
  static async isAdmin(): Promise<boolean> {
    const user = await this.getCurrentUser();
    return user?.role === "admin";
  }

  /**
   * Check if user is approved
   */
  static async isApproved(): Promise<boolean> {
    const user = await this.getCurrentUser();
    return user?.status === "approved";
  }

  /**
   * Get all users by status (admin only)
   */
  static async getUsersByStatus(status?: UserStatus) {
    await this.requireAuth({ requireAdmin: true });

    const client = await clerkClient();

    // Get all users
    const { data: users } = await client.users.getUserList({
      limit: 500,
    });

    // Filter by status if provided
    const filteredUsers = status
      ? users.filter((user) => {
          const publicMetadata = (user.publicMetadata as ClerkUserMetadata["publicMetadata"]) || {};
          return publicMetadata.status === status;
        })
      : users;

    return filteredUsers.map((user) => {
      const publicMetadata = (user.publicMetadata as ClerkUserMetadata["publicMetadata"]) || {};
      const privateMetadata = (user.privateMetadata as ClerkUserMetadata["privateMetadata"]) || {};
      const email = user.emailAddresses.find((e) => e.id === user.primaryEmailAddressId)?.emailAddress || null;

      return {
        id: user.id,
        email,
        status: publicMetadata.status || "pending",
        role: publicMetadata.role || "user",
        createdAt: user.createdAt,
        ...privateMetadata,
      };
    });
  }

  /**
   * Update user status (admin only)
   */
  static async updateUserStatus(
    targetUserId: string,
    status: UserStatus,
    rejectionReason?: string
  ) {
    const currentUser = await this.requireAuth({ requireAdmin: true });

    const client = await clerkClient();
    const user = await client.users.getUser(targetUserId);

    const privateMetadata = (user.privateMetadata as ClerkUserMetadata["privateMetadata"]) || {};

    // Prepare metadata updates
    const metadataUpdate: ClerkUserMetadata = {
      publicMetadata: {
        status,
      },
      privateMetadata: {
        ...privateMetadata,
      },
    };

    if (status === "approved") {
      metadataUpdate.privateMetadata.approved_at = new Date().toISOString();
      metadataUpdate.privateMetadata.approved_by = currentUser.userId;
      // Clear rejection data
      delete metadataUpdate.privateMetadata.rejected_at;
      delete metadataUpdate.privateMetadata.rejected_by;
      delete metadataUpdate.privateMetadata.rejection_reason;
    } else if (status === "rejected") {
      metadataUpdate.privateMetadata.rejected_at = new Date().toISOString();
      metadataUpdate.privateMetadata.rejected_by = currentUser.userId;
      metadataUpdate.privateMetadata.rejection_reason = rejectionReason;
      // Clear approval data
      delete metadataUpdate.privateMetadata.approved_at;
      delete metadataUpdate.privateMetadata.approved_by;
    }

    await client.users.updateUserMetadata(targetUserId, metadataUpdate);

    return { success: true };
  }

  /**
   * Update user role (admin only)
   */
  static async updateUserRole(targetUserId: string, role: UserRole) {
    const currentUser = await this.requireAuth({ requireAdmin: true });

    // Prevent admin from removing their own admin role
    if (targetUserId === currentUser.userId && role !== "admin") {
      throw new Error("Cannot remove your own admin role");
    }

    const client = await clerkClient();
    const user = await client.users.getUser(targetUserId);

    const publicMetadata = (user.publicMetadata as ClerkUserMetadata["publicMetadata"]) || {};

    await client.users.updateUserMetadata(targetUserId, {
      publicMetadata: {
        ...publicMetadata,
        role,
      },
    });

    return { success: true };
  }

  /**
   * Get user profile from database
   */
  static async getUserProfile(clerkUserId: string) {
    const supabase = await createClient();
    const { data, error } = await supabase
      .from("profiles")
      .select("*")
      .eq("clerk_user_id", clerkUserId)
      .single();

    return { data, error };
  }
}
</file>

<file path="src/features/auth/types/profile.ts">
// Import types from the generated database types
import type { Database } from '@/shared/types/database.types';

// Define the enum types based on the database schema
export type UserStatus = 'pending' | 'approved' | 'rejected';
export type UserRole = 'user' | 'admin';

// Define type aliases for the database types
type DbProfile = Database['public']['Tables']['profiles']['Row'];

// Re-export the database types with the same interface names
export type Profile = DbProfile;

// Helper type guard functions
export const isUserStatus = (value: unknown): value is UserStatus => {
  return typeof value === 'string' && ['pending', 'approved', 'rejected'].includes(value);
};

export const isUserRole = (value: unknown): value is UserRole => {
  return typeof value === 'string' && ['user', 'admin'].includes(value);
};

// Constants for enum values
export const USER_STATUS = {
  PENDING: 'pending' as const,
  APPROVED: 'approved' as const,
  REJECTED: 'rejected' as const,
} satisfies Record<string, UserStatus>;

export const USER_ROLE = {
  USER: 'user' as const,
  ADMIN: 'admin' as const,
} satisfies Record<string, UserRole>;
</file>

<file path="vitest.config.mts">
import { defineConfig } from "vitest/config";
import react from "@vitejs/plugin-react";
import tsconfigPaths from "vite-tsconfig-paths";

export default defineConfig({
  plugins: [tsconfigPaths(), react()],
  test: {
    environment: "jsdom",
    env: {
      SUPABASE_TEST_URL: process.env.SUPABASE_TEST_URL,
      SUPABASE_TEST_KEY: process.env.SUPABASE_TEST_KEY,
    },
    setupFiles: ["./test/config/setup-test-env.ts"],
  },
});
</file>

<file path="src/app/admin/rejected/page.tsx">
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import { Button } from "@/shared/components/ui/button";
import Link from "next/link";
import { XCircleIcon } from "@heroicons/react/24/outline";
import { SignOutButton } from "@clerk/nextjs";

// Force dynamic rendering since we use cookies
export const dynamic = "force-dynamic";

export default async function RejectedPage() {
  // Get current user from Clerk
  const user = await ClerkAuthService.getCurrentUser();

  // If no user or not rejected, redirect (middleware should handle this)
  if (!user || user.status !== "rejected") {
    return null;
  }

  // Try to get rejection reason from Clerk private metadata
  // This would need to be fetched from Clerk if needed
  const rejectionReason = undefined; // Clerk metadata에서 가져올 수 있음

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background relative overflow-hidden px-4">
      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/5 via-transparent to-transparent pointer-events-none" />
      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,_var(--tw-gradient-stops))] from-accent/5 via-transparent to-transparent pointer-events-none" />
      <div className="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)]" />

      <div className="relative max-w-md w-full text-center">
        <div className="bg-card/95 backdrop-blur-sm shadow-2xl rounded-lg p-8 border border-border/50">
          <div className="flex justify-center mb-6">
            <div className="h-16 w-16 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center">
              <XCircleIcon className="h-8 w-8 text-red-600 dark:text-red-400" />
            </div>
          </div>

          <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            가입 거절됨
          </h1>

          <div className="space-y-4 text-gray-600 dark:text-gray-400">
            <p>죄송합니다. 회원가입 신청이 거절되었습니다.</p>

            {rejectionReason && (
              <div className="bg-red-50 dark:bg-red-900/20 rounded-lg p-4">
                <p className="text-sm text-red-700 dark:text-red-300">
                  <strong>거절 사유:</strong>
                  <br />
                  {rejectionReason}
                </p>
              </div>
            )}

            <p className="text-sm">
              추가 문의사항이 있으시면 관리자에게 연락해주세요.
            </p>
          </div>

          <div className="mt-8 space-y-3">
            <Link href="/" className="block">
              <Button variant="outline" className="w-full">
                메인 페이지로 돌아가기
              </Button>
            </Link>

            <SignOutButton redirectUrl="/">
              <Button
                variant="ghost"
                className="w-full text-red-600 hover:text-red-700"
              >
                로그아웃
              </Button>
            </SignOutButton>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/features/analytics/components/link-stats.tsx">
"use client";

import { useEffect, useState } from "react";
import { DailyClickStats } from "@/shared/types/link";
import { getLinkClickStats } from "@/features/links/actions/link-actions";
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from "recharts";

interface LinkStatsProps {
  linkId: string;
  dateRange?: { startDate?: string; endDate?: string };
}

export default function LinkStats({ linkId, dateRange }: LinkStatsProps) {
  const [stats, setStats] = useState<DailyClickStats[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchStats = async () => {
      setLoading(true);
      try {
        const data = await getLinkClickStats(linkId, dateRange);
        setStats(data);
      } catch (error) {
        console.error("통계를 불러오는데 실패했습니다:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchStats();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [linkId, dateRange?.startDate, dateRange?.endDate]);

  if (loading) {
    return <div className="text-center py-4">로딩 중...</div>;
  }

  if (stats.length === 0) {
    return <div className="text-center py-4">아직 클릭 데이터가 없습니다.</div>;
  }

  // Format data to ensure proper date handling
  const formattedStats = stats.map(stat => ({
    ...stat,
    date: new Date(stat.date).toISOString().split('T')[0]
  }));

  return (
    <div className="w-full">
      <h3 className="mb-4 text-lg font-semibold">일별 클릭 추이</h3>
      <div className="h-[300px] w-full">
        <ResponsiveContainer width="100%" height="100%">
        <LineChart data={formattedStats}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="date"
            tickFormatter={(date) => new Date(date).toLocaleDateString()}
          />
          <YAxis />
          <Tooltip
            labelFormatter={(date) => new Date(date).toLocaleDateString()}
            formatter={(value: number) => [`${value}회 클릭`]}
          />
          <Line
            type="monotone"
            dataKey="clicks"
            stroke="#2563eb"
            strokeWidth={2}
            dot={{ fill: "#2563eb" }}
          />
        </LineChart>
      </ResponsiveContainer>
      </div>
    </div>
  );
}
</file>

<file path="src/features/auth/components/admin/user-management-table.tsx">
"use client";

import { useState } from "react";
import { Button } from "@/shared/components/ui/button";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/shared/components/ui/table";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/shared/components/ui/select";
import { Badge } from "@/shared/components/ui/badge";
import { Avatar, AvatarFallback } from "@/shared/components/ui/avatar";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/shared/components/ui/tooltip";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/shared/components/ui/alert-dialog";
import { Input } from "@/shared/components/ui/input";
import { Label } from "@/shared/components/ui/label";
import { Check, X, User, ShieldCheck } from "lucide-react";
import { updateUserStatus, updateUserRole } from "@/features/auth/actions/clerk-user";
import { UserStatus, UserRole } from "@/features/auth/services/clerk-auth.service";

interface ClerkUser {
  id: string;
  email: string | null;
  status: UserStatus;
  role: UserRole;
  createdAt: number;
  approved_at?: string;
  approved_by?: string;
  rejected_at?: string;
  rejected_by?: string;
  rejection_reason?: string;
}

interface UserManagementTableProps {
  users: ClerkUser[];
  currentUserId: string;
}

export default function UserManagementTable({
  users,
  currentUserId,
}: UserManagementTableProps) {
  const [loadingUsers, setLoadingUsers] = useState<Set<string>>(new Set());
  const [rejectionReason, setRejectionReason] = useState("");

  const handleApprove = async (userId: string) => {
    setLoadingUsers((prev) => new Set(prev).add(userId));
    try {
      await updateUserStatus(userId, "approved");
    } finally {
      setLoadingUsers((prev) => {
        const newSet = new Set(prev);
        newSet.delete(userId);
        return newSet;
      });
    }
  };

  const handleReject = async (userId: string) => {
    if (!rejectionReason.trim()) return;

    setLoadingUsers((prev) => new Set(prev).add(userId));
    try {
      await updateUserStatus(userId, "rejected", rejectionReason);
      setRejectionReason("");
    } finally {
      setLoadingUsers((prev) => {
        const newSet = new Set(prev);
        newSet.delete(userId);
        return newSet;
      });
    }
  };

  const handleRoleChange = async (
    userId: string,
    newRole: "user" | "admin",
  ) => {
    setLoadingUsers((prev) => new Set(prev).add(userId));
    try {
      await updateUserRole(userId, newRole);
    } finally {
      setLoadingUsers((prev) => {
        const newSet = new Set(prev);
        newSet.delete(userId);
        return newSet;
      });
    }
  };

  if (users.length === 0) {
    return (
      <div className="rounded-lg border bg-card p-6 text-center text-muted-foreground">
        사용자가 없습니다.
      </div>
    );
  }

  return (
    <TooltipProvider>
      <div className="rounded-xl border-none bg-transparent">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>사용자</TableHead>
              <TableHead>상태</TableHead>
              <TableHead>권한</TableHead>
              <TableHead>가입일</TableHead>
              <TableHead className="text-right">작업</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {users.map((user) => {
              const isLoading = loadingUsers.has(user.id);
              const isCurrentUser = user.id === currentUserId;

              return (
                <TableRow
                  key={user.id}
                  className={isLoading ? "opacity-50" : ""}
                >
                  <TableCell>
                    <div className="flex items-center gap-3">
                      <Avatar>
                        <AvatarFallback>
                          <User className="h-4 w-4" />
                        </AvatarFallback>
                      </Avatar>
                      <div>
                        <div className="font-medium">
                          {user.email} {isCurrentUser && "(나)"}
                        </div>
                        <div className="text-sm text-muted-foreground">
                          ID: {user.id.slice(0, 8)}...
                        </div>
                      </div>
                    </div>
                  </TableCell>
                  <TableCell>
                    <Badge
                      variant={
                        user.status === "approved"
                          ? "default"
                          : user.status === "pending"
                            ? "secondary"
                            : "destructive"
                      }
                    >
                      {user.status === "approved"
                        ? "승인됨"
                        : user.status === "pending"
                          ? "대기중"
                          : "거절됨"}
                    </Badge>
                  </TableCell>
                  <TableCell>
                    <div className="flex items-center gap-2">
                      {user.role === "admin" ? (
                        <ShieldCheck className="h-4 w-4 text-primary" />
                      ) : (
                        <User className="h-4 w-4 text-muted-foreground" />
                      )}
                      <span className="text-sm">
                        {user.role === "admin" ? "관리자" : "사용자"}
                      </span>
                    </div>
                  </TableCell>
                  <TableCell className="text-muted-foreground">
                    {user.createdAt ? new Date(user.createdAt).toLocaleDateString() : "-"}
                  </TableCell>
                  <TableCell className="text-right">
                    <div className="flex justify-end gap-2">
                      {user.status === "pending" && (
                        <>
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => handleApprove(user.id)}
                            disabled={isLoading}
                          >
                            <Check className="h-4 w-4 mr-1" />
                            승인
                          </Button>
                          <AlertDialog>
                            <AlertDialogTrigger asChild>
                              <Button
                                size="sm"
                                variant="outline"
                                disabled={isLoading}
                                onClick={() => setRejectionReason("")}
                              >
                                <X className="h-4 w-4 mr-1" />
                                거절
                              </Button>
                            </AlertDialogTrigger>
                            <AlertDialogContent>
                              <AlertDialogHeader>
                                <AlertDialogTitle>
                                  사용자 가입 거절
                                </AlertDialogTitle>
                                <AlertDialogDescription>
                                  이 사용자의 가입을 거절하시겠습니까? 거절
                                  사유를 입력해주세요.
                                </AlertDialogDescription>
                              </AlertDialogHeader>
                              <div className="grid gap-4 py-4">
                                <div className="grid gap-2">
                                  <Label htmlFor="rejection-reason">
                                    거절 사유
                                  </Label>
                                  <Input
                                    id="rejection-reason"
                                    value={rejectionReason}
                                    onChange={(e) =>
                                      setRejectionReason(e.target.value)
                                    }
                                    placeholder="거절 사유를 입력하세요"
                                  />
                                </div>
                              </div>
                              <AlertDialogFooter>
                                <AlertDialogCancel
                                  onClick={() => {
                                    setRejectionReason("");
                                  }}
                                >
                                  취소
                                </AlertDialogCancel>
                                <AlertDialogAction
                                  onClick={() => handleReject(user.id)}
                                  disabled={!rejectionReason.trim()}
                                >
                                  거절
                                </AlertDialogAction>
                              </AlertDialogFooter>
                            </AlertDialogContent>
                          </AlertDialog>
                        </>
                      )}

                      {user.status === "approved" && !isCurrentUser && (
                        <AlertDialog>
                          <Select
                            value={user.role || "user"}
                            onValueChange={(value) =>
                              handleRoleChange(
                                user.id,
                                value as "user" | "admin",
                              )
                            }
                            disabled={isLoading}
                          >
                            <SelectTrigger className="w-32">
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="user">사용자</SelectItem>
                              <SelectItem value="admin">관리자</SelectItem>
                            </SelectContent>
                          </Select>
                        </AlertDialog>
                      )}

                      {user.status === "rejected" && user.rejection_reason && (
                        <Tooltip>
                          <TooltipTrigger asChild>
                            <span className="text-xs text-muted-foreground cursor-help">
                              사유: {user.rejection_reason.slice(0, 20)}...
                            </span>
                          </TooltipTrigger>
                          <TooltipContent>
                            <p className="max-w-xs">{user.rejection_reason}</p>
                          </TooltipContent>
                        </Tooltip>
                      )}
                    </div>
                  </TableCell>
                </TableRow>
              );
            })}
          </TableBody>
        </Table>
      </div>
    </TooltipProvider>
  );
}
</file>

<file path="src/features/links/actions/update-link.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";

export async function updateLinkDescription(linkId: string, description: string) {
  const supabase = await createClient();

  // Clerk 인증
  const currentUser = await ClerkAuthService.requireAuth({ requiredStatus: "approved" });

  // 현재 사용자의 프로필 ID 조회
  const { data: profile } = await supabase
    .from("profiles")
    .select("id")
    .eq("clerk_user_id", currentUser.userId)
    .single();

  // 링크 소유자 확인
  const { data: link, error: linkError } = await supabase
    .from("links")
    .select("user_id")
    .eq("id", linkId)
    .single();

  if (linkError || !link) {
    return { error: "링크를 찾을 수 없습니다." };
  }

  // 소유자가 아니고 관리자도 아닌 경우 거부 (profiles.id로 비교)
  if (link.user_id !== profile?.id && currentUser.role !== "admin") {
    return { error: "이 링크를 수정할 권한이 없습니다." };
  }

  // 설명 업데이트
  const { error: updateError } = await supabase
    .from("links")
    .update({ description: description.trim() || null })
    .eq("id", linkId);

  if (updateError) {
    console.error("Error updating link description:", updateError);
    return { error: "설명 업데이트 중 오류가 발생했습니다." };
  }

  return { success: true };
}
</file>

<file path="src/features/links/components/url/shortened-url-result.tsx">
"use client";

import { useState, useEffect } from "react";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Card, CardContent } from "@/shared/components/ui/card";
import { CheckCircle2, Copy, Check, ExternalLink, QrCode, Share2, FileText } from "lucide-react";
import { TemplateSaveDialog } from "@/features/templates/components/template-save-dialog";
import type { UTMParameters } from "@/features/links/types/utm";

interface Props {
  shortUrl: string;
  originalUrl?: string;
  description?: string;
  utmParams?: UTMParameters;
}

export function ShortenedUrlResult({ shortUrl, originalUrl, description, utmParams }: Props) {
  const [isCopied, setIsCopied] = useState(false);
  const [showSaveDialog, setShowSaveDialog] = useState(false);

  // 복사 상태 타이머
  useEffect(() => {
    if (isCopied) {
      const timer = setTimeout(() => {
        setIsCopied(false);
      }, 2000);
      return () => clearTimeout(timer);
    }
  }, [isCopied]);

  async function copyToClipboard() {
    try {
      await navigator.clipboard.writeText(shortUrl);
      setIsCopied(true);
    } catch (error) {
      console.error("URL 복사에 실패했습니다.", error);
    }
  }

  async function shareUrl() {
    if (navigator.share) {
      try {
        await navigator.share({
          title: "단축 URL 공유",
          text: "단축된 URL을 공유합니다",
          url: shortUrl,
        });
      } catch (error) {
        console.error("공유하기 실패:", error);
      }
    } else {
      // Share API를 지원하지 않는 경우 복사
      copyToClipboard();
    }
  }

  return (
    <Card className="overflow-hidden border-0 shadow-xl animate-in slide-in-from-bottom-4">
      <div className="absolute inset-0 bg-gradient-to-br from-green-500/10 via-emerald-500/5 to-transparent" />
      <CardContent className="relative p-6">
        <div className="space-y-4">
          {/* Success Header */}
          <div className="flex items-center gap-3">
            <div className="h-12 w-12 rounded-full bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center shadow-lg">
              <CheckCircle2 className="h-6 w-6 text-white" />
            </div>
            <div>
              <h3 className="text-lg font-semibold">URL이 성공적으로 단축되었습니다!</h3>
              <p className="text-sm text-muted-foreground">아래 링크를 복사하여 사용하세요</p>
            </div>
          </div>

          {/* URL Display */}
          <div className="relative group">
            <Input
              type="text"
              readOnly
              value={shortUrl}
              aria-label="단축된 URL"
              onClick={(e) => (e.target as HTMLInputElement).select()}
              className="pr-24 h-12 text-base font-medium bg-muted/30 border-muted-foreground/20 focus:bg-background transition-all"
            />
            <div className="absolute right-1.5 top-1.5 flex items-center gap-1">
              <Button
                size="sm"
                variant="ghost"
                onClick={copyToClipboard}
                className="h-9 px-3 hover:bg-primary/10"
                aria-label="URL 복사하기"
              >
                {isCopied ? (
                  <Check className="h-4 w-4 text-green-600" />
                ) : (
                  <Copy className="h-4 w-4" />
                )}
              </Button>
            </div>
          </div>

          {/* Action Buttons */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
            <Button
              variant="outline"
              onClick={copyToClipboard}
              className="w-full hover:bg-primary/5 hover:border-primary/50 group"
            >
              {isCopied ? (
                <>
                  <Check className="mr-2 h-4 w-4 text-green-600" />
                  복사됨!
                </>
              ) : (
                <>
                  <Copy className="mr-2 h-4 w-4 group-hover:text-primary transition-colors" />
                  클립보드에 복사
                </>
              )}
            </Button>

            <Button
              variant="outline"
              onClick={() => window.open(shortUrl, "_blank")}
              className="w-full hover:bg-primary/5 hover:border-primary/50 group"
            >
              <ExternalLink className="mr-2 h-4 w-4 group-hover:text-primary transition-colors" />
              링크 열기
            </Button>

            <Button
              variant="outline"
              onClick={shareUrl}
              className="w-full hover:bg-primary/5 hover:border-primary/50 group"
            >
              <Share2 className="mr-2 h-4 w-4 group-hover:text-primary transition-colors" />
              공유하기
            </Button>

            {originalUrl && (
              <Button
                variant="outline"
                onClick={() => setShowSaveDialog(true)}
                className="w-full hover:bg-primary/5 hover:border-primary/50 group"
              >
                <FileText className="mr-2 h-4 w-4 group-hover:text-primary transition-colors" />
                템플릿 저장
              </Button>
            )}
          </div>

          {/* QR Code Hint */}
          <div className="pt-2 border-t border-border/50">
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
              <QrCode className="h-4 w-4" />
              <span>QR 코드는 링크 관리 페이지에서 생성할 수 있습니다</span>
            </div>
          </div>
        </div>
      </CardContent>

      {/* Template Save Dialog */}
      {originalUrl && (
        <TemplateSaveDialog
          open={showSaveDialog}
          onOpenChange={setShowSaveDialog}
          defaultUrl={originalUrl}
          defaultDescription={description}
          defaultUTMParams={utmParams}
        />
      )}
    </Card>
  );
}
</file>

<file path="src/features/links/components/link-list.tsx">
"use client";

import { useState, useEffect } from "react";
import { Link } from "@/shared/types/link";
import { Card, CardContent } from "@/shared/components/ui/card";
import { Button } from "@/shared/components/ui/button";
import { deleteLink } from "@/features/links/actions/delete-link";
import { updateLinkDescription } from "@/features/links/actions/update-link";
import { getAllLinksForAnalytics } from "@/features/analytics/actions/get-analytics";
import LinkStats from "@/features/analytics/components/link-stats";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/shared/components/ui/alert-dialog";
import { Trash2, Copy, ExternalLink, BarChart3, Edit2, Youtube, FolderPlus } from "lucide-react";
import { toast } from "sonner";
import { isYouTubeUrl, getYouTubeVideoId } from "../utils/youtube";
import { YouTubeEmbed } from "./youtube/youtube-embed";
import { YouTubeThumbnail } from "./youtube/youtube-thumbnail";
import { AddToCampaignDialog } from "@/features/campaigns/components/add-to-campaign-dialog";
import {
  DateRangeSelector,
  DateRangePreset,
  getDateRangeFromPreset,
} from "@/shared/components/date-range-selector";
import { getBaseUrl } from "@/lib/url";

interface LinkListProps {
  initialLinks: Link[];
}

export default function LinkList({ initialLinks }: LinkListProps) {
  const [links, setLinks] = useState<(Link & { period_clicks?: number })[]>(initialLinks);
  const [showAll, setShowAll] = useState(false);
  const [selectedLink, setSelectedLink] = useState<Link | null>(null);
  const [editingLink, setEditingLink] = useState<string | null>(null);
  const [editDescription, setEditDescription] = useState<string>("");
  const [dateRangePreset, setDateRangePreset] = useState<DateRangePreset>("all");
  const [customStartDate, setCustomStartDate] = useState<string>("");
  const [customEndDate, setCustomEndDate] = useState<string>("");
  const [expandedYouTube, setExpandedYouTube] = useState<string | null>(null);
  const [showAddToCampaign, setShowAddToCampaign] = useState(false);
  const [selectedLinkForCampaign, setSelectedLinkForCampaign] = useState<string | null>(null);

  const baseUrl = getBaseUrl();

  useEffect(() => {
    // 날짜 범위가 변경되면 데이터 다시 로드
    fetchLinks();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [dateRangePreset, customStartDate, customEndDate]);

  const getDateRange = () => {
    return getDateRangeFromPreset(dateRangePreset, customStartDate, customEndDate);
  };

  const fetchLinks = async () => {
    const dateRange = getDateRange();
    const result = await getAllLinksForAnalytics(dateRange);
    if (result.success && result.data) {
      if (showAll) {
        setLinks(result.data);
      } else {
        setLinks(result.data.slice(0, 10));
      }
    }
  };

  const handleShowAll = async () => {
    if (!showAll) {
      const dateRange = getDateRange();
      const result = await getAllLinksForAnalytics(dateRange);
      if (result.success && result.data) {
        setLinks(result.data);
      }
    } else {
      const dateRange = getDateRange();
      const result = await getAllLinksForAnalytics(dateRange);
      if (result.success && result.data) {
        setLinks(result.data.slice(0, 10));
      }
    }
    setShowAll(!showAll);
  };

  const formatDate = (dateString: string) => {
    // ISO 표준 형식 사용 (hydration 오류 방지)
    return new Date(dateString).toISOString().split("T")[0];
  };

  const handleDelete = async (linkId: string) => {
    const result = await deleteLink(linkId);

    if (result.success) {
      setLinks(links.filter(link => link.id !== linkId));
      toast.success("링크가 삭제되었습니다.");
    } else {
      toast.error(result.error || "링크 삭제에 실패했습니다.");
    }
  };

  const copyToClipboard = async (text: string) => {
    try {
      await navigator.clipboard.writeText(text);
      toast.success("클립보드에 복사되었습니다.");
    } catch {
      toast.error("복사에 실패했습니다.");
    }
  };

  const handleUpdateDescription = async (linkId: string) => {
    try {
      const { error } = await updateLinkDescription(linkId, editDescription);

      if (error) {
        toast.error("설명 업데이트에 실패했습니다.");
        return;
      }

      // 성공적으로 업데이트되면 로컬 상태 업데이트
      setLinks(links.map(link =>
        link.id === linkId
          ? { ...link, description: editDescription }
          : link
      ));
      setEditingLink(null);
      toast.success("설명이 업데이트되었습니다.");
    } catch {
      toast.error("설명 업데이트 중 오류가 발생했습니다.");
    }
  };

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-2xl font-bold">
          {showAll ? "모든 링크" : "상위 10개 링크"}
        </h2>
        <Button onClick={handleShowAll}>
          {showAll ? "상위 10개만 보기" : "전체 보기"}
        </Button>
      </div>

      <DateRangeSelector
        preset={dateRangePreset}
        onPresetChange={setDateRangePreset}
        customStartDate={customStartDate}
        customEndDate={customEndDate}
        onCustomStartDateChange={setCustomStartDate}
        onCustomEndDateChange={setCustomEndDate}
      />

      <div className="grid gap-4">
        {links.map((link) => (
          <Card
            key={link.id}
            className="border-none hover:bg-muted/50 dark:hover:bg-white/5 shadow-sm transition-all"
          >
            <CardContent className="p-4">
              <div className="flex justify-between items-start">
                <div className="flex-1 mr-4">
                  <div className="flex items-center gap-3">
                    {/* YouTube 썸네일 (YouTube URL인 경우) */}
                    {isYouTubeUrl(link.original_url) && (
                      <YouTubeThumbnail
                        videoId={getYouTubeVideoId(link.original_url) || ""}
                        size="sm"
                        onClick={() => setExpandedYouTube(expandedYouTube === link.id ? null : link.id)}
                      />
                    )}
                    <div className="flex-1">
                      <div className="flex items-center gap-2">
                        {isYouTubeUrl(link.original_url) && (
                          <Youtube className="h-4 w-4 text-red-600 flex-shrink-0" />
                        )}
                        <p className="font-medium break-all">{link.original_url}</p>
                      </div>
                    </div>
                  </div>
                  {editingLink === link.id ? (
                    <div className="mt-2 flex items-center gap-2">
                      <input
                        type="text"
                        value={editDescription}
                        onChange={(e) => setEditDescription(e.target.value)}
                        className="flex-1 px-2 py-1 text-sm border border-border rounded bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50"
                        placeholder="설명을 입력하세요"
                        onKeyDown={(e) => {
                          if (e.key === 'Enter') {
                            handleUpdateDescription(link.id);
                          } else if (e.key === 'Escape') {
                            setEditingLink(null);
                          }
                        }}
                      />
                      <Button
                        size="sm"
                        onClick={() => handleUpdateDescription(link.id)}
                      >
                        저장
                      </Button>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => setEditingLink(null)}
                      >
                        취소
                      </Button>
                    </div>
                  ) : (
                    <div className="flex items-center gap-2">
                      {link.description && (
                        <p className="text-sm text-muted-foreground mt-1">
                          {link.description}
                        </p>
                      )}
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => {
                          setEditingLink(link.id);
                          setEditDescription(link.description || "");
                        }}
                      >
                        <Edit2 className="h-3 w-3" />
                      </Button>
                    </div>
                  )}
                  <div className="flex items-center gap-2 mt-2">
                    <p className="text-sm text-muted-foreground">
                      {baseUrl}/{link.slug}
                    </p>
                    <Button
                      size="sm"
                      variant="ghost"
                      onClick={() => copyToClipboard(`${baseUrl}/${link.slug}`)}
                    >
                      <Copy className="h-3 w-3" />
                    </Button>
                    <Button
                      size="sm"
                      variant="ghost"
                      onClick={() => window.open(`${baseUrl}/${link.slug}`, '_blank')}
                    >
                      <ExternalLink className="h-3 w-3" />
                    </Button>
                  </div>
                </div>
                <div className="text-right">
                  {dateRangePreset === 'all' ? (
                    <p className="font-medium">{link.click_count} 클릭</p>
                  ) : (
                    <>
                      <p className="font-medium text-primary">
                        {link.period_clicks || 0} 클릭
                      </p>
                      <p className="text-xs text-muted-foreground">
                        (전체: {link.click_count})
                      </p>
                    </>
                  )}
                  <p className="text-sm text-muted-foreground mt-1">
                    {formatDate(link.created_at || "")}
                  </p>
                  <div className="flex gap-2 mt-2 justify-end">
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => {
                        setSelectedLinkForCampaign(link.id);
                        setShowAddToCampaign(true);
                      }}
                    >
                      <FolderPlus className="h-4 w-4" />
                      캠페인
                    </Button>
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => setSelectedLink(selectedLink?.id === link.id ? null : link)}
                    >
                      <BarChart3 className="h-4 w-4" />
                      통계
                    </Button>
                    <AlertDialog>
                      <AlertDialogTrigger asChild>
                        <Button size="sm" variant="destructive">
                          <Trash2 className="h-4 w-4" />
                          삭제
                        </Button>
                      </AlertDialogTrigger>
                      <AlertDialogContent>
                        <AlertDialogHeader>
                          <AlertDialogTitle>링크 삭제</AlertDialogTitle>
                          <AlertDialogDescription>
                            이 링크를 삭제하시겠습니까? 삭제된 링크는 복구할 수 없습니다.
                          </AlertDialogDescription>
                        </AlertDialogHeader>
                        <AlertDialogFooter>
                          <AlertDialogCancel>취소</AlertDialogCancel>
                          <AlertDialogAction onClick={() => handleDelete(link.id)}>
                            삭제
                          </AlertDialogAction>
                        </AlertDialogFooter>
                      </AlertDialogContent>
                    </AlertDialog>
                  </div>
                </div>
              </div>
              {/* YouTube 임베드 (확장 시) */}
              {expandedYouTube === link.id && isYouTubeUrl(link.original_url) && (
                <div className="mt-4 border-t pt-4">
                  <YouTubeEmbed
                    videoId={getYouTubeVideoId(link.original_url) || ""}
                    title={link.description || undefined}
                    className="max-w-2xl"
                  />
                </div>
              )}
              {selectedLink?.id === link.id && (
                <div className="mt-4 border-t pt-4">
                  <LinkStats linkId={link.id} dateRange={getDateRange()} />
                </div>
              )}
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Add to Campaign Dialog */}
      {selectedLinkForCampaign && (
        <AddToCampaignDialog
          open={showAddToCampaign}
          onOpenChange={setShowAddToCampaign}
          linkId={selectedLinkForCampaign}
          onSuccess={() => {
            setSelectedLinkForCampaign(null);
          }}
        />
      )}
    </div>
  );
}
</file>

<file path="src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
</file>

<file path="src/shared/types/link.ts">
import type { Tables, TablesInsert } from "./database.types";

// DB에서 자동 생성된 타입 사용
export type Link = Tables<"links">;
export type LinkInsert = TablesInsert<"links">;

// 클릭 수가 null일 수 있으므로 기본값 처리용 타입
export type LinkWithClickCount = Omit<Link, "click_count"> & {
  click_count: number;
};

// 링크 생성 시 사용하는 DTO (클라이언트 입력)
export interface CreateLinkDTO {
  original_url: string;
  custom_slug?: string;
  description?: string;
  utm_params?: {
    utm_source?: string;
    utm_medium?: string;
    utm_campaign?: string;
    utm_term?: string;
    utm_content?: string;
  };
}

// API 응답 타입
export interface LinkResponse {
  shortUrl: string;
  originalUrl: string;
}

// 일별 클릭 통계 (types.ts에서 이동)
export interface DailyClickStats {
  date: string;
  clicks: number;
}
</file>

<file path="src/app/[slug]/page.tsx">
"use server";

import { LinkService } from "@/features/links/actions/link.service";
import { Link } from "@/shared/types/link";
import { headers } from "next/headers";

import { notFound, redirect } from "next/navigation";

interface Props {
  params: Promise<{ slug: string }>;
}

export default async function RedirectPage({ params }: Props) {
  const { slug } = await params;

  // Get request headers to extract user agent
  const headersList = await headers();
  const userAgent = headersList.get("user-agent");
  const ip =
    headersList.get("x-forwarded-for") ||
    headersList.get("x-real-ip") ||
    "unknown";

  let link: Link | null = null; // link 변수를 try 블록 외부에서 접근 가능하도록 선언

  try {
    // 1. 링크 정보 가져오기
    link = await LinkService.getLinkBySlug(slug);

    // 2. 링크 정보가 없으면 notFound 호출 (여기서 함수 실행 중단)
    if (!link) {
      console.log(`Link not found for slug: ${slug}`);
      notFound();
    }

    // 3. 링크가 있으면 클릭 수 증가 시도 (user agent와 IP 정보 포함)
    await LinkService.incrementClickCount(slug, {
      userAgent,
      ip: ip.split(",")[0].trim(), // IP 주소가 여러 개인 경우 첫 번째 것만 사용
    });
  } catch (error) {
    // 4. 데이터베이스 조회/업데이트 중 발생한 예기치 못한 에러 처리
    console.error(`Error processing slug ${slug}:`, error);
    // 여기서도 notFound()를 호출하여 사용자에게 404 페이지를 보여줍니다.
    notFound();
  }

  // 5. try 블록이 성공적으로 완료되고 link 객체가 존재하면 리다이렉트 수행
  // 위에서 if (!link) 로 null 체크를 했으므로, 여기까지 오면 link는 반드시 존재합니다.
  // 하지만 명확성을 위해 한번 더 체크하는 것도 좋습니다.
  if (link) {
    console.log(`Redirecting slug ${slug} to: ${link.original_url}`);
    redirect(link.original_url); // try...catch 블록 밖에서 호출
  } else {
    // 이론적으로 이 코드는 실행되지 않아야 하지만, 방어적으로 추가
    console.error(
      `Link object was unexpectedly null for slug: ${slug} after try-catch.`,
    );
    notFound();
  }
}

// 메타데이터 설정 (수정)
export async function generateMetadata({ params }: Props) {
  const { slug } = await params;
  let title = `리다이렉션 중... - ${slug}`;
  try {
    const link = await LinkService.getLinkBySlug(slug);
    if (link) {
      title = `Redirecting to ${link.original_url.substring(0, 30)}...`; // 예시
    }
  } catch (error) {
    console.error("Error fetching link for metadata:", error);
  }

  return {
    title: title,
    robots: {
      index: false,
      follow: true,
    },
  };
}
</file>

<file path="src/app/admin/pending/page.tsx">
import { ClerkAuthService } from '@/features/auth/services/clerk-auth.service';
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/shared/components/ui/card';
import { AlertCircle } from 'lucide-react';
import { SignOutButton } from '@clerk/nextjs';
import { Button } from '@/shared/components/ui/button';

// Force dynamic rendering since we use cookies
export const dynamic = 'force-dynamic';

export default async function PendingApprovalPage() {
  // Middleware already verified auth and status, just get user info
  const user = await ClerkAuthService.getCurrentUser();

  // Defensive check (middleware should prevent this)
  if (!user || user.status !== 'pending') {
    return null;
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background relative overflow-hidden px-4">
      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/5 via-transparent to-transparent pointer-events-none" />
      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,_var(--tw-gradient-stops))] from-accent/5 via-transparent to-transparent pointer-events-none" />
      <div className="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)]" />

      <Card className="relative w-full max-w-md border-border/50 shadow-2xl backdrop-blur-sm bg-card/95">
        <CardHeader className="text-center">
          <div className="flex justify-center mb-4">
            <div className="p-3 bg-yellow-100 dark:bg-yellow-900/20 rounded-full">
              <AlertCircle className="h-8 w-8 text-yellow-600 dark:text-yellow-400" />
            </div>
          </div>
          <CardTitle className="text-2xl font-bold">승인 대기 중</CardTitle>
          <CardDescription className="text-base mt-2">
            계정이 관리자의 승인을 기다리고 있습니다
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="bg-muted/50 p-4 rounded-lg space-y-2 text-sm">
            <p className="font-medium">안내사항:</p>
            <ul className="list-disc list-inside space-y-1 text-muted-foreground">
              <li>승인 과정은 보통 1-2일이 소요됩니다</li>
              <li>승인 완료 시 이메일로 알려드립니다</li>
              <li>문의사항은 관리자에게 연락주세요</li>
            </ul>
          </div>

          <div className="text-center">
            <p className="text-sm text-muted-foreground">
              가입 신청해 주셔서 감사합니다
            </p>
          </div>
        </CardContent>
        <CardFooter className="flex justify-center border-t pt-6">
          <SignOutButton>
            <Button variant="outline" className="w-full sm:w-auto">
              로그아웃
            </Button>
          </SignOutButton>
        </CardFooter>
      </Card>
    </div>
  );
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";
@import "tw-animate-css";

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Thin.woff2') format('woff2');
  font-weight: 100;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-ExtraLight.woff2') format('woff2');
  font-weight: 200;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Light.woff2') format('woff2');
  font-weight: 300;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Regular.woff2') format('woff2');
  font-weight: 400;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Medium.woff2') format('woff2');
  font-weight: 500;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-SemiBold.woff2') format('woff2');
  font-weight: 600;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Bold.woff2') format('woff2');
  font-weight: 700;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-ExtraBold.woff2') format('woff2');
  font-weight: 800;
  font-display: swap;
}

@font-face {
  font-family: 'Pretendard';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Black.woff2') format('woff2');
  font-weight: 900;
  font-display: swap;
}

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  --font-mono: var(--font-geist-mono);

  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);

  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);

  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);

  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

:root {
  --radius: 0.75rem;

  /* Background: Very subtle cool gray to allow white cards to 'float' */
  --background: 210 20% 98%;
  --foreground: 222 47% 11%;

  /* Cards: Pure white surface for volume */
  --card: 0 0% 100%;
  --card-foreground: 222 47% 11%;

  --popover: 0 0% 100%;
  --popover-foreground: 222 47% 11%;

  /* Brand Color: #2E6CFF (Vivid Blue) */
  --primary: 222 100% 59%;
  --primary-foreground: 0 0% 100%;

  /* Secondary: Cool gray-blue tint for subtle depth */
  --secondary: 210 30% 96%;
  --secondary-foreground: 222 47% 11%;

  --muted: 210 20% 96%;
  --muted-foreground: 215 16% 47%;

  --accent: 210 30% 96%;
  --accent-foreground: 222 47% 11%;

  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;

  --border: 214 32% 91%;
  --input: 214 32% 91%;
  --ring: 222 100% 59%;

  /* Sidebar */
  --sidebar: 0 0% 100%;
  --sidebar-foreground: 240 5.3% 26.1%;
  --sidebar-primary: 240 5.9% 10%;
  --sidebar-primary-foreground: 0 0% 98%;
  --sidebar-accent: 240 4.8% 95.9%;
  --sidebar-accent-foreground: 240 5.9% 10%;
  --sidebar-border: 220 13% 91%;
  --sidebar-ring: 217.2 91.2% 59.8%;

  /* Chart colors */
  --chart-1: 222 100% 59%;
  --chart-2: 173 58% 39%;
  --chart-3: 197 37% 24%;
  --chart-4: 43 74% 66%;
  --chart-5: 27 87% 67%;
}

.dark {
  /* Minimal Dark Mode - Deep Slate Blue base */
  --background: 222 47% 8%;
  --foreground: 210 40% 98%;

  --card: 222 47% 10%;
  --card-foreground: 210 40% 98%;

  --popover: 222 47% 10%;
  --popover-foreground: 210 40% 98%;

  --primary: 222 100% 59%;
  --primary-foreground: 0 0% 100%;

  --secondary: 217 32% 14%;
  --secondary-foreground: 210 40% 98%;

  --muted: 217 32% 14%;
  --muted-foreground: 215 20% 65%;

  --accent: 217 32% 14%;
  --accent-foreground: 210 40% 98%;

  --destructive: 0 62.8% 30.6%;
  --destructive-foreground: 210 40% 98%;

  --border: 217 32% 14%;
  --input: 217 32% 14%;
  --ring: 222 100% 59%;

  --sidebar: 222 47% 11%;
  --sidebar-foreground: 240 4.8% 95.9%;
  --sidebar-primary: 224.3 76.3% 48%;
  --sidebar-primary-foreground: 0 0% 100%;
  --sidebar-accent: 240 3.7% 15.9%;
  --sidebar-accent-foreground: 240 4.8% 95.9%;
  --sidebar-border: 240 3.7% 15.9%;
  --sidebar-ring: 217.2 91.2% 59.8%;

  --chart-1: 220 70% 50%;
  --chart-2: 160 60% 45%;
  --chart-3: 30 80% 55%;
  --chart-4: 280 65% 60%;
  --chart-5: 340 75% 55%;
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground antialiased selection:bg-primary/20 selection:text-primary;
  }

  /* Scrollbar - polished */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-muted-foreground/30 rounded-full hover:bg-muted-foreground/50 transition-colors;
  }

  /* Premium Utility Classes */

  /* Icy Frosted Glass */
  .glass-effect {
    @apply backdrop-blur-xl border border-white/40 dark:border-white/10 shadow-sm supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-black/40;
  }

  /* Metallic Surface for Volume (Light Mode: Silver-ish, Dark Mode: Dark Metal) */
  .metallic-surface {
    @apply bg-gradient-to-br from-white to-secondary border border-white/50;
    box-shadow: 0 2px 10px -4px rgba(0, 0, 0, 0.05);
  }

  .dark .metallic-surface {
    @apply bg-gradient-to-br from-card to-background border-border shadow-none;
  }

  .glow-bg {
    position: absolute;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 50% 30%, hsla(var(--primary) / 0.15) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .text-glow {
    text-shadow: 0 0 20px hsla(var(--primary) / 0.5);
  }

  .gradient-text {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-primary via-[#5B8DFF] to-primary;
  }

  /* Micro-interactions */
  .hover-lift {
    @apply transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:shadow-primary/10;
    transition-timing-function: cubic-bezier(0.2, 0, 0, 1);
  }

  .animate-in {
    animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) both;
  }

  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  /* Refined Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes float {

    0%,
    100% {
      transform: translateY(0);
    }

    50% {
      transform: translateY(-6px);
    }
  }

  @keyframes gradient-x {
    0% {
      background-position: 0% 50%;
    }

    50% {
      background-position: 100% 50%;
    }

    100% {
      background-position: 0% 50%;
    }
  }

  .animate-gradient-x {
    animation: gradient-x 10s ease infinite;
    background-size: 200% auto;
  }
}
</file>

<file path="src/shared/types/database.types.ts">
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  // Allows to automatically instantiate createClient with right options
  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)
  __InternalSupabase: {
    PostgrestVersion: "12.2.3 (519615d)"
  }
  public: {
    Tables: {
      campaign_links: {
        Row: {
          added_at: string | null
          campaign_id: string
          id: string
          link_id: string
        }
        Insert: {
          added_at?: string | null
          campaign_id: string
          id?: string
          link_id: string
        }
        Update: {
          added_at?: string | null
          campaign_id?: string
          id?: string
          link_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "campaign_links_campaign_id_fkey"
            columns: ["campaign_id"]
            isOneToOne: false
            referencedRelation: "campaigns"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "campaign_links_link_id_fkey"
            columns: ["link_id"]
            isOneToOne: false
            referencedRelation: "links"
            referencedColumns: ["id"]
          },
        ]
      }
      campaigns: {
        Row: {
          created_at: string | null
          description: string | null
          id: string
          name: string
          source_url: string | null
          status: string | null
          updated_at: string | null
          user_id: string
          utm_campaign: string | null
          utm_content: string | null
          utm_medium: string | null
          utm_source: string | null
          utm_term: string | null
        }
        Insert: {
          created_at?: string | null
          description?: string | null
          id?: string
          name: string
          source_url?: string | null
          status?: string | null
          updated_at?: string | null
          user_id: string
          utm_campaign?: string | null
          utm_content?: string | null
          utm_medium?: string | null
          utm_source?: string | null
          utm_term?: string | null
        }
        Update: {
          created_at?: string | null
          description?: string | null
          id?: string
          name?: string
          source_url?: string | null
          status?: string | null
          updated_at?: string | null
          user_id?: string
          utm_campaign?: string | null
          utm_content?: string | null
          utm_medium?: string | null
          utm_source?: string | null
          utm_term?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "campaigns_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      link_clicks: {
        Row: {
          clicked_at: string | null
          id: string
          ip_address: string | null
          link_id: string
          user_agent: string | null
        }
        Insert: {
          clicked_at?: string | null
          id?: string
          ip_address?: string | null
          link_id: string
          user_agent?: string | null
        }
        Update: {
          clicked_at?: string | null
          id?: string
          ip_address?: string | null
          link_id?: string
          user_agent?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "link_clicks_link_id_fkey"
            columns: ["link_id"]
            isOneToOne: false
            referencedRelation: "links"
            referencedColumns: ["id"]
          },
        ]
      }
      link_templates: {
        Row: {
          created_at: string | null
          description: string | null
          id: string
          name: string
          original_url: string
          updated_at: string | null
          user_id: string
          utm_campaign: string | null
          utm_content: string | null
          utm_medium: string | null
          utm_source: string | null
          utm_term: string | null
        }
        Insert: {
          created_at?: string | null
          description?: string | null
          id?: string
          name: string
          original_url: string
          updated_at?: string | null
          user_id: string
          utm_campaign?: string | null
          utm_content?: string | null
          utm_medium?: string | null
          utm_source?: string | null
          utm_term?: string | null
        }
        Update: {
          created_at?: string | null
          description?: string | null
          id?: string
          name?: string
          original_url?: string
          updated_at?: string | null
          user_id?: string
          utm_campaign?: string | null
          utm_content?: string | null
          utm_medium?: string | null
          utm_source?: string | null
          utm_term?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "link_templates_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      links: {
        Row: {
          click_count: number | null
          created_at: string | null
          description: string | null
          id: string
          original_url: string
          slug: string
          user_id: string | null
        }
        Insert: {
          click_count?: number | null
          created_at?: string | null
          description?: string | null
          id?: string
          original_url: string
          slug: string
          user_id?: string | null
        }
        Update: {
          click_count?: number | null
          created_at?: string | null
          description?: string | null
          id?: string
          original_url?: string
          slug?: string
          user_id?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "links_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      profiles: {
        Row: {
          clerk_user_id: string | null
          created_at: string | null
          email: string | null
          id: string
          updated_at: string | null
        }
        Insert: {
          clerk_user_id?: string | null
          created_at?: string | null
          email?: string | null
          id: string
          updated_at?: string | null
        }
        Update: {
          clerk_user_id?: string | null
          created_at?: string | null
          email?: string | null
          id?: string
          updated_at?: string | null
        }
        Relationships: []
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      get_current_profile_id: { Args: never; Returns: string }
      increment_click_count: { Args: { link_id: string }; Returns: undefined }
    }
    Enums: {
      [_ in never]: never
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type DatabaseWithoutInternals = Omit<Database, "__InternalSupabase">

type DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, "public">]

export type Tables<
  DefaultSchemaTableNameOrOptions extends
    | keyof (DefaultSchema["Tables"] & DefaultSchema["Views"])
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema["Tables"] &
        DefaultSchema["Views"])
    ? (DefaultSchema["Tables"] &
        DefaultSchema["Views"])[DefaultSchemaTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  DefaultSchemaEnumNameOrOptions extends
    | keyof DefaultSchema["Enums"]
    | { schema: keyof DatabaseWithoutInternals },
  EnumName extends DefaultSchemaEnumNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = DefaultSchemaEnumNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema["Enums"]
    ? DefaultSchema["Enums"][DefaultSchemaEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof DefaultSchema["CompositeTypes"]
    | { schema: keyof DatabaseWithoutInternals },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema["CompositeTypes"]
    ? DefaultSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

export const Constants = {
  public: {
    Enums: {},
  },
} as const
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# pnpm
pnpm-lock.yaml

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env
.env.development*
.env.test*
.env.production*
.env.local*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# vscode
.vscode/

# Git related
*.patch
*.log

# mcp
.cursor/mcp.json
.mcp.json
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import { Analytics } from "@vercel/analytics/next";
import { ThemeProvider } from "next-themes";
import { ClerkProvider } from "@clerk/nextjs";
import { koKR } from "@clerk/localizations";
import Navigation from "@/shared/components/nav";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "demodev-link",
  description: "demodev 단축 URL 서비스",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <ClerkProvider localization={koKR}>
      <html lang="ko" suppressHydrationWarning>
        <body
          className={`${geistSans.variable} ${geistMono.variable} min-h-screen bg-background font-sans antialiased`}
        >
          <ThemeProvider
            attribute="class"
            defaultTheme="system"
            enableSystem
            disableTransitionOnChange
          >
            <div className="relative flex min-h-screen flex-col">
              <Navigation />
              <main className="flex-1">{children}</main>
            </div>
            <Analytics />
          </ThemeProvider>
        </body>
      </html>
    </ClerkProvider>
  );
}
</file>

<file path="src/app/page.tsx">
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";
import {
  Link2,
  BarChart3,
  ShieldCheck,
  Zap,
  Users,
  Settings,
  ArrowRight,
  Globe,
  CheckCircle2,
} from "lucide-react";
import Iridescence from "@/components/Iridescence";

export default function LandingPage() {
  return (
    <div className="min-h-screen bg-background text-foreground overflow-x-hidden selection:bg-primary/10 selection:text-primary">
      {/* Hero Section */}
      <section className="relative min-h-screen flex items-center justify-center overflow-hidden pt-20 pb-32">
        {/* Ambient Glow */}
        <div className="glow-bg" />

        <div className="absolute inset-0 z-0 opacity-40">
          <Iridescence
            color={[0.18, 0.42, 1.0]} /* Matching Brand Blue #2E6CFF */
            mouseReact={true}
            amplitude={0.05}
            speed={0.8}
          />
        </div>

        {/* Textured Overlay */}
        <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 z-[1] mix-blend-soft-light" />
        <div className="absolute inset-0 bg-gradient-to-b from-background/0 via-background/60 to-background/90 z-[2]" />

        <div className="container relative mx-auto px-4 z-10">
          <div className="max-w-4xl mx-auto text-center animate-in space-y-10">
            {/* Badge */}
            <div className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/60 dark:bg-white/5 border border-white/60 dark:border-white/10 text-xs font-semibold text-primary backdrop-blur-md shadow-sm cursor-default hover:bg-white/80 transition-colors">
              <span className="flex h-1.5 w-1.5 rounded-full bg-primary animate-pulse"></span>
              <span>v2.0 Now Available</span>
            </div>

            {/* Main Title */}
            <div className="space-y-6">
              <h1 className="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-black tracking-tighter leading-[1.0] text-foreground drop-shadow-sm">
                DemoDev
                <span className="text-primary relative inline-block">
                  Link
                  <svg className="absolute w-full h-3 -bottom-1 left-0 text-primary/20 -z-10" viewBox="0 0 100 10" preserveAspectRatio="none">
                    <path d="M0 5 Q 50 10 100 5" stroke="currentColor" strokeWidth="8" fill="none" />
                  </svg>
                </span>
              </h1>
              <p className="mx-auto max-w-xl text-lg sm:text-xl text-muted-foreground font-normal leading-relaxed tracking-tight">
                단순한 링크 단축 그 이상.<br className="hidden sm:block" />
                <strong className="text-foreground font-semibold">데이터 기반</strong>의 강력한 링크 관리 플랫폼을 경험하세요.
              </p>
            </div>

            {/* CTA Buttons - Metallic/3D Feel */}
            <div className="flex flex-col sm:flex-row gap-4 justify-center items-center pt-6">
              <Link href="/shorten" className="w-full sm:w-auto">
                <Button
                  size="lg"
                  className="rounded-full w-full sm:w-auto h-12 px-8 text-base font-bold bg-primary hover:bg-primary/90 text-white shadow-[0_4px_14px_0_rgba(46,108,255,0.39)] hover:shadow-[0_6px_20px_rgba(46,108,255,0.23)] hover:-translate-y-[1px] transition-all"
                >
                  무료로 시작하기
                  <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
              </Link>
              <Link href="/admin" className="w-full sm:w-auto">
                <Button
                  size="lg"
                  variant="outline"
                  className="rounded-full w-full sm:w-auto h-12 px-8 text-base font-semibold bg-white/50 border-white/60 hover:bg-white/80 text-foreground shadow-sm hover:shadow transition-all backdrop-blur-sm"
                >
                  <Globe className="mr-2 h-4 w-4 text-muted-foreground" />
                  대시보드 데모
                </Button>
              </Link>
            </div>

            {/* Stats - Metallic Cards */}
            <div className="pt-24 grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
              {[
                { label: "가동 시간", value: "99.99%" },
                { label: "링크 생성", value: "10M+" },
                { label: "응답 속도", value: "< 10ms" },
                { label: "보안 수준", value: "Enterprise" },
              ].map((stat, i) => (
                <div key={i} className="metallic-surface rounded-2xl p-5 text-center group transition-all hover:-translate-y-1">
                  <div className="text-2xl sm:text-3xl font-black text-foreground mb-1 tracking-tight group-hover:text-primary transition-colors">{stat.value}</div>
                  <div className="text-xs sm:text-sm text-muted-foreground font-medium uppercase tracking-wide">{stat.label}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </section>

      {/* Features Section */}
      <section className="py-32 relative">
        {/* Subtle background surface */}
        <div className="absolute inset-0 bg-secondary/30 -skew-y-3 transform origin-top-left scale-110 z-0" />

        <div className="container px-4 mx-auto relative z-10">
          <div className="text-center mb-20 max-w-2xl mx-auto">
            <h2 className="text-3xl md:text-4xl font-bold mb-6 tracking-tight text-foreground">
              압도적인 <span className="text-primary">퍼포먼스</span>
            </h2>
            <p className="text-lg text-muted-foreground leading-relaxed">
              가볍지만 강력합니다. <br />
              비즈니스에 필요한 모든 기능을 직관적인 인터페이스에 담았습니다.
            </p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
            <FeatureCard
              icon={<Link2 className="w-5 h-5" />}
              title="스마트 URL 단축"
              description="브랜드 아이덴티티를 담은 커스텀 도메인과 슬러그를 제공합니다."
            />
            <FeatureCard
              icon={<BarChart3 className="w-5 h-5" />}
              title="심층 분석 데이터"
              description="실시간 클릭, 유입 경로, 지역, 디바이스 등 상세 데이터를 시각화합니다."
            />
            <FeatureCard
              icon={<ShieldCheck className="w-5 h-5" />}
              title="엔터프라이즈 보안"
              description="SSL 암호화, 비밀번호 보호, 만료일 설정으로 안전하게 공유하세요."
            />
            <FeatureCard
              icon={<Zap className="w-5 h-5" />}
              title="Global Edge"
              description="전 세계 엣지 네트워크를 통해 딜레이 없는 빠른 접속을 보장합니다."
            />
            <FeatureCard
              icon={<Users className="w-5 h-5" />}
              title="팀 워크스페이스"
              description="프로젝트별로 링크를 관리하고 팀원들과 효율적으로 협업하세요."
            />
            <FeatureCard
              icon={<Settings className="w-5 h-5" />}
              title="API & Webhooks"
              description="강력한 API로 기존 워크플로우에 단축 기능을 통합하세요."
            />
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-32 px-4">
        <div className="container mx-auto max-w-5xl">
          <div className="metallic-surface rounded-[2.5rem] p-12 md:p-20 text-center relative overflow-hidden">
            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-primary/10 blur-[100px] rounded-full pointer-events-none" />

            <div className="relative z-10">
              <h2 className="text-3xl md:text-4xl font-bold mb-6 tracking-tight">
                지금 바로 시작하세요
              </h2>
              <p className="text-lg text-muted-foreground mb-10 max-w-xl mx-auto">
                신용카드 없이 14일 무료 체험이 가능합니다. <br />
                수천 개의 기업이 선택한 링크 관리 솔루션.
              </p>

              <div className="flex justify-center gap-4 mb-12">
                <Link href="/shorten">
                  <Button size="lg" className="rounded-full h-14 px-10 text-base font-bold bg-foreground text-background hover:bg-foreground/90 shadow-xl hover:scale-105 transition-all">
                    무료로 시작하기
                    <ArrowRight className="ml-2 w-4 h-4" />
                  </Button>
                </Link>
              </div>

              <div className="flex flex-wrap justify-center gap-8 text-sm font-medium text-muted-foreground">
                <div className="flex items-center gap-2">
                  <CheckCircle2 className="w-4 h-4 text-primary" />
                  <span>14일 무료 체험</span>
                </div>
                <div className="flex items-center gap-2">
                  <CheckCircle2 className="w-4 h-4 text-primary" />
                  <span>카드 등록 불필요</span>
                </div>
                <div className="flex items-center gap-2">
                  <CheckCircle2 className="w-4 h-4 text-primary" />
                  <span>언제든 해지 가능</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="py-12 border-t border-border bg-background/50">
        <div className="container px-4 mx-auto">
          <div className="grid grid-cols-2 md:grid-cols-4 gap-8 mb-12">
            <div className="col-span-2 md:col-span-1">
              <div className="font-bold text-lg mb-4 tracking-tight">
                DemoLink
              </div>
              <p className="text-sm text-muted-foreground leading-relaxed max-w-xs">
                데이터 기반의 의사결정을 돕는 <br />
                프리미엄 링크 관리 플랫폼
              </p>
            </div>
            <div>
              <h4 className="font-semibold mb-4 text-sm text-foreground">Product</h4>
              <ul className="space-y-3 text-sm text-muted-foreground">
                <li className="hover:text-primary transition-colors cursor-pointer">Features</li>
                <li className="hover:text-primary transition-colors cursor-pointer">Pricing</li>
                <li className="hover:text-primary transition-colors cursor-pointer">API</li>
              </ul>
            </div>
            <div>
              <h4 className="font-semibold mb-4 text-sm text-foreground">Company</h4>
              <ul className="space-y-3 text-sm text-muted-foreground">
                <li className="hover:text-primary transition-colors cursor-pointer">About</li>
                <li className="hover:text-primary transition-colors cursor-pointer">Blog</li>
                <li className="hover:text-primary transition-colors cursor-pointer">Careers</li>
              </ul>
            </div>
            <div>
              <h4 className="font-semibold mb-4 text-sm text-foreground">Legal</h4>
              <ul className="space-y-3 text-sm text-muted-foreground">
                <li className="hover:text-primary transition-colors cursor-pointer">Privacy</li>
                <li className="hover:text-primary transition-colors cursor-pointer">Terms</li>
              </ul>
            </div>
          </div>
          <div className="pt-8 text-center text-xs text-muted-foreground border-t border-border/50">
            &copy; 2024 DemoDev Link. All rights reserved.
          </div>
        </div>
      </footer>
    </div>
  );
}

function FeatureCard({ icon, title, description }: { icon: React.ReactNode, title: string, description: string }) {
  return (
    <div className="group p-6 rounded-2xl metallic-surface transition-all duration-300 hover:-translate-y-1 hover:shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:hover:shadow-none dark:hover:bg-accent/10">
      <div className="w-10 h-10 rounded-xl bg-primary/5 border border-primary/10 flex items-center justify-center text-primary mb-5 group-hover:scale-110 group-hover:bg-primary group-hover:text-white transition-all duration-300">
        {icon}
      </div>
      <h3 className="text-lg font-bold mb-3 tracking-tight text-foreground">{title}</h3>
      <p className="text-sm text-muted-foreground leading-relaxed">
        {description}
      </p>
    </div>
  );
}
</file>

<file path="src/features/auth/components/admin/sidebar.tsx">
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  Home,
  Link2,
  BarChart3,
  Users,
  Settings,
  Moon,
  Sun,
  Menu,
  X,
  FileText,
  FolderKanban,
  Sparkles,
} from "lucide-react";
import { UserButton } from "@clerk/nextjs";
import { UserRole } from "@/features/auth/services/clerk-auth.service";
import { cn } from "@/lib/utils";
import { Button } from "@/shared/components/ui/button";
import { useTheme } from "next-themes";
import { useState } from "react";

interface AdminSidebarProps {
  userRole: UserRole;
}

export default function AdminSidebar({ userRole }: AdminSidebarProps) {
  const pathname = usePathname();
  const { theme, setTheme } = useTheme();
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

  const isActive = (path: string) => {
    return pathname === path || pathname.startsWith(path + "/");
  };

  const menuItems = [
    {
      name: "대시보드",
      href: "/admin/dashboard",
      icon: Home,
      roles: ["user", "admin"],
    },
    {
      name: "링크 관리",
      href: "/admin/links",
      icon: Link2,
      roles: ["user", "admin"],
    },
    {
      name: "캠페인",
      href: "/admin/campaigns",
      icon: FolderKanban,
      roles: ["user", "admin"],
    },
    {
      name: "템플릿",
      href: "/admin/templates",
      icon: FileText,
      roles: ["user", "admin"],
    },
    {
      name: "분석",
      href: "/admin/analytics",
      icon: BarChart3,
      roles: ["user", "admin"],
    },
    {
      name: "사용자 관리",
      href: "/admin/users",
      icon: Users,
      roles: ["admin"],
    },
  ];

  const filteredMenuItems = menuItems.filter((item) =>
    item.roles.includes(userRole),
  );

  return (
    <>
      {/* Mobile Header */}
      <div className="lg:hidden fixed top-0 left-0 right-0 z-50 h-16 bg-white/80 dark:bg-black/80 backdrop-blur-xl border-b border-white/10 px-4 flex items-center justify-between">
        <Link href="/" className="flex items-center gap-2">
          <span className="font-bold text-lg text-foreground tracking-tight">DemoLink</span>
        </Link>

        <button
          onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
          className="p-2 rounded-lg text-muted-foreground hover:bg-black/5 dark:hover:bg-white/10"
        >
          {isMobileMenuOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
        </button>
      </div>

      {/* Desktop Sidebar */}
      <aside className={cn(
        "hidden lg:flex flex-col w-64 h-screen fixed left-0 top-0 z-40 transition-all duration-300",
        "bg-white/70 dark:bg-black/60 backdrop-blur-2xl border-r border-white/20 dark:border-white/10",
        "shadow-[4px_0_24px_-12px_rgba(0,0,0,0.05)]"
      )}>
        <div className="h-20 flex items-center px-6">
          <Link href="/" className="flex items-center gap-3 group w-full">
            <div className="flex flex-col">
              <span className="font-bold text-2xl text-foreground tracking-tight leading-none">DemoLink</span>
              <span className="text-[10px] uppercase font-bold text-muted-foreground tracking-wider mt-0.5">Workspace</span>
            </div>
          </Link>
        </div>

        {/* Navigation */}
        <nav className="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
          {filteredMenuItems.map((item) => {
            const Icon = item.icon;
            const active = isActive(item.href);

            return (
              <Link
                key={item.href}
                href={item.href}
                className={cn(
                  "relative flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group",
                  active
                    ? "bg-white dark:bg-white/10 shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] text-primary ring-1 ring-black/5 dark:ring-white/10"
                    : "text-muted-foreground hover:bg-white/50 dark:hover:bg-white/5 hover:text-foreground"
                )}
              >
                <Icon className={cn("h-4.5 w-4.5 transition-colors", active ? "text-primary" : "text-muted-foreground group-hover:text-foreground")} />
                {item.name}
                {active && (
                  <div className="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 rounded-r-full bg-primary" />
                )}
              </Link>
            );
          })}

          {userRole === "admin" && (
            <div className="pt-6 mt-2">
              <div className="px-4 text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2">Settings</div>
              <Link
                href="/admin/settings"
                className={cn(
                  "relative flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group",
                  isActive("/admin/settings")
                    ? "bg-white dark:bg-white/10 shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] text-primary ring-1 ring-black/5 dark:ring-white/10"
                    : "text-muted-foreground hover:bg-white/50 dark:hover:bg-white/5 hover:text-foreground"
                )}
              >
                <Settings className={cn("h-4.5 w-4.5 transition-colors", isActive("/admin/settings") ? "text-primary" : "text-muted-foreground group-hover:text-foreground")} />
                설정
              </Link>
            </div>
          )}
        </nav>

        {/* Bottom Section */}
        <div className="p-4 border-t border-white/10 dark:border-white/5 bg-white/30 dark:bg-black/20 backdrop-blur-sm">
          {/* Theme Toggle */}
          <div className="flex items-center justify-between px-2 mb-3">
            <div className="flex items-center gap-2">
              <Sparkles className="h-3 w-3 text-primary" />
              <span className="text-xs font-medium text-muted-foreground">테마 설정</span>
            </div>
            <Button
              variant="ghost"
              size="icon"
              onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
              className="h-7 w-7 rounded-lg hover:bg-white/50 dark:hover:bg-white/10 text-muted-foreground hover:text-foreground transition-all"
            >
              <Sun className="h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
              <Moon className="absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
            </Button>
          </div>

          {/* User Profile */}
          <div className="flex items-center gap-3 p-2 rounded-xl bg-white/40 dark:bg-white/5 border border-white/20 dark:border-white/10 shadow-sm">
            <UserButton
              appearance={{
                elements: {
                  avatarBox: "h-8 w-8 ring-2 ring-white/50 dark:ring-white/10",
                  userButtonTrigger: "focus:shadow-none"
                }
              }}
              showName={false}
            />
            <div className="flex-1 min-w-0 flex flex-col justify-center">
              <span className="text-sm font-semibold text-foreground truncate block">관리자</span>
              <span className="text-[10px] text-muted-foreground uppercase tracking-wide">
                {userRole === "admin" ? "Pro Plan" : "Free Plan"}
              </span>
            </div>
          </div>
        </div>
      </aside>

      {/* Mobile Sidebar Overlay */}
      <div className={cn(
        "lg:hidden fixed inset-0 z-50 bg-black/20 backdrop-blur-sm transition-opacity duration-300",
        isMobileMenuOpen ? "opacity-100" : "opacity-0 pointer-events-none"
      )} onClick={() => setIsMobileMenuOpen(false)} />

      {/* Mobile Sidebar Content */}
      <aside className={cn(
        "lg:hidden fixed left-0 top-0 bottom-0 w-72 z-50 bg-background/95 backdrop-blur-xl border-r border-border transition-transform duration-300 ease-out shadow-2xl",
        isMobileMenuOpen ? "translate-x-0" : "-translate-x-full"
      )}>
        <div className="h-16 flex items-center justify-between px-6 border-b border-border/50">
          <span className="font-bold text-lg">Menu</span>
          <button onClick={() => setIsMobileMenuOpen(false)} className="p-2 rounded-lg hover:bg-secondary">
            <X className="h-5 w-5" />
          </button>
        </div>
        <nav className="p-4 space-y-1">
          {filteredMenuItems.map((item) => {
            const Icon = item.icon;
            const active = isActive(item.href);
            return (
              <Link
                key={item.href}
                href={item.href}
                onClick={() => setIsMobileMenuOpen(false)}
                className={cn(
                  "flex items-center gap-3 px-4 py-3.5 rounded-xl text-base font-medium transition-all",
                  active
                    ? "bg-primary text-primary-foreground shadow-md shadow-primary/20"
                    : "text-muted-foreground hover:bg-secondary hover:text-foreground"
                )}
              >
                <Icon className="h-5 w-5" />
                {item.name}
              </Link>
            );
          })}
        </nav>
      </aside>
    </>
  );
}
</file>

<file path="src/features/links/components/url/url-input-form.tsx">
"use client";

import { shortenUrl } from "@/features/links/actions/shorten-url";
import { useState } from "react";
import { ShortenedUrlResult } from "@/features/links/components/url/shortened-url-result";
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";
import { Input } from "@/shared/components/ui/input";
import { Label } from "@/shared/components/ui/label";
import { Alert, AlertDescription } from "@/shared/components/ui/alert";
import { AlertCircle, Info, Loader2, X, Link2, Sparkles, Settings2, Globe, Hash } from "lucide-react";
import { Switch } from "@/shared/components/ui/switch";
import { Textarea } from "@/shared/components/ui/textarea";
import { Card, CardContent } from "@/shared/components/ui/card";
import { useUser } from "@clerk/nextjs";
import { UTMBuilder } from "@/features/links/components/utm/utm-builder";
import { UTMParameters, addUTMParameters, isUTMParametersEmpty } from "@/features/links/types/utm";
import { TemplateSelector } from "@/features/templates/components/template-selector";
import { getBaseUrl } from "@/lib/url";

export default function UrlInputForm() {
  const [isLoading, setIsLoading] = useState(false);
  const [shortUrl, setShortUrl] = useState<string | null>(null);
  const [lastCreatedLink, setLastCreatedLink] = useState<{
    originalUrl: string;
    description: string;
    utmParams: UTMParameters;
  } | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [inputValue, setInputValue] = useState("");
  const [description, setDescription] = useState("");
  const [customSlug, setCustomSlug] = useState("");
  const [showCustomSlug, setShowCustomSlug] = useState(false);
  const [utmParams, setUTMParams] = useState<UTMParameters>({});
  const { isLoaded, isSignedIn } = useUser();

  function handleSuccess(url: string) {
    setShortUrl(url);
    setError(null);
    // 성공 후 폼 초기화
    setInputValue("");
    setDescription("");
    setCustomSlug("");
    setShowCustomSlug(false);
    setUTMParams({});
  }

  function handleError(message: string) {
    setError(message);
    setShortUrl(null);
  }

  function handleInputChange(e: React.ChangeEvent<HTMLInputElement>) {
    setInputValue(e.target.value);
    if (error) setError(null); // 사용자가 입력 시 이전 오류 메시지 제거
  }

  function handleTemplateSelect(template: {
    url: string;
    description: string;
    utmParams: UTMParameters;
  }) {
    setInputValue(template.url);
    setDescription(template.description);
    setUTMParams(template.utmParams);
  }

  async function handleSubmit() {
    // 로그인 상태 체크
    if (!isSignedIn) {
      handleError("URL 단축 기능은 로그인 후 이용 가능합니다.");
      return;
    }

    // 입력값이 없으면 즉시 반환
    if (!inputValue.trim()) {
      handleError("URL을 입력해주세요.");
      return;
    }

    try {
      setIsLoading(true);
      setError(null);

      // URL 객체로 기본 검증 시도
      try {
        new URL(inputValue);
      } catch {
        handleError(
          "유효한 URL 형식이 아닙니다. 'http://' 또는 'https://'로 시작하는 URL을 입력해주세요.",
        );
        setIsLoading(false);
        return;
      }

      // UTM 파라미터가 있으면 원본 URL에 추가
      const finalUrl = !isUTMParametersEmpty(utmParams)
        ? addUTMParameters(inputValue, utmParams)
        : inputValue;

      const result = await shortenUrl({
        original_url: finalUrl,
        custom_slug: showCustomSlug && customSlug.trim() ? customSlug.trim() : undefined,
        description: description.trim() || undefined
      });

      // 링크 정보 저장 (템플릿 저장용)
      setLastCreatedLink({
        originalUrl: inputValue,
        description: description.trim(),
        utmParams: utmParams,
      });

      handleSuccess(result.shortUrl);
    } catch (error) {
      console.error("URL 단축 오류:", error);

      if (error instanceof Error) {
        handleError(error.message);
      } else {
        handleError("URL을 단축하는 중 오류가 발생했습니다.");
      }
    } finally {
      setIsLoading(false);
    }
  }

  // 아직 로그인 상태 확인 중이라면 로딩 표시
  if (!isLoaded) {
    return (
      <div className="flex items-center justify-center p-8">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    );
  }

  // 로그인하지 않은 경우 안내 메시지 표시
  if (!isSignedIn) {
    return (
      <Card className="border-primary/20 bg-primary/5">
        <CardContent className="pt-6">
          <div className="flex flex-col items-center text-center space-y-4">
            <div className="h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center">
              <Info className="h-8 w-8 text-primary" />
            </div>
            <div className="space-y-2">
              <h3 className="text-lg font-semibold">로그인이 필요합니다</h3>
              <p className="text-muted-foreground">
                URL 단축 기능은 회원 전용 서비스입니다.
              </p>
            </div>
            <Button asChild size="lg" className="hover-lift">
              <Link href="/admin/login">
                로그인하러 가기
                <Sparkles className="ml-2 h-4 w-4" />
              </Link>
            </Button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="space-y-6">
      <Card className="overflow-hidden border-none shadow-none bg-transparent">
        <div className="absolute inset-0 bg-transparent" />
        <CardContent className="relative p-0">
          <form action={handleSubmit} className="space-y-6">
            {/* Template Selector */}
            <div className="space-y-3">
              <TemplateSelector
                onSelect={handleTemplateSelect}
                disabled={isLoading}
              />
            </div>

            {/* Main URL Input */}
            <div className="space-y-3">
              <div className="flex items-center gap-2">
                <div className="h-10 w-10 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center">
                  <Link2 className="h-5 w-5 text-white" />
                </div>
                <Label htmlFor="url-input" className="text-lg font-semibold">
                  단축할 URL
                </Label>
              </div>
              <div className="relative group">
                <Globe className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground group-focus-within:text-primary transition-colors" />
                <Input
                  id="url-input"
                  type="url"
                  name="url"
                  value={inputValue}
                  onChange={handleInputChange}
                  placeholder="https://example.com/very-long-url"
                  aria-describedby={error ? "url-error" : undefined}
                  disabled={isLoading}
                  className="pl-10 pr-10 h-12 text-base transition-all focus:scale-[1.02] border-black/5 dark:border-white/10 bg-white/50 dark:bg-black/20 shadow-sm"
                  required
                />
                {inputValue && (
                  <button
                    type="button"
                    onClick={() => setInputValue("")}
                    className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
                    aria-label="입력 내용 지우기"
                  >
                    <X className="h-5 w-5" />
                  </button>
                )}
              </div>
            </div>

            {/* Description */}
            <div className="space-y-3">
              <Label htmlFor="description" className="flex items-center gap-2">
                <Settings2 className="h-4 w-4 text-muted-foreground" />
                설명 추가 (선택사항)
              </Label>
              <Textarea
                id="description"
                name="description"
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                placeholder="이 링크에 대한 설명을 입력하세요 (예: 2024년 블로그 포스트, 회사 소개 페이지 등)"
                disabled={isLoading}
                rows={3}
                maxLength={500}
                className="resize-none transition-all focus:scale-[1.01] border-black/5 dark:border-white/10 bg-white/50 dark:bg-black/20 shadow-sm"
              />
              <p className="text-xs text-muted-foreground">
                나중에 링크를 쉽게 찾고 관리할 수 있도록 설명을 추가해보세요.
              </p>
            </div>

            {/* UTM Builder Section */}
            <div className="space-y-2">
              <UTMBuilder
                originalUrl={inputValue}
                onUTMChange={setUTMParams}
                disabled={isLoading}
              />
            </div>

            {/* Custom Slug Toggle */}
            <div className="p-4 rounded-lg bg-muted/10 space-y-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className="h-8 w-8 rounded-md bg-primary/10 flex items-center justify-center">
                    <Hash className="h-4 w-4 text-primary" />
                  </div>
                  <div>
                    <Label htmlFor="custom-slug" className="text-sm font-medium cursor-pointer">
                      커스텀 주소 사용
                    </Label>
                    <p className="text-xs text-muted-foreground">원하는 주소로 지정할 수 있습니다</p>
                  </div>
                </div>
                <Switch
                  id="custom-slug"
                  checked={showCustomSlug}
                  onCheckedChange={setShowCustomSlug}
                  disabled={isLoading}
                />
              </div>

              {showCustomSlug && (
                <div className="space-y-3 animate-in slide-in-from-top-2">
                  <div className="flex items-center space-x-2 p-3 rounded-md bg-white/50 dark:bg-black/20 border border-black/5 dark:border-white/10">
                    <span className="text-sm font-medium text-muted-foreground">{getBaseUrl()}/</span>
                    <Input
                      id="slug-input"
                      type="text"
                      name="slug"
                      value={customSlug}
                      onChange={(e) => setCustomSlug(e.target.value.replace(/[^a-zA-Z0-9-]/g, ''))}
                      placeholder="my-custom-link"
                      disabled={isLoading}
                      className="flex-1 border-0 bg-transparent focus:ring-0 p-0 h-auto"
                      maxLength={50}
                    />
                  </div>
                  <p className="text-xs text-muted-foreground">
                    영문(a-z, A-Z), 숫자(0-9), 하이픈(-)만 사용 가능
                  </p>
                </div>
              )}
            </div>

            {/* Submit Button */}
            <Button
              type="submit"
              disabled={isLoading}
              size="lg"
              className="w-full h-12 text-base font-medium hover-lift group"
              aria-busy={isLoading}
            >
              {isLoading ? (
                <>
                  <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                  처리 중...
                </>
              ) : (
                <>
                  URL 단축하기
                  <Sparkles className="ml-2 h-5 w-5 group-hover:rotate-12 transition-transform" />
                </>
              )}
            </Button>
          </form>
        </CardContent>
      </Card>

      {/* Error Alert */}
      {error && (
        <Alert variant="destructive" id="url-error" className="animate-in slide-in-from-top-2">
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>{error}</AlertDescription>
        </Alert>
      )}

      {/* Success Result */}
      {shortUrl && (
        <div className="animate-in slide-in-from-bottom-3">
          <ShortenedUrlResult
            shortUrl={shortUrl}
            originalUrl={lastCreatedLink?.originalUrl}
            description={lastCreatedLink?.description}
            utmParams={lastCreatedLink?.utmParams}
          />
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/shared/components/nav.tsx">
"use client";

import Link from "next/link";
import { useState, useEffect } from "react";
import { Button } from "@/shared/components/ui/button";
import { useTheme } from "next-themes";
import {
  Menu,
  X,
  Sun,
  Moon,
  Home,
  Shield,
} from "lucide-react";
import { usePathname } from "next/navigation";
import { cn } from "@/lib/utils";
import { useUser, UserButton } from "@clerk/nextjs";

// NavigationContent 컴포넌트를 별도로 분리
function NavigationContent() {
  const [isOpen, setIsOpen] = useState(false);
  const [isScrolled, setIsScrolled] = useState(false);
  const { theme, setTheme } = useTheme();
  const pathname = usePathname();
  const { isSignedIn, isLoaded } = useUser();

  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 10);
    };

    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  const navItems = [
    { href: "/", label: "Home", icon: Home },
    { href: "/admin/login", label: "Admin", icon: Shield },
  ];

  return (
    <nav
      className={cn(
        "sticky top-0 z-50 w-full transition-all duration-300 border-b",
        isScrolled
          ? "bg-background/80 backdrop-blur-xl border-border/50"
          : "bg-transparent border-transparent",
      )}
    >
      <div className="container mx-auto px-4">
        <div className="flex h-16 items-center justify-between">
          {/* Logo */}
          <Link
            href="/"
            className="text-lg font-bold tracking-tight hover:opacity-80 transition-opacity"
          >
            DemoLink
          </Link>

          {/* Desktop Navigation */}
          <div className="hidden md:flex md:items-center md:gap-6">
            <div className="flex items-center gap-1">
              {navItems.map((item) => {
                const isActive = pathname === item.href;

                return (
                  <Link
                    key={item.href}
                    href={item.href}
                    className={cn(
                      "text-sm font-medium transition-colors hover:text-foreground px-4 py-2 rounded-full",
                      isActive
                        ? "text-foreground bg-secondary/80"
                        : "text-muted-foreground hover:bg-secondary/40"
                    )}
                  >
                    {item.label}
                  </Link>
                );
              })}
            </div>

            <div className="flex items-center gap-3 pl-2 border-l border-border/50 h-6">
              {/* Theme Toggle */}
              <Button
                variant="ghost"
                size="icon"
                onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
                className="rounded-full h-9 w-9 text-muted-foreground hover:text-foreground"
              >
                <Sun className="h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
                <Moon className="absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
                <span className="sr-only">Toggle Theme</span>
              </Button>

              {/* User Button or CTA */}
              {isLoaded && (
                isSignedIn ? (
                  <UserButton
                    appearance={{
                      elements: {
                        avatarBox: "h-8 w-8",
                        userButtonTrigger: "focus:shadow-none"
                      }
                    }}
                  />
                ) : (
                  <Button
                    size="sm"
                    className="h-9 px-5 rounded-full font-medium shadow-sm"
                    asChild
                  >
                    <Link href="/admin/register">
                      시작하기
                    </Link>
                  </Button>
                )
              )}
            </div>
          </div>

          {/* Mobile Menu Button */}
          <div className="flex items-center gap-2 md:hidden">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
              className="rounded-full h-9 w-9"
            >
              <Sun className="h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
              <Moon className="absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
            </Button>

            <button
              onClick={() => setIsOpen(!isOpen)}
              className="inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:bg-secondary hover:text-foreground transition-colors"
            >
              <span className="sr-only">Menu</span>
              {isOpen ? (
                <X className="block h-5 w-5" />
              ) : (
                <Menu className="block h-5 w-5" />
              )}
            </button>
          </div>
        </div>

        {/* Mobile Navigation */}
        <div
          className={cn(
            "md:hidden overflow-hidden transition-all duration-300 ease-in-out",
            isOpen ? "max-h-96 opacity-100 border-t border-border/50" : "max-h-0 opacity-0",
          )}
        >
          <div className="py-4 space-y-2">
            {navItems.map((item) => {
              const isActive = pathname === item.href;

              return (
                <Link
                  key={item.href}
                  href={item.href}
                  className={cn(
                    "flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors",
                    isActive
                      ? "bg-secondary text-foreground"
                      : "text-muted-foreground hover:bg-secondary/50 hover:text-foreground",
                  )}
                  onClick={() => setIsOpen(false)}
                >
                  <item.icon className="h-4 w-4" />
                  {item.label}
                </Link>
              );
            })}

            {isLoaded && (
              <div className="pt-4 mt-2 px-4">
                {isSignedIn ? (
                  <div className="flex items-center gap-3">
                    <UserButton showName />
                  </div>
                ) : (
                  <Button
                    className="w-full rounded-full"
                    asChild
                  >
                    <Link href="/admin/register" onClick={() => setIsOpen(false)}>
                      시작하기
                    </Link>
                  </Button>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    </nav>
  );
}

export default function Navigation() {
  const pathname = usePathname();

  // 관리자 페이지에서는 네비게이션 바를 숨김 (특정 페이지는 제외)
  const showNavOnAdminPages = [
    "/admin/login",
    "/admin/register",
    "/admin/pending",
    "/admin/rejected",
  ];

  const isAdminPage =
    pathname?.startsWith("/admin") && !showNavOnAdminPages.includes(pathname);

  // early return을 hooks 호출 후에 하도록 수정
  if (isAdminPage) {
    return null;
  }

  return <NavigationContent />;
}
</file>

<file path="src/app/admin/dashboard/page.tsx">
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";
import { LinkService } from "@/features/links/actions/link.service";
import { createClient } from "@/lib/supabase/server";
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "@/shared/components/ui/card";
import {
  Link2,
  BarChart3,
  Users,
  TrendingUp,
  Clock,
  MousePointerClick,
  Activity,
  Globe,
  AlertTriangle,
  ArrowUpRight,
} from "lucide-react";
import Link from "next/link";
import { Button } from "@/shared/components/ui/button";
import { DashboardErrorFallback } from "./error-fallback";
import { cn } from "@/lib/utils";

// Force dynamic rendering for authenticated server-side data
export const dynamic = "force-dynamic";

export default async function AdminDashboard() {
  try {
    // Middleware already verified auth and approval status
    const user = await ClerkAuthService.getCurrentUser();

    // Defensive check (middleware should prevent this)
    if (!user || user.status !== 'approved') {
      throw new Error('Unauthorized access');
    }

    const supabase = await createClient();

    // Initialize default values for graceful degradation
    let totalLinks = 0;
    let recentLinks: any[] = [];
    let totalClicks = 0;
    let todayTopLinks: any[] = [];
    let weekTopLinks: any[] = [];
    let pendingUsers = 0;
    let hasError = false;
    let errorMessage = "";

    try {
      // Get statistics with individual error handling
      const results = await Promise.allSettled([
        supabase.from("links").select("*", { count: "exact", head: true }),
        supabase
          .from("links")
          .select("*")
          .order("created_at", { ascending: false })
          .limit(5),
        supabase
          .from("link_clicks")
          .select("*", { count: "exact", head: true }),
        LinkService.getTopClickedLinksByPeriod("today", 5),
        LinkService.getTopClickedLinksByPeriod("week", 5),
      ]);

      // Process results with error checking
      if (results[0].status === "fulfilled") {
        totalLinks = results[0].value.count || 0;
      } else {
        console.error("Failed to fetch total links:", results[0].reason);
      }

      if (results[1].status === "fulfilled") {
        recentLinks = results[1].value.data || [];
      } else {
        console.error("Failed to fetch recent links:", results[1].reason);
      }

      if (results[2].status === "fulfilled") {
        totalClicks = results[2].value.count || 0;
      } else {
        console.error("Failed to fetch total clicks:", results[2].reason);
      }

      if (results[3].status === "fulfilled") {
        todayTopLinks = results[3].value || [];
      } else {
        console.error("Failed to fetch today's top links:", results[3].reason);
      }

      if (results[4].status === "fulfilled") {
        weekTopLinks = results[4].value || [];
      } else {
        console.error("Failed to fetch week's top links:", results[4].reason);
      }

      // Admin only stats with error handling - fetch from Clerk
      if (user.role === "admin") {
        try {
          const users = await ClerkAuthService.getUsersByStatus("pending");
          pendingUsers = users.length;
        } catch (err) {
          console.error("Error fetching pending users from Clerk:", err);
        }
      }

      // Check if any critical queries failed
      const criticalFailures = results
        .slice(0, 3)
        .filter((result) => result.status === "rejected");
      if (criticalFailures.length > 0) {
        hasError = true;
        errorMessage = "일부 통계 데이터를 불러오지 못했습니다.";
      }
    } catch (err) {
      console.error("Dashboard data fetch error:", err);
      hasError = true;
      errorMessage = "대시보드 데이터를 불러오는 중 오류가 발생했습니다.";
    }

    // Calculate average clicks per link
    const avgClicksPerLink =
      totalLinks && totalLinks > 0
        ? Math.round((totalClicks || 0) / totalLinks)
        : 0;

    return (
      <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
        {/* Error Alert */}
        {hasError && (
          <div className="rounded-xl border border-red-200 bg-red-50 p-4 flex items-center gap-3 text-red-700">
            <AlertTriangle className="h-5 w-5" />
            <p className="text-sm font-medium">{errorMessage}</p>
          </div>
        )}

        {/* Welcome Header */}
        <div className="flex flex-col md:flex-row md:items-end justify-between gap-4">
          <div>
            <h1 className="text-3xl sm:text-4xl font-bold tracking-tight text-foreground mb-2">
              안녕하세요, <span className="text-primary opacity-90">{user.role === "admin" ? "관리자" : "사용자"}</span>님
            </h1>
            <p className="text-muted-foreground text-lg font-normal">
              오늘의 링크 활동과 통계를 확인하세요.
            </p>
          </div>
        </div>

        {/* Statistics Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <Card className="relative overflow-hidden border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl group hover:-translate-y-1 transition-all duration-300">
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium text-muted-foreground">총 링크</CardTitle>
              <div className="h-9 w-9 rounded-full bg-blue-50 dark:bg-blue-500/20 flex items-center justify-center">
                <Link2 className="h-4.5 w-4.5 text-blue-600 dark:text-blue-400" />
              </div>
            </CardHeader>
            <CardContent>
              <div className="text-3xl font-bold text-foreground mb-1">{totalLinks.toLocaleString()}</div>
              <p className="text-xs text-muted-foreground font-medium flex items-center gap-1">
                <span className="text-emerald-500 flex items-center">
                  <ArrowUpRight className="h-3 w-3 mr-0.5" /> 12%
                </span>
                지난달 대비
              </p>
            </CardContent>
          </Card>

          <Card className="relative overflow-hidden border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl group hover:-translate-y-1 transition-all duration-300">
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium text-muted-foreground">총 클릭</CardTitle>
              <div className="h-9 w-9 rounded-full bg-violet-50 dark:bg-violet-500/20 flex items-center justify-center">
                <MousePointerClick className="h-4.5 w-4.5 text-violet-600 dark:text-violet-400" />
              </div>
            </CardHeader>
            <CardContent>
              <div className="text-3xl font-bold text-foreground mb-1">{totalClicks.toLocaleString()}</div>
              <p className="text-xs text-muted-foreground font-medium flex items-center gap-1">
                <span className="text-emerald-500 flex items-center">
                  <ArrowUpRight className="h-3 w-3 mr-0.5" /> 24%
                </span>
                지난달 대비
              </p>
            </CardContent>
          </Card>

          <Card className="relative overflow-hidden border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl group hover:-translate-y-1 transition-all duration-300">
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium text-muted-foreground">평균 클릭</CardTitle>
              <div className="h-9 w-9 rounded-full bg-emerald-50 dark:bg-emerald-500/20 flex items-center justify-center">
                <Activity className="h-4.5 w-4.5 text-emerald-600 dark:text-emerald-400" />
              </div>
            </CardHeader>
            <CardContent>
              <div className="text-3xl font-bold text-foreground mb-1">{avgClicksPerLink.toLocaleString()}</div>
              <p className="text-xs text-muted-foreground font-medium">링크당 평균</p>
            </CardContent>
          </Card>

          {user.role === "admin" && (
            <Card className="relative overflow-hidden border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl group hover:-translate-y-1 transition-all duration-300">
              <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                <CardTitle className="text-sm font-medium text-muted-foreground">승인 대기</CardTitle>
                <div className="h-9 w-9 rounded-full bg-orange-50 dark:bg-orange-500/20 flex items-center justify-center">
                  <Users className="h-4.5 w-4.5 text-orange-600 dark:text-orange-400" />
                </div>
              </CardHeader>
              <CardContent>
                <div className="text-3xl font-bold text-foreground mb-1">{pendingUsers}</div>
                <div className="flex items-center justify-between">
                  <p className="text-xs text-muted-foreground font-medium">새로운 사용자</p>
                  {pendingUsers > 0 && (
                    <Link href="/admin/users" className="text-xs font-semibold text-orange-600 hover:text-orange-700 dark:text-orange-400">
                      확인하기 →
                    </Link>
                  )}
                </div>
              </CardContent>
            </Card>
          )}
        </div>

        {/* Charts Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Today's Top Links */}
          <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
            <CardHeader className="pb-4">
              <div className="flex items-center gap-3">
                <div className="p-2 rounded-lg bg-pink-50 dark:bg-pink-500/10">
                  <TrendingUp className="h-5 w-5 text-pink-500" />
                </div>
                <div>
                  <CardTitle className="text-lg font-bold">오늘의 인기 링크</CardTitle>
                  <p className="text-xs text-muted-foreground mt-0.5">실시간 조회수가 높은 링크 TOP 5</p>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              {todayTopLinks && todayTopLinks.length > 0 ? (
                <div className="space-y-3">
                  {todayTopLinks.map((link, index) => (
                    <div
                      key={link.id}
                      className="group flex items-center gap-4 p-3 rounded-xl bg-muted/30 hover:bg-muted/60 transition-colors"
                    >
                      <div className={cn(
                        "w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",
                        index === 0 ? "bg-yellow-100 dark:bg-yellow-500/20 text-yellow-700 dark:text-yellow-400" :
                          index === 1 ? "bg-slate-100 dark:bg-slate-500/20 text-slate-700 dark:text-slate-300" :
                            index === 2 ? "bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-400" :
                              "bg-white dark:bg-white/10 text-muted-foreground"
                      )}>
                        {index + 1}
                      </div>
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <p className="font-semibold text-sm truncate text-foreground">/{link.slug}</p>
                          {link.description && (
                            <span className="text-[10px] text-muted-foreground px-1.5 py-0.5 rounded bg-white dark:bg-white/10 border border-black/5 dark:border-white/5">
                              {link.description}
                            </span>
                          )}
                        </div>
                        <p className="text-xs text-muted-foreground truncate mt-0.5 opacity-70 group-hover:opacity-100 transition-opacity">
                          {link.original_url}
                        </p>
                      </div>
                      <div className="text-right pl-4">
                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-white dark:bg-white/10 text-foreground border border-black/5 dark:border-white/5 shadow-sm">
                          {link.period_clicks} 클릭
                        </span>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center py-12 text-center">
                  <Globe className="h-10 w-10 text-muted-foreground/20 mb-3" />
                  <p className="text-sm font-medium text-muted-foreground">아직 데이터가 충분하지 않습니다</p>
                </div>
              )}
            </CardContent>
          </Card>

          {/* This Week's Top Links */}
          <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
            <CardHeader className="pb-4">
              <div className="flex items-center gap-3">
                <div className="p-2 rounded-lg bg-indigo-50 dark:bg-indigo-500/10">
                  <BarChart3 className="h-5 w-5 text-indigo-500" />
                </div>
                <div>
                  <CardTitle className="text-lg font-bold">주간 인기 링크</CardTitle>
                  <p className="text-xs text-muted-foreground mt-0.5">최근 7일간 가장 인기있는 링크</p>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              {weekTopLinks && weekTopLinks.length > 0 ? (
                <div className="space-y-3">
                  {weekTopLinks.map((link, index) => (
                    <div
                      key={link.id}
                      className="group flex items-center gap-4 p-3 rounded-xl bg-muted/30 hover:bg-muted/60 transition-colors"
                    >
                      <div className={cn(
                        "w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",
                        index === 0 ? "bg-yellow-100 dark:bg-yellow-500/20 text-yellow-700 dark:text-yellow-400" :
                          index === 1 ? "bg-slate-100 dark:bg-slate-500/20 text-slate-700 dark:text-slate-300" :
                            index === 2 ? "bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-400" :
                              "bg-white dark:bg-white/10 text-muted-foreground"
                      )}>
                        {index + 1}
                      </div>
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <p className="font-semibold text-sm truncate text-foreground">/{link.slug}</p>
                          {link.description && (
                            <span className="text-[10px] text-muted-foreground px-1.5 py-0.5 rounded bg-white dark:bg-white/10 border border-black/5 dark:border-white/5">
                              {link.description}
                            </span>
                          )}
                        </div>
                        <p className="text-xs text-muted-foreground truncate mt-0.5 opacity-70 group-hover:opacity-100 transition-opacity">
                          {link.original_url}
                        </p>
                      </div>
                      <div className="text-right pl-4">
                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-white dark:bg-white/10 text-foreground border border-black/5 dark:border-white/5 shadow-sm">
                          {link.period_clicks} 클릭
                        </span>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center py-12 text-center">
                  <BarChart3 className="h-10 w-10 text-muted-foreground/20 mb-3" />
                  <p className="text-sm font-medium text-muted-foreground">아직 데이터가 충분하지 않습니다</p>
                </div>
              )}
            </CardContent>
          </Card>
        </div>

        {/* Recent Links */}
        <Card className="border-none shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] bg-white dark:bg-white/5 backdrop-blur-xl">
          <CardHeader className="border-b border-border/40 pb-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="p-2 rounded-lg bg-teal-50 dark:bg-teal-500/10">
                  <Clock className="h-5 w-5 text-teal-500" />
                </div>
                <div>
                  <CardTitle className="text-lg font-bold">최근 생성된 링크</CardTitle>
                  <p className="text-xs text-muted-foreground mt-0.5">가장 최근에 만들어진 단축 URL 목록</p>
                </div>
              </div>
              <Button variant="ghost" size="sm" asChild className="hover:bg-muted">
                <Link href="/admin/links" className="text-xs font-semibold">전체 보기 →</Link>
              </Button>
            </div>
          </CardHeader>
          <CardContent className="pt-6">
            {recentLinks && recentLinks.length > 0 ? (
              <div className="space-y-4">
                {recentLinks.map((link) => (
                  <div
                    key={link.id}
                    className="flex flex-col sm:flex-row sm:items-center justify-between p-4 rounded-xl bg-muted/20 border border-transparent hover:border-primary/10 hover:bg-white dark:hover:bg-white/5 hover:shadow-lg hover:shadow-primary/5 transition-all duration-300"
                  >
                    <div className="flex-1 min-w-0 mb-3 sm:mb-0">
                      <div className="flex items-center gap-3 mb-1.5">
                        <p className="text-base font-bold text-foreground tracking-tight">/{link.slug}</p>
                        <span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-primary/10 text-primary">
                          {link.click_count || 0} clicks
                        </span>
                      </div>
                      <div className="flex flex-col sm:flex-row sm:items-center gap-y-1 gap-x-3 text-xs text-muted-foreground">
                        {link.description && (
                          <span className="font-medium text-foreground/80">{link.description}</span>
                        )}
                        <span className="truncate max-w-[300px] opacity-70 hover:opacity-100 transition-opacity">{link.original_url}</span>
                      </div>
                    </div>
                    <div className="text-right sm:ml-4 flex items-center justify-between sm:justify-end gap-4 min-w-[120px]">
                      <p className="text-xs font-medium text-muted-foreground/60">
                        {new Date(link.created_at || "").toLocaleDateString(
                          "ko-KR",
                          {
                            month: "short",
                            day: "numeric",
                            hour: "2-digit",
                            minute: "2-digit",
                          },
                        )}
                      </p>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="flex flex-col items-center justify-center py-16 text-center bg-muted/20 rounded-xl border border-dashed border-border/50">
                <Link2 className="h-12 w-12 text-muted-foreground/20 mb-4" />
                <h3 className="text-lg font-semibold text-foreground">아직 링크가 없습니다</h3>
                <p className="text-sm text-muted-foreground mb-6 max-w-sm mx-auto">
                  첫 번째 단축 URL을 만들어보세요. 실시간 통계와 관리가 시작됩니다.
                </p>
                <Button size="lg" className="rounded-full shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all" asChild>
                  <Link href="/shorten">첫 링크 만들기</Link>
                </Button>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    );
  } catch (error) {
    console.error("Critical dashboard error:", error);
    return <DashboardErrorFallback />;
  }
}
</file>

<file path="src/features/links/actions/link.service.ts">
import { createClient } from "@/lib/supabase/server";
import { createClient as createBrowserClient } from "@/lib/supabase/client";
import { CreateLinkDTO, Link, DailyClickStats } from "@/shared/types/link";
import { Snowflake } from "@/shared/utils/snowflake";
import type { SupabaseClient } from "@supabase/supabase-js";
import { ClerkAuthService } from "@/features/auth/services/clerk-auth.service";

export class LinkService {
  private static TABLE_NAME = "links";
  private static CLICK_TABLE = "link_clicks";

  /**
   * Supabase 클라이언트를 가져옵니다.
   * 테스트 환경에서는 주입된 클라이언트를 사용하고,
   * 그렇지 않으면 서버 클라이언트를 사용합니다.
   */
  private static async getSupabaseClient(injectedClient?: SupabaseClient) {
    if (injectedClient) {
      return injectedClient;
    }

    // 테스트 환경인지 확인
    if (process.env.NODE_ENV === "test" || process.env.VITEST) {
      // 테스트 환경에서는 브라우저 클라이언트 사용 (cookies 없이)
      return createBrowserClient();
    }

    // 프로덕션/개발 환경에서는 서버 클라이언트 사용
    return await createClient();
  }

  /**
   * 단축 URL을 생성합니다.
   * @param data 원본 URL 정보
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 생성된 링크 객체
   */
  static async createShortLink(
    data: CreateLinkDTO,
    supabaseClient?: SupabaseClient,
    clerkUserId?: string,
  ): Promise<Link> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);

      // Clerk 인증 (테스트 환경은 스킵)
      let userId = clerkUserId || null;
      let userEmail: string | null = null;

      if (!supabaseClient && process.env.NODE_ENV !== "test" && !process.env.VITEST) {
        const user = await ClerkAuthService.requireAuth({ requiredStatus: "approved" });
        const clerkUserId = user.userId;
        userEmail = user.email;

        // 프로필 존재 확인 및 자동 생성 (id를 가져와야 함)
        const { data: existingProfile, error: profileCheckError } = await supabase
          .from("profiles")
          .select("id, clerk_user_id")
          .eq("clerk_user_id", clerkUserId)
          .single();

        // PGRST116: 레코드가 없는 경우 (정상적인 상황)
        if (profileCheckError && profileCheckError.code !== 'PGRST116') {
          console.error("Error checking profile:", profileCheckError);
          throw new Error("프로필 확인 중 오류가 발생했습니다.");
        }

        if (!existingProfile) {
          const { data: newProfile, error: profileError } = await supabase
            .from("profiles")
            .insert({
              clerk_user_id: clerkUserId,
              email: userEmail,
            })
            .select("id")
            .single();

          if (profileError || !newProfile) {
            console.error("Error creating profile:", profileError);
            throw new Error("사용자 프로필 생성 중 오류가 발생했습니다.");
          }

          userId = newProfile.id;
        } else {
          userId = existingProfile.id;
        }
      }

      // UTM 파라미터를 URL에 추가
      let finalUrl = data.original_url;
      if (data.utm_params) {
        const url = new URL(data.original_url);
        const { utm_source, utm_medium, utm_campaign, utm_term, utm_content } = data.utm_params;

        if (utm_source) url.searchParams.set('utm_source', utm_source);
        if (utm_medium) url.searchParams.set('utm_medium', utm_medium);
        if (utm_campaign) url.searchParams.set('utm_campaign', utm_campaign);
        if (utm_term) url.searchParams.set('utm_term', utm_term);
        if (utm_content) url.searchParams.set('utm_content', utm_content);

        finalUrl = url.toString();
      }

      let slug: string;

      // Check if custom slug is provided
      if (data.custom_slug) {
        // Validate custom slug format
        if (!/^[a-zA-Z0-9-]+$/.test(data.custom_slug)) {
          throw new Error("사용자 정의 주소는 영문, 숫자, 하이픈만 사용 가능합니다.");
        }
        
        // Check if custom slug already exists
        const { data: existingLink } = await supabase
          .from(this.TABLE_NAME)
          .select("id")
          .eq("slug", data.custom_slug)
          .single();
          
        if (existingLink) {
          throw new Error("이미 사용 중인 주소입니다. 다른 주소를 입력해주세요.");
        }
        
        slug = data.custom_slug;
      } else {
        // Generate random slug using Snowflake
        slug = await Snowflake.generate();
      }

      const { data: link, error } = await supabase
        .from(this.TABLE_NAME)
        .insert([
          {
            slug,
            original_url: finalUrl,
            description: data.description || null,
            click_count: 0,
            user_id: userId,
          },
        ])
        .select()
        .single();

      if (error) {
        console.error("Error creating short link:", error);
        throw new Error("단축 URL 생성 중 오류가 발생했습니다.");
      }

      return link;
    } catch (error) {
      console.error("Error in createShortLink:", error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("단축 URL 생성 중 알 수 없는 오류가 발생했습니다.");
    }
  }

  /**
   * slug로 링크를 조회합니다.
   * @param slug 단축 URL의 slug
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 링크 객체 또는 null
   */
  static async getLinkBySlug(
    slug: string,
    supabaseClient?: SupabaseClient,
  ): Promise<Link | null> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);
      const { data, error } = await supabase
        .from(this.TABLE_NAME)
        .select("*")
        .eq("slug", slug)
        .single();

      if (error) {
        if (error.code === "PGRST116") {
          // 레코드가 없는 경우 (PGRST116: Did not find a result)
          return null;
        }
        console.error("Error fetching link by slug:", error);
        throw new Error("링크 조회 중 오류가 발생했습니다.");
      }

      return data;
    } catch (error) {
      console.error(`Error in getLinkBySlug for slug ${slug}:`, error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("링크 조회 중 알 수 없는 오류가 발생했습니다.");
    }
  }

  /**
   * 링크의 클릭 수를 증가시키고 클릭 정보를 기록합니다.
   * @param slug 단축 URL의 slug
   * @param requestInfo 요청 정보 (User-Agent, IP 등)
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   */
  static async incrementClickCount(
    slug: string,
    requestInfo?: { userAgent: string | null; ip: string },
    supabaseClient?: SupabaseClient,
  ): Promise<void> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);
      let userAgent = null;
      let ip = "unknown";

      // 요청 정보가 주입되었으면 사용
      if (requestInfo) {
        userAgent = requestInfo.userAgent;
        ip = requestInfo.ip;
      }

      // 링크 ID 가져오기
      const { data: linkData, error: linkError } = await supabase
        .from(this.TABLE_NAME)
        .select("id")
        .eq("slug", slug)
        .single();

      if (linkError) {
        console.error(`Error finding link with slug ${slug}:`, linkError);
        throw new Error(`링크를 찾을 수 없습니다: ${slug}`);
      }

      if (!linkData) {
        throw new Error(`링크를 찾을 수 없습니다: ${slug}`);
      }

      // 클릭 이벤트 기록
      const [clickInsert, countUpdate] = await Promise.all([
        supabase.from(this.CLICK_TABLE).insert({
          link_id: linkData.id,
          user_agent: userAgent,
          ip_address: ip,
        }),
        supabase.rpc("increment_click_count", { link_id: linkData.id }),
      ]);

      if (clickInsert.error) {
        console.error("Error recording click event:", clickInsert.error);
        throw new Error("클릭 이벤트 기록 중 오류가 발생했습니다.");
      }

      if (countUpdate.error) {
        console.error("Error incrementing click count:", countUpdate.error);
        throw new Error("클릭 수 업데이트 중 오류가 발생했습니다.");
      }
    } catch (error) {
      console.error(`Error in incrementClickCount for slug ${slug}:`, error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("클릭 수 업데이트 중 알 수 없는 오류가 발생했습니다.");
    }
  }

  /**
   * 특정 기간 동안 가장 많이 클릭된 링크들을 가져옵니다.
   * @param period 'today' | 'week' | 'all'
   * @param limit 가져올 링크 수
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 링크 객체 배열 with click counts for the period
   */
  static async getTopClickedLinksByPeriod(
    period: 'today' | 'week' | 'all',
    limit: number = 10,
    supabaseClient?: SupabaseClient,
  ): Promise<(Link & { period_clicks: number })[]> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);
      
      let startDate: Date;
      const endDate = new Date();
      
      switch (period) {
        case 'today':
          startDate = new Date();
          startDate.setHours(0, 0, 0, 0);
          break;
        case 'week':
          startDate = new Date();
          startDate.setDate(startDate.getDate() - 7);
          startDate.setHours(0, 0, 0, 0);
          break;
        case 'all':
          // For 'all', we'll just use the regular getTopLinks method
          const allTimeLinks = await this.getTopLinks(limit, supabaseClient);
          return allTimeLinks.map(link => ({ ...link, period_clicks: link.click_count }));
      }
      
      // Get click counts for the specified period
      const { data: clickData, error: clickError } = await supabase
        .from(this.CLICK_TABLE)
        .select('link_id')
        .gte('clicked_at', startDate.toISOString())
        .lte('clicked_at', endDate.toISOString());
        
      if (clickError) {
        console.error('Error fetching click data:', clickError);
        throw new Error('클릭 데이터 조회 중 오류가 발생했습니다.');
      }
      
      // Count clicks per link
      const clickCounts = clickData.reduce((acc: { [key: string]: number }, click) => {
        acc[click.link_id] = (acc[click.link_id] || 0) + 1;
        return acc;
      }, {});
      
      // Get top link IDs
      const topLinkIds = Object.entries(clickCounts)
        .sort(([, a], [, b]) => b - a)
        .slice(0, limit)
        .map(([linkId]) => linkId);
        
      if (topLinkIds.length === 0) {
        return [];
      }
      
      // Get link details
      const { data: links, error: linksError } = await supabase
        .from(this.TABLE_NAME)
        .select('*')
        .in('id', topLinkIds);
        
      if (linksError) {
        console.error('Error fetching link details:', linksError);
        throw new Error('링크 정보 조회 중 오류가 발생했습니다.');
      }
      
      // Combine links with period click counts and sort
      const linksWithPeriodClicks = (links || []).map(link => ({
        ...link,
        period_clicks: clickCounts[link.id] || 0
      })).sort((a, b) => b.period_clicks - a.period_clicks);
      
      return linksWithPeriodClicks;
    } catch (error) {
      console.error(`Error in getTopClickedLinksByPeriod for period ${period}:`, error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error('인기 링크 조회 중 알 수 없는 오류가 발생했습니다.');
    }
  }
  
  /**
   * 클릭 수가 많은 순으로 상위 링크들을 가져옵니다.
   * @param limit 가져올 링크 수
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 링크 객체 배열
   */
  static async getTopLinks(
    limit: number = 10,
    supabaseClient?: SupabaseClient,
  ): Promise<Link[]> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);
      const { data, error } = await supabase
        .from(this.TABLE_NAME)
        .select("*")
        .order("click_count", { ascending: false })
        .limit(limit);

      if (error) {
        console.error("Error fetching top links:", error);
        throw new Error("인기 링크 조회 중 오류가 발생했습니다.");
      }

      return data || [];
    } catch (error) {
      console.error("Error in getTopLinks:", error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("인기 링크 조회 중 알 수 없는 오류가 발생했습니다.");
    }
  }

  /**
   * 모든 링크를 가져옵니다.
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 링크 객체 배열
   */
  static async getAllLinks(supabaseClient?: SupabaseClient): Promise<Link[]> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);
      const { data, error } = await supabase
        .from(this.TABLE_NAME)
        .select("*")
        .order("created_at", { ascending: false });

      if (error) {
        console.error("Error fetching all links:", error);
        throw new Error("전체 링크 조회 중 오류가 발생했습니다.");
      }

      return data || [];
    } catch (error) {
      console.error("Error in getAllLinks:", error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("전체 링크 조회 중 알 수 없는 오류가 발생했습니다.");
    }
  }

  /**
   * 링크를 삭제합니다.
   * @param linkId 삭제할 링크 ID
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   */
  static async deleteLink(
    linkId: string,
    supabaseClient?: SupabaseClient,
  ): Promise<void> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);

      const currentUser = await ClerkAuthService.requireAuth({ requiredStatus: "approved" });

      // 현재 사용자의 프로필 ID 조회
      const { data: profile } = await supabase
        .from("profiles")
        .select("id")
        .eq("clerk_user_id", currentUser.userId)
        .single();

      // 링크 소유자 확인
      const { data: link, error: linkError } = await supabase
        .from(this.TABLE_NAME)
        .select("user_id")
        .eq("id", linkId)
        .single();

      if (linkError || !link) {
        throw new Error("링크를 찾을 수 없습니다.");
      }

      // 소유자가 아니고 관리자도 아닌 경우 거부 (profiles.id로 비교)
      if (link.user_id !== profile?.id && currentUser.role !== "admin") {
        throw new Error("이 링크를 삭제할 권한이 없습니다.");
      }
      
      // 링크 삭제 (관련 클릭 데이터는 CASCADE로 자동 삭제)
      const { error: deleteError } = await supabase
        .from(this.TABLE_NAME)
        .delete()
        .eq("id", linkId);
        
      if (deleteError) {
        console.error("Error deleting link:", deleteError);
        throw new Error("링크 삭제 중 오류가 발생했습니다.");
      }
    } catch (error) {
      console.error(`Error in deleteLink for linkId ${linkId}:`, error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("링크 삭제 중 알 수 없는 오류가 발생했습니다.");
    }
  }
  
  /**
   * 특정 링크의 일별 클릭 통계를 가져옵니다.
   * @param linkId 링크 ID
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 일별 클릭 통계 배열
   */
  static async getLinkClickStats(
    linkId: string,
    supabaseClient?: SupabaseClient,
  ): Promise<DailyClickStats[]> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);
      const { data, error } = await supabase
        .from(this.CLICK_TABLE)
        .select("clicked_at")
        .eq("link_id", linkId)
        .order("clicked_at", { ascending: true });

      if (error) {
        console.error(`Error fetching click stats for link ${linkId}:`, error);
        throw new Error("클릭 통계 조회 중 오류가 발생했습니다.");
      }

      // 클릭 데이터를 일별로 집계
      const dailyStats = data.reduce(
        (acc: { [key: string]: number }, click) => {
          const date = new Date(click.clicked_at).toISOString().split("T")[0];
          acc[date] = (acc[date] || 0) + 1;
          return acc;
        },
        {},
      );

      return Object.entries(dailyStats).map(([date, clicks]) => ({
        date,
        clicks,
      }));
    } catch (error) {
      console.error(`Error in getLinkClickStats for link ${linkId}:`, error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("클릭 통계 조회 중 알 수 없는 오류가 발생했습니다.");
    }
  }
  
  /**
   * 마케팅 분석을 위한 상세 통계를 가져옵니다.
   * @param linkId 링크 ID
   * @param dateRange 날짜 범위 (선택적)
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 마케팅 분석 데이터
   */
  static async getMarketingAnalytics(
    linkId: string,
    dateRange?: { startDate?: Date; endDate?: Date },
    supabaseClient?: SupabaseClient,
  ): Promise<{
    totalClicks: number;
    uniqueClicks: number;
    clicksByHour: { hour: number; clicks: number }[];
    clicksByDevice: { device: string; clicks: number }[];
    clicksByCountry: { country: string; clicks: number }[];
    conversionRate: number;
    avgClicksPerDay: number;
    clickTrend: 'up' | 'down' | 'stable';
  }> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);

      // 링크 정보 가져오기
      const { data: link, error: linkError } = await supabase
        .from(this.TABLE_NAME)
        .select("*")
        .eq("id", linkId)
        .single();

      if (linkError || !link) {
        throw new Error("링크를 찾을 수 없습니다.");
      }

      // 클릭 데이터 가져오기 (날짜 범위 필터 적용)
      let query = supabase
        .from(this.CLICK_TABLE)
        .select("*")
        .eq("link_id", linkId);

      if (dateRange?.startDate) {
        query = query.gte("clicked_at", dateRange.startDate.toISOString());
      }

      if (dateRange?.endDate) {
        query = query.lte("clicked_at", dateRange.endDate.toISOString());
      }

      const { data: clicks, error: clicksError } = await query
        .order("clicked_at", { ascending: true });
        
      if (clicksError) {
        throw new Error("클릭 데이터 조회 중 오류가 발생했습니다.");
      }
      
      const clickData = clicks || [];
      const totalClicks = clickData.length;
      
      // 고유 IP 수 (고유 방문자)
      const uniqueIPs = new Set(clickData.map(c => c.ip_address)).size;
      
      // 시간대별 클릭 분석
      const clicksByHour = Array.from({ length: 24 }, (_, i) => ({ hour: i, clicks: 0 }));
      clickData.forEach(click => {
        const hour = new Date(click.clicked_at).getHours();
        clicksByHour[hour].clicks++;
      });
      
      // 디바이스별 클릭 분석 (User Agent 기반)
      const deviceMap: { [key: string]: number } = {};
      clickData.forEach(click => {
        if (!click.user_agent) {
          deviceMap['Unknown'] = (deviceMap['Unknown'] || 0) + 1;
          return;
        }
        
        const ua = click.user_agent.toLowerCase();
        let device = 'Desktop';
        
        if (/mobile|android|iphone|ipad|phone/i.test(ua)) {
          device = 'Mobile';
        } else if (/tablet|ipad/i.test(ua)) {
          device = 'Tablet';
        }
        
        deviceMap[device] = (deviceMap[device] || 0) + 1;
      });
      
      const clicksByDevice = Object.entries(deviceMap).map(([device, clicks]) => ({
        device,
        clicks
      }));
      
      // 국가별 클릭 (예시 - 실제로는 IP 기반 지역 분석 필요)
      const clicksByCountry = [
        { country: 'Korea', clicks: Math.floor(totalClicks * 0.7) },
        { country: 'USA', clicks: Math.floor(totalClicks * 0.2) },
        { country: 'Others', clicks: Math.floor(totalClicks * 0.1) }
      ];
      
      // 전환율 (예시 - 실제로는 목표 설정 필요)
      const conversionRate = totalClicks > 0 ? (uniqueIPs / totalClicks) * 100 : 0;
      
      // 일평균 클릭
      const daysSinceCreation = Math.max(1, 
        Math.floor((Date.now() - new Date(link.created_at).getTime()) / (1000 * 60 * 60 * 24))
      );
      const avgClicksPerDay = totalClicks / daysSinceCreation;
      
      // 클릭 트렌드 분석 (최근 7일 vs 이전 7일)
      const sevenDaysAgo = new Date();
      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
      const fourteenDaysAgo = new Date();
      fourteenDaysAgo.setDate(fourteenDaysAgo.getDate() - 14);
      
      const recentClicks = clickData.filter(c => 
        new Date(c.clicked_at) >= sevenDaysAgo
      ).length;
      
      const previousClicks = clickData.filter(c => 
        new Date(c.clicked_at) >= fourteenDaysAgo && 
        new Date(c.clicked_at) < sevenDaysAgo
      ).length;
      
      let clickTrend: 'up' | 'down' | 'stable' = 'stable';
      if (recentClicks > previousClicks * 1.1) {
        clickTrend = 'up';
      } else if (recentClicks < previousClicks * 0.9) {
        clickTrend = 'down';
      }
      
      return {
        totalClicks,
        uniqueClicks: uniqueIPs,
        clicksByHour,
        clicksByDevice,
        clicksByCountry,
        conversionRate,
        avgClicksPerDay,
        clickTrend
      };
    } catch (error) {
      console.error(`Error in getMarketingAnalytics for link ${linkId}:`, error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error('마케팅 분석 데이터 조회 중 알 수 없는 오류가 발생홈습니다.');
    }
  }

  /**
   * 모든 링크와 기간별 클릭 수를 가져옵니다.
   * @param dateRange 날짜 범위 (선택적)
   * @param supabaseClient 테스트용 Supabase 클라이언트 (선택적)
   * @returns 링크 배열 (기간별 클릭 수 포함)
   */
  static async getAllLinksWithPeriodClicks(
    dateRange?: { startDate?: Date; endDate?: Date },
    supabaseClient?: SupabaseClient,
  ): Promise<(Link & { period_clicks: number })[]> {
    try {
      const supabase = await this.getSupabaseClient(supabaseClient);

      // 모든 링크 가져오기
      const { data: links, error: linksError } = await supabase
        .from(this.TABLE_NAME)
        .select("*")
        .order("created_at", { ascending: false });

      if (linksError) {
        console.error("Error fetching links:", linksError);
        throw new Error("링크 조회 중 오류가 발생했습니다.");
      }

      if (!links || links.length === 0) {
        return [];
      }

      // 날짜 범위가 없으면 전체 클릭 수 사용
      if (!dateRange?.startDate && !dateRange?.endDate) {
        return links.map(link => ({
          ...link,
          period_clicks: link.click_count
        }));
      }

      // 기간별 클릭 데이터 가져오기
      let query = supabase
        .from(this.CLICK_TABLE)
        .select('link_id');

      if (dateRange?.startDate) {
        query = query.gte('clicked_at', dateRange.startDate.toISOString());
      }

      if (dateRange?.endDate) {
        query = query.lte('clicked_at', dateRange.endDate.toISOString());
      }

      const { data: clickData, error: clickError } = await query;

      if (clickError) {
        console.error('Error fetching click data:', clickError);
        throw new Error('클릭 데이터 조회 중 오류가 발생했습니다.');
      }

      // 링크별 클릭 수 계산
      const clickCounts = (clickData || []).reduce((acc: { [key: string]: number }, click) => {
        acc[click.link_id] = (acc[click.link_id] || 0) + 1;
        return acc;
      }, {});

      // 링크에 기간별 클릭 수 추가
      return links.map(link => ({
        ...link,
        period_clicks: clickCounts[link.id] || 0
      }));
    } catch (error) {
      console.error("Error in getAllLinksWithPeriodClicks:", error);
      if (error instanceof Error) {
        throw error;
      }
      throw new Error("링크 조회 중 알 수 없는 오류가 발생했습니다.");
    }
  }
}
</file>

<file path="src/middleware.ts">
/**
 * @file src/middleware.ts
 * @description Next.js 미들웨어 - Clerk 기반 라우트 보호 및 인증 관리
 *
 * 이 미들웨어는 Clerk을 사용하여 사용자 인증 상태를 확인하고 적절한 페이지로 라우팅합니다.
 *
 * 주요 기능:
 * 1. 관리자 페이지 접근 제어
 * 2. 사용자 상태별 라우팅 (대기중, 승인됨, 거절됨)
 * 3. Clerk metadata 기반 권한 체크
 *
 * 핵심 구현 로직:
 * - Clerk middleware를 사용한 인증 체크
 * - publicMetadata의 status, role 확인
 *
 * @dependencies
 * - @clerk/nextjs: Clerk Next.js SDK
 *
 * @see {@link https://clerk.com/docs/references/nextjs/clerk-middleware}
 */

import {
  clerkMiddleware,
  clerkClient,
  createRouteMatcher,
} from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';

// Public routes that don't require authentication
const isPublicRoute = createRouteMatcher([
  '/',
  '/shorten',
  '/admin/login(.*)',
  '/admin/register(.*)',
  '/sign-in(.*)',
  '/sign-up(.*)',
  '/api/webhooks(.*)',
  '/api/cron(.*)',
]);

// Routes that should be excluded from middleware entirely (short URLs)
const isShortUrlRoute = (pathname: string) => {
  // Exclude admin, api, _next, and static files
  const excludedPrefixes = ['/admin', '/api', '/_next', '/shorten', '/sign-in', '/sign-up'];
  const excludedExtensions = ['.ico', '.svg', '.png', '.jpg', '.jpeg', '.gif', '.webp', '.css', '.js'];

  if (pathname === '/') return false;
  if (excludedPrefixes.some(prefix => pathname.startsWith(prefix))) return false;
  if (excludedExtensions.some(ext => pathname.endsWith(ext))) return false;

  // Single segment paths like /abc123 are short URLs
  const segments = pathname.split('/').filter(Boolean);
  return segments.length === 1;
};

// Admin-only routes
const isAdminRoute = createRouteMatcher(['/admin/users(.*)']);

export default clerkMiddleware(async (auth, request) => {
  const { userId, sessionClaims } = await auth();
  const { pathname } = request.nextUrl;

  // 1. Always allow public routes (regardless of auth status)
  if (isPublicRoute(request)) {
    return NextResponse.next();
  }

  // 2. Allow short URL routes without authentication (e.g., /abc123)
  if (isShortUrlRoute(pathname)) {
    return NextResponse.next();
  }

  // 3. Redirect unauthenticated users to login
  if (!userId) {
    return NextResponse.redirect(new URL('/admin/login', request.url));
  }

  // 4. Get user metadata
  // Prefer sessionClaims for speed; fall back to Clerk user fetch if metadata missing
  let publicMetadata =
    (sessionClaims?.publicMetadata as { status?: string; role?: string }) || {};

  if (!publicMetadata.status || !publicMetadata.role) {
    try {
      const client = await clerkClient();
      const user = await client.users.getUser(userId);
      publicMetadata =
        (user.publicMetadata as { status?: string; role?: string }) || publicMetadata;
    } catch (error) {
      console.error('[middleware] Failed to fetch user metadata', error);
    }
  }

  const userStatus = publicMetadata.status || 'pending';
  const userRole = publicMetadata.role || 'user';

  // 5. Handle admin routes
  if (!pathname.startsWith('/admin')) {
    return NextResponse.next();
  }

  // 6. Redirect authenticated users from auth pages to appropriate dashboard
  if (
    pathname.startsWith('/admin/login') ||
    pathname.startsWith('/admin/register')
  ) {
    const statusRedirects: Record<string, string> = {
      approved: '/admin/dashboard',
      pending: '/admin/pending',
      rejected: '/admin/rejected',
    };
    return NextResponse.redirect(
      new URL(statusRedirects[userStatus] || '/admin/pending', request.url),
    );
  }

  // 7. Status pages: only allow matching status, otherwise redirect to dashboard
  if (pathname === '/admin/pending') {
    if (userStatus === 'pending') return NextResponse.next();
    return NextResponse.redirect(new URL('/admin/dashboard', request.url));
  }
  if (pathname === '/admin/rejected') {
    if (userStatus === 'rejected') return NextResponse.next();
    return NextResponse.redirect(new URL('/admin/dashboard', request.url));
  }

  // 8. Redirect non-approved users to their status page
  if (userStatus === 'pending') {
    return NextResponse.redirect(new URL('/admin/pending', request.url));
  }
  if (userStatus === 'rejected') {
    return NextResponse.redirect(new URL('/admin/rejected', request.url));
  }

  // 9. From here, only approved users can proceed
  // Check admin-only routes
  if (isAdminRoute(request) && userRole !== 'admin') {
    return NextResponse.redirect(new URL('/admin/dashboard', request.url));
  }

  // 10. Allow access
  return NextResponse.next();
});

export const config = {
  matcher: [
    /*
     * Match all request paths except for the ones starting with:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * - .well-known (for domain verification)
     */
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};
</file>

<file path="package.json">
{
  "name": "demo-link",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "test": "vitest",
    "lint": "next lint",
    "repomix": "bunx repomix",
    "gen:types": "pnpm dlx supabase gen types typescript --project-id 'lzwfzfvnijediorljtnk' > src/shared/types/database.types.ts",
    "db:push": "pnpm dlx supabase db push",
    "db:pull": "pnpm dlx supabase db pull --schema public",
    "migrate:users-to-clerk": "tsx scripts/migrate-users-to-clerk.ts"
  },
  "dependencies": {
    "@clerk/backend": "^2.24.0",
    "@clerk/localizations": "^3.28.5",
    "@clerk/nextjs": "^6.35.5",
    "@heroicons/react": "^2.2.0",
    "@hookform/resolvers": "^5.1.1",
    "@radix-ui/react-accordion": "^1.2.11",
    "@radix-ui/react-alert-dialog": "^1.1.14",
    "@radix-ui/react-aspect-ratio": "^1.1.7",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.2",
    "@radix-ui/react-collapsible": "^1.1.11",
    "@radix-ui/react-context-menu": "^2.2.15",
    "@radix-ui/react-dialog": "^1.1.14",
    "@radix-ui/react-dropdown-menu": "^2.1.15",
    "@radix-ui/react-hover-card": "^1.1.14",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-menubar": "^1.1.15",
    "@radix-ui/react-navigation-menu": "^1.2.13",
    "@radix-ui/react-popover": "^1.1.14",
    "@radix-ui/react-progress": "^1.1.7",
    "@radix-ui/react-radio-group": "^1.3.7",
    "@radix-ui/react-scroll-area": "^1.2.9",
    "@radix-ui/react-select": "^2.2.5",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slider": "^1.3.5",
    "@radix-ui/react-slot": "^1.2.0",
    "@radix-ui/react-switch": "^1.2.5",
    "@radix-ui/react-tabs": "^1.1.4",
    "@radix-ui/react-toggle": "^1.1.9",
    "@radix-ui/react-toggle-group": "^1.1.10",
    "@radix-ui/react-tooltip": "^1.2.7",
    "@supabase/ssr": "^0.6.1",
    "@supabase/supabase-js": "^2.49.4",
    "@vercel/analytics": "^1.5.0",
    "chart.js": "^4.4.9",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^4.1.0",
    "dotenv": "^16.5.0",
    "embla-carousel-react": "^8.6.0",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.513.0",
    "nanoid": "^5.1.5",
    "next": "15.5.9",
    "next-themes": "^0.4.6",
    "ogl": "^1.0.11",
    "react": "^19.0.0",
    "react-chartjs-2": "^5.3.0",
    "react-day-picker": "^9.7.0",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7.57.0",
    "react-resizable-panels": "^3.0.2",
    "recharts": "^2.15.2",
    "sonner": "^2.0.5",
    "svix": "^1.81.0",
    "tailwind-merge": "^3.2.0",
    "tw-animate-css": "^1.2.5",
    "vaul": "^1.1.2",
    "zod": "^3.25.56"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@testing-library/dom": "^10.4.0",
    "@testing-library/react": "^16.3.0",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@vitejs/plugin-react": "^4.4.0",
    "eslint": "^9",
    "eslint-config-next": "15.3.0",
    "jsdom": "^26.1.0",
    "tailwindcss": "^4",
    "tsx": "^4.19.4",
    "typescript": "^5",
    "vite-tsconfig-paths": "^5.1.4",
    "vitest": "^3.1.1"
  }
}
</file>

</files>
